<!DOCTYPE html>
<html lang="en">
<head>
  <title>Switched On</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="animate.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <style>
 
/* Preguntar como hacer para que se achique con relacion al tamaño de la pagina y como hacer para que si se agranda la ventana que "suban" los botones que entren
pero si se achica que vuelvan a "bajar"*/

	/* W3.CSS 4.04 Apr 2017 by Jan Egil and Borge Refsnes */
html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}
/* Extract from normalize.css by Nicolas Gallagher and Jonathan Neal git.io/normalize */
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}
img{border-style:none}

::-webkit-input-placeholder{color:inherit;opacity:0.54}
::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}
/* End extract */

html,body{font-family:Verdana,sans-serif;font-size:15px;line-height:1.5}html{overflow-x:hidden}
h3{font-family:"Segoe UI",Arial,sans-serif;font-weight:10;margin:10px 0;color:#3b7aaf;
    text-align:left;
    font-size:3vw;
    display: block;}

.my-image{max-width:100%;height:auto}img{margin-bottom:-5px}

.my-display-container{position:relative}
.my-container:after,.my-container:before,.my-row-padding:after,.my-row-padding:before{content:"";display:table;clear:both}
.my-col{float:left;width:100%}

@media (min-width:700px){.my-col.m6{width:49.99999%}}
@media (min-width:1300px){.my-col.l3{width:24.99999%}}
.my-content{max-width:980px;margin:auto}

.my-display-topleft{position:absolute;left:0;top:0}

.my-row-padding,.my-row-padding>.my-col{padding:0 8px}
.my-container{padding:0.01em 16px}

.my-border-bottom{border-bottom-color: #d3d3d3; border-style: solid; border-bottom-width: thin; border-top-color: transparent; border-right-color: transparent; border-left-color: transparent;}
.my-margin-bottom{margin-bottom:16px!important}
.my-padding{padding:8px 16px!important}
.my-padding-16{padding-top:16px!important;padding-bottom:16px!important}
.my-padding-0-16{padding-top:0px!important;padding-bottom:16px!important}
.my-padding-32{padding-top:32px!important;padding-bottom:32px!important}
.my-padding-0-32{padding-top:0px!important;padding-bottom:32px!important}

.my-black{color:#fff!important;background-color:#000!important}

 .logo{
 background-image:url("smart_house_logo.png");
 background-size: 56px 56px;
 background-repeat: no-repeat;
 width: 56px;
 height: 56px;
}

 .justify-center-56px{
  justify-content: center;
  display: flex;
  flex-direction: row;
  height: 56px;
 }

 .flex-center{
  display: flex;
  align-items: center;
 }

 .tam{
    font-size:16px;
 }

 .color{
  background-color: black;
 }

 .modal-footer{
  background-color: #D8E4EF;
  border-bottom-right-radius: 12px;
  border-bottom-left-radius: 12px;
 }

.modal-header{
  border-bottom-right-radius: 12px;
  border-bottom-left-radius: 12px;
 }

 </style>
</head>
<body onload="loadDevices()">

<nav class="navbar navbar-inverse color">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>                        
      </button>
      <a class="navbar-brand logo" href="Home.html"></a>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav justify-center-56px">
        <li><a class="flex-center tam" href="MyDevices.html">Rooms and Devices</a></li>
        <li><a class="flex-center tam" href="MyCombos.html">Combinations</a></li>
        <li><a class="flex-center tam" href="MyAgenda.html">Agenda</a></li>
        <li><a class="flex-center tam" href="Now On.html">Switched On</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a class="dropdown-toggle flex-center tam" data-toggle="dropdown" href="#">My Profile <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="#">Configurations</a></li>
            <li><a href="#">News</a></li>
            <li><a href="Profiles.html">Change Profile</a></li>
            <li><a href="Main Page.html">Log out</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>
 
<!-- Page content -->
<div class="my-content my-padding" id="devicesContainer" style="max-width:1564px">

  <!-- Project Section -->
  <div class="my-container my-padding-0-32" id="SwitchedOn">
    <h3 class="my-border-bottom my-padding-0-16">Switched On</h3>
  </div>

<!-- Aca estarian los dispositivos añadidos dinamicamente-->
  
<!-- End page content -->
</div>

  <div class="modal fade" id="now-on-modal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title text-center">Device</h3>
        </div>
        <div class="modal-body">
          <form class="horizontal">
            <div class="form-group">
             
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal">Accept</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
      
    </div>
  </div>

  <script>

var api = class {
  static get baseUrl() {
    return "http://127.0.0.1:8080/api/";
  }

  static get timeout() {
    return 60 * 1000;
  }
}

api.device = class {
  static get url() {
    return api.baseUrl + "devices/";
  }

  static add(device) {
   return $.ajax({
      url: api.device.url,
      method: "POST",
      dataType: "json",
      timeout: api.timeout,
      data: device
    }); 
  }

  static modify(device) {
   return $.ajax({
      url: api.device.url + device.id,
      method: "PUT",
      dataType: "json",
      timeout: api.timeout,
      data:device
    }); 
  }

  static delete(id) {
   return $.ajax({
      url: api.device.url + id,
      method: "DELETE",
      dataType: "json",
      timeout: api.timeout,
    }); 
  }

  static get(id) {
    return $.ajax({
      url: api.device.url + id,
      method: "GET",
      dataType: "json",
      timeout: api.timeout
    });
  }

  static linkToRoom(idDevice,idRoom){
      return $.ajax({
      url: "http://127.0.0.1:8080/api" + /devices/+ idDevice + /rooms/ + idRoom,
      method: "POST",
      dataType: "json",
      timeout: api.timeout
    });
  }

  static getAll(){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices",
      method: "GET",
      dataType: "json",
      timeout: api.timeout
    });
  }

  static getTypes(){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devicetypes",
      method: "GET",
      dataType: "json",
      timeout: api.timeout
    });
  }

}

api.model = api.model || {};

api.model.device = class {
  constructor(typeId, name, meta) {
    if (typeId) {
      this.typeId = typeId;
    } else {
      delete(this.typeId);
    }
    this.name = name;
    this.meta = meta;
  }
}

function addImageOfDeviceType(type, deviceImage){

  switch(type){

    case "eu0v2xgprrhhg41g" :

        deviceImage.setAttribute("src", "Blinds.png");
        break;

    case "go46xmbqeomjrsjr":

        deviceImage.setAttribute("src", "Lamp.png");
        break;

    case "im77xxyulpegfmv8":

        deviceImage.setAttribute("src", "Oven.png");
        break;

    case "li6cbv5sdlatti0j":

        deviceImage.setAttribute("src", "Ac.png");
        break;

    case "lsf78ly0eqrjbz91":

        deviceImage.setAttribute("src", "Door.png");
        break;

    case "mxztsyjzsrq7iaqc":

        deviceImage.setAttribute("src", "Alarm.png");
        break;

    case "ofglvd9gqX8yfl3l":

        deviceImage.setAttribute("src", "Timer.png");
        break;

    case "rnizejqr2di0okho":

        deviceImage.setAttribute("src", "Fridge.png");
        break;

    default:

        deviceImage.setAttribute("src", "Default.png");
  }
}


function loadDevice(data, i){

  var deviceContainer = document.createElement("div");
  deviceContainer.classList.add("my-col");
  deviceContainer.classList.add("l3");
  deviceContainer.classList.add("m6");
  deviceContainer.classList.add("my-margin-bottom");

  var displayContainer = document.createElement("div");
  displayContainer.classList.add("my-display-container");

  deviceContainer.appendChild(displayContainer);

  var tag = document.createElement("div");
  tag.classList.add("my-display-topleft");
  tag.classList.add("my-black");
  tag.classList.add("my-padding");

  displayContainer.appendChild(tag);

  var deviceName = data.devices[i].name;
  tag.innerHTML = deviceName;

  var deviceButton = document.createElement("button");
  deviceButton.classList.add("btn");
  deviceButton.classList.add("btn-default");
  deviceButton.setAttribute("type", data.devices[i].typeId);
  deviceButton.setAttribute("id", data.devices[i].id);

  displayContainer.appendChild(deviceButton);

  var deviceImage = document.createElement("img");
  deviceImage.setAttribute("alt", deviceName);
  deviceImage.classList.add("my-image");

  deviceButton.appendChild(deviceImage);

  addImageOfDeviceType(deviceButton.getAttribute("type"), deviceImage);

  return deviceContainer;
}


function createRow(){
  var row = document.createElement("div");
  row.classList.add("my-row-padding");

  return row;
}

function loadDevicesHTML(data){
  var i, father, currentRow;

  father = document.getElementById("devicesContainer");

  for(i = 0; i < data.devices.length; i++){
    if((i % 4) == 0){
      currentRow = createRow();
      father.appendChild(currentRow);
    }

    currentRow.appendChild(loadDevice(data, i));
  }
}

function loadDevices(){

  api.device.getAll()

  .done(function (data) {
    loadDevicesHTML(data);
  })

  .fail(function (jqXHR, textStatus) {
    alert ('Request failed:' + textStatus);
  })
}        

</script>

</body>
</html>
