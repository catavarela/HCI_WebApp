<!DOCTYPE html>
<html lang="en">
<head>
  <title>Rooms and Devices</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.3.6/css/bootstrap-colorpicker.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-2.2.2.min.js"></script>

  <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
  <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>

  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.3.6/js/bootstrap-colorpicker.js"></script>


  <style>

html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}
/* Extract from normalize.css by Nicolas Gallagher and Jonathan Neal git.io/normalize */
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}
img{border-style:none}

::-webkit-input-placeholder{color:inherit;opacity:0.54}
::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}
/* End extract */

html,body{font-family:Verdana,sans-serif;font-size:15px;line-height:1.5}html{overflow-x:hidden}

h3{font-family:"Segoe UI",Arial,sans-serif;font-weight:10;margin:10px 0;color:#3b7aaf;
    text-align:left;
    font-size:3vw;
    display: block;}

html{
    height: 100%;
}

body{
    background-color:white;
    height:100%;
    width:100%;
}

.my-display-topleft{position:absolute;left:0;top:0; margin-top: 20%} /* agregado por cata */
.my-black{color:#fff!important;background-color:#000!important} /* agregado por cata */
.my-padding{padding:8px 16px!important} /* agregado por cata */

 .logo{
 background-image:url("smart_house_logo.png");
 background-size: 56px 56px;
 background-repeat: no-repeat;
 width: 56px;
 height: 56px;
}

 .justify-center-56px{
  justify-content: center;
  display: flex;
  flex-direction: row;
  height: 56px;
 }

 .flex-center{
  display: flex;
  align-items: center;
 }

 .tam{
    font-size:16px;
 }

 .color{
  background-color: black;
 }

.my-container{
    width:100%;
    height:90%;
}

.left-container{
    background-color:white;
    width: 25%;
    height:95%;
    position:relative;
    right:-2%;
    border-radius: 25px;
    border-width:thin;
    border-color:transparent;
    border-style:solid;
    float:left;
}

.wrapper-room-title{
    background-color: transparent;
    width:100%;
    height:10%;
    padding:-2%;
}

.title-left-container{
    font-family:"Segoe UI",Arial,sans-serif;
    font-weight:10;
    color:#3b7aaf;
    text-align:center;
    font-size:3vw;
    display: block;
}

.left-fine-line{
    width:80%;
    border-right-color: transparent;
    border-left-color: transparent;
    border-top-color:transparent;
    border-bottom-color:#d3d3d3;
    border-style:solid;
    border-bottom-width:thin;
    position:relative;
    top:-20px;
}

.middle{
    background-color:transparent;
    position:relative;
    top:1.5%;
    width:100%;
    height:70%;
}

.wrapper{
    background-color:#D8E4EF;
    position:relative;
    right:-7.5%;
    border-radius: 15px;
    border-color:transparent;
    border-style: solid;
    height: 100%;
    width:85%;
}

.scrollContent{
  overflow-y: auto;
  float: left;
}

.vertical-menu {
    position:relative;
    top:2%;
    right:-8%;
    width: 83%;
    height:95%;
    overflow-y: auto;
    float:left;
    text-overflow: ellipsis;
}

.mod-room{
    width:15%;
    height:100%;
    background-color: white;
    border-right-color: transparent;
    border-bottom-color: transparent;
    border-top-color: transparent;
    border-left-color:#d3d3d3;
    border-left-width: thin;
    border-bottom-right-radius:10px;
    border-top-right-radius:10px;
    color:#3b7aaf;
}

.mod-room:hover{
    background-color: #B1CADF;
    color: black;
}

.mod-room-pencil{
    border-bottom-right-radius:0px;
    border-top-right-radius:0px;
}

.span-a{
    width:100%;
    height:10%;
    display: flex;
    margin-bottom:5%;

    line-height: 20px;
}
.vertical-menu a {
    color: #3b7aaf;
    background-color: white;
    border-bottom-left-radius: 10px;
    border-top-left-radius: 10px;
    display: block;
    width: 83%;
    padding: 5%;
    text-decoration: none;
    font-size:1.5vw;
    display: block;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;

    vertical-align: middle;
}

.vertical-menu a:hover {
    background-color: #B1CADF;
    color:black;
}

.wrapper-button-new-room{
    height:20%;
    width:100%;
    background-color:transparent;
    
}

.button-new-room{
    width:78%;
    height:33%;
    min-width:50%;
    border-radius: 10px;/*
    border-color:#d3d3d3;
    background-color:white;*/
    color:#3b7aaf;
    font-size: 1.5vw;
    position:relative;
    left:11%;
    top:30%;
}

.button-new-room:hover{
    background-color:#B1CADF;
}

.right-container{
    background-color:white;
    width:70%;
    height:95%;
    position:relative;
    right:-4.5%;
    float:left;
    /*border-radius: 25px;*/
    border-style:solid;
    border-width:thin;
    border-left-color: #d3d3d3;
    border-right-color: transparent;
    border-top-color: transparent;
    border-bottom-color:transparent;

}

.wrapper-room-title-two{
    background-color: transparent;
    width:95%;
    height:10%;
    position:relative;
    right:-25px;
    border-radius: 25px;
    margin-bottom:2%;
}

.title-right-container{
    color:#3b7aaf;
    text-align:center;
    font-size:3vw;
    font-family:"Segoe UI",Arial,sans-serif;
    font-weight:10;
    display: block;
}

.right-fine-line{
    width:80%;
    border-right-color: transparent;
    border-left-color: transparent;
    border-top-color:transparent;
    border-bottom-color:#d3d3d3;
    border-style:solid;
    border-bottom-width:thin;
    position:relative;
    top:-20px;
}

.wrapper-devices-container{
    position:relative;
    top:-1.75%;
    left:5%;
    width:90%;
    height:81.25%;
    background-color:#D8E4EF;
    border-radius: 15px;
    border-color:transparent;
    border-style:solid;
}

.devices-container{
    position:relative;
    top:1%;
    width:97%;
    height:97%;
    background-color: #D8E4EF;
    border-radius: 15px;
    overflow-y: auto;

}

.text-starter-devices-container{
    font-size:150%;
    position: relative;
    float: left;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.device-container{
    width:25%;
    height:35%;
    position:relative;
    top:-5%;
    float: left;
    margin-left:5%;
    margin-bottom: 5%;
    
}

.create-device{
    position:relative;
    top:25%;
    width:100%;
    height:100%;
    background-image:url("addDevice.png");
    background-size: 100% 100%;
    background-repeat: no-repeat;
    border-color:transparent;
    
}

.new-device-button{
    position:relative;
    top:25%;
    width:100%;
    height:100%;
    background-color: white; 
    background-size: 100% 100%;
    background-repeat: no-repeat;
    border-color:transparent;
}

.hidden-devices{
    display:none;
}

.modal-footer{
  background-color: #D8E4EF;
  border-bottom-right-radius: 12px;
  border-bottom-left-radius: 12px;
 }

.modal-header{
  border-bottom-right-radius: 12px;
  border-bottom-left-radius: 12px;
 }

.modal-text-device{
  font-size:200%;
}

/* The switch - the box around the slider 
.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
}
*/
/* Hide default HTML checkbox 
.switch input {display:none;}
*/
/* The slider 
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  -webkit-transition: .4s;
  transition: .4s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
}

input:checked + .slider {
  background-color: #3b7aaf;
}

input:focus + .slider {
  box-shadow: 0 0 1px #3b7aaf;
}

input:checked + .slider:before {
  -webkit-transform: translateX(26px);
  -ms-transform: translateX(26px);
  transform: translateX(26px);
}
*/
/* Rounded sliders 
.slider.round {
  border-radius: 34px;
}

.slider.round:before {
  border-radius: 50%;
}*/

.trampa{
  color:white;
  font-size: 1px;
}

.error{
  color:red;
  font-size:75%;
  display:none;
}

.notification{
  width:200px;
  height:35px;
  background-color: #B1CADF;
  position: absolute;
  bottom:15px;
  right:15px;
  display:none;
}

/*
.header-notification{
  width:100%;
    height:20%;
    background-color:#15993c;
    text-align:center;
    font-size:155%;
    color:white;
}

.header-not{
}

.body-notification{
  display: flex;
    width:100%;
    height:80%;
    background-color:#75ff7c;
}
*/

.body-text{
  font-size: 20px;
  text-align: center;
  color: black;
  font-weight: 10;
  /*width:150px;
  height:100%;
  margin-top:32px;*/
}


/*SEARCH*/
#my-search {
  background-position: 10px 12px;
  background-repeat: no-repeat;
  width: 100%;
  font-family: Verdana, sans-serif;
  font-size: 15px;
  padding: 8px;
  border: 1px solid #ddd;
  margin-bottom: 12px;
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
  border-bottom-left-radius: 10px;
  border-bottom-right-radius: 10px;
}

 </style>
</head>
<body onload="loadAll()" id="myBody">

  <nav class="navbar navbar-inverse color">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>                        
        </button>
        <a class="navbar-brand logo" href="index.html"></a>
      </div>
      <div class="collapse navbar-collapse" id="myNavbar">
        <ul class="nav navbar-nav justify-center-56px">
          <li><a class="flex-center tam" href="MyDevices.html">Rooms and Devices</a></li>
          <li><a class="flex-center tam" href="MyCombos.html">Combinations</a></li>
          <li><a class="flex-center tam" href="Now On.html">Switched On</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="my-container" id="main-container">
    <div class="left-container">
        <div class="wrapper-room-title">
            <h1 class="title-left-container">Rooms</h1>
            <hr class="left-fine-line">
        </div>
        <div class="middle">
            <div class="wrapper scrollContent">
                <div class="vertical-menu" id="ver-menu">
                  <input type="text" id="my-search" onkeyup="mySearch()" placeholder="Search..."> <!--SEARCH-->
                  <br>
                </div>
            </div>
        </div>
        <div class="wrapper-button-new-room">
            <button class="button-new-room btn btn-default" id="new-room">Add room</button>
        </div>
    </div>
    <div class="right-container" id="starter-right-container">
        <div class="wrapper-room-title-two">
            <h1 class="title-right-container">Devices</h1>
            <hr class="right-fine-line">
        </div>
        <div class="wrapper-devices-container scrollContent">
            <div class="devices-container">
                <p class="text-starter-devices-container">To see the devices, please select or create a room!!</p>
            </div>
        </div>
    </div>
  </div>

  <!-- Idea del href del "a" del ver-menu-->
  <div class="hidden-devices" id ="hidden-div">
  </div>

  <!-- Modal -->
  <div class="modal fade" id="room" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Add room</h3>
        </div>
        <div class="modal-body">
           <form role="form">
            <div class="form-group">
              <label for="room-name"><span class="glyphicon glyphicon-home"></span> Name:</label>
              <input type="text" class="form-control" id="room-name" placeholder="Enter name" name="room-name">
              <p class="error" id="error-nameRoomAlpha">The room name must contain only letters or numbers </p>
              <p class="error" id="error-nameRoomLength">The name must have between 3 and 30 characters </p>
              <p class="error" id="error-nameRoomExist">This name already exists</p>
              <label for="room-description">Description (optional):</label>
              <input type="text" class="form-control" id="room-description" placeholder="Enter description" name="room-description">
            </div>
           </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="createRoom();" id="new-room-accept">Accept </button>
          <button type="submit" class="btn btn-default" onclick="cancelRoom();">Cancel</button>
        </div>
      </div>  
    </div>
  </div> 
  
  
  <!-- Modal -->
  <div class="modal fade" id="device" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Add device</h3>
        </div>
        <div class="modal-body">
           <form role="form">
            <div class="form-group">
              <label for="usrname">Name:</label>
              <input type="text" class="form-control" id="device-name" placeholder="Enter name" name="usrname">
              <p class="error" id="error-nameDeviceLength">The name must have between 3 and 30 characters </p>
              <p class="error" id="error-exist-device-name">This name already exists</p>
              <label for="descr">Description (optional):</label>
              <input type="text" class="form-control" id="device-description" placeholder="Enter description" name="descr">
            </div>
           </form>
           <label>Select type:</label>
           <select id="comboBoxTypeDevices" class="form-control">
            <option value="none"></option>
           </select>
         <p class="error" id="error-deviceType">You have not selected a device type</p>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="createDevice();">Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>  
    </div>
  </div> 
  
  
  <!-- Modal de modify-->
  <div class="modal fade" id="modify-room" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title text-center" type="none" id="modify-room-header">Edit room</h3>
        </div>
        <div class="modal-body">
           <form role="form">
            <div class="form-group">
              <label for="actual-room-name" class="control-label">Name:</label>
              <p class="room-name-modal form-control-static" id="actual-room-name"></p>
              <label for="actual-room-description" class="control-label">Description:</label>
              <p class="room-description-modal form-control-static" id="actual-room-description"></p>                           <!--hay que poner la descripcion actual-->
              <label for="new-room-name"><span class="glyphicon glyphicon-home"></span> Change name:</label>
              <input type="text" class="form-control" id="new-room-name" placeholder="Enter new name" name="new-room-name">
              <p class="error" id="error-nameNewRoomAlpha">The room name must contain only letters or numbers </p>
              <p class="error" id="error-nameNewRoomLength">The name must have between 3 and 30 characters </p>
              <p class="error" id="error-nameNewRoomExist">This name already exists</p>
              <label for="new-room-description">Change description:</label>                                                     <!--hay que updatear la descripcion tambien-->
              <input type="text" class="form-control" id="new-room-description" placeholder="Enter new description" name="new-room-description">
            </div>
           </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="changeName();">Accept </button>
          <button type="submit" class="btn btn-default" id="cancel-modify-room">Cancel</button>
        </div>
      </div>  
    </div>
  </div> 
  
  <!-- Confirmation modal delete room-->
  <div class="modal fade" id="confirmation-Delete" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title text-center" id="confirmation-Delete-name"><h3>
        </div>
        <div class="modal-body">
          <p class="confirm-delete-text">Are you sure you want to delete this room? All the devices inside will be deleted.</p>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="removeRoom()">Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>  
      </div>
    </div>
  </div>

    <!-- Confirmation modal delete device-->
  <div class="modal fade" id="confirmation-Delete-device" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title text-center" id="delete-modal-device-name"><h3>
        </div>
        <div class="modal-body">
          <p class="confirm-delete-text">Are you sure you want to delete this device?</p>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" id="accept-delete-device">Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>  
      </div>
    </div>
  </div> 

   <!-- Modal of errorConnection-->
  <div class="modal fade" id="data-base-error" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title text-center"><h3>
        </div>
        <div class="modal-body">
          <p class="confirm-delete-text">There was a connection problem with the data base. Please check that you are connected and refresh the page</p>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" data-dismiss="modal">Accept </button>
        </div>  
      </div>
    </div>
  </div> 


  <!-- MODALS DE DEVICES-->

  <!-- MODAL DE BLIND-->
  <div class="modal fade" id="device-blinds" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Blinds</h3>
        </div>
        <div class="modal-body">
          <form class="form-horizontal">
            <div class="form-group">
              <label for="blinds-name" class="control-label col-sm-4" style="text-align: right;">Name:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="blinds-name" style="text-align: left"></p> <!--hay que agregar el nombre que eligio el usuario-->
              </div>
              <label for="blinds-change-name" class="control-label col-sm-4" style="text-align: right">Change name:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" id="blinds-change-name" placeholder="Enter new name" name="blinds-change-name">
                <p class="error" id="error-name-blind">The name must have between 3 and 30 characters </p>
                <p class="error" id="error-nameExist-blind">This name already exists</p>
              </div>
              <br>
              <label for="blinds-description" class="control-label col-sm-4" style="text-align: right">Description:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="blinds-description" style="text-align: left"> </p> <!--hay que agregar la descripcion que puso el usuario si es que la hubo, y "none" si es que no puso nada-->
              </div>
              <label for="blinds-change-description" class="control-label col-sm-4" style="text-align: right">Change description:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" placeholder="Enter new description" name="blinds-change-description" id="blinds-change-description">
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="blinds-status" class="control-label col-sm-4" style="text-align: right">Status:</label>
              <div class="col-sm-8">
                <input type="checkbox" data-toggle="toggle" data-on="Open" data-off="Closed"  id="blinds-switch" data-width="82"/>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="saveChangesBlinds()">Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-default pull-left" onclick="deleteBlinds()"><span class="glyphicon glyphicon-trash"></span> Delete</button>
        </div>
      </div>  
    </div>
  </div>

    <!-- Modal de lamp -->
  <div class="modal fade" id="device-lamp" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title text-center">Lamp</h3>
        </div>
        <div class="modal-body">
          <form class="form-horizontal">
            <div class="form-group">
              <label for="lamp-name" class="control-label col-sm-4" style="text-align: right">Name:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="lamp-name" style="text-align: left"></p> <!--hay que agregar el nombre que eligio el usuario-->
              </div>
              <label for="lamp-change-name" class="control-label col-sm-4" style="text-align: right">Change name:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" id="lamp-change-name" placeholder="Enter new name" name="lamp-change-name">
                <p class="error" id="error-name-lamp">The name must have between 3 and 30 characters </p>
                <p class="error" id="error-nameExist-lamp">This name already exists</p>
              </div>
              <br>
              <label for="lamp-description" class="control-label col-sm-4" style="text-align: right">Description:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="lamp-description" style="text-align: left"></p> <!--hay que agregar la descripcion que puso el usuario si es que la hubo, y "none" si es que no puso nada-->
              </div>
              <label for="lamp-change-description" class="control-label col-sm-4" style="text-align: right">Change description:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" id="lamp-change-description" placeholder="Enter new description" name="lamp-change-description">
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="lamp-status" class="control-label col-sm-4" style="text-align: right">Status:</label>
              <div class="col-sm-8">
                <input type="checkbox" data-toggle="toggle" id="lamp-switch">
              </div>      
              <br>
              <p class="trampa">a</p>
              <label for="lamp-change-brightness" class="control-label col-sm-4" style="text-align: right">Set brightness:</label>
              <div class="col-sm-8">
                <input type="number" class="form-control" id="lamp-change-brightness" placeholder="Enter brightness (0 - 100)" name="lamp-change-brightness" min="0" max="100"> <!--hay que verificar que sea un numero entre 0 y 100-->
                <p class="error" id="error-lamp-brightness">The brightness must be between 0 and 100</p>
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="lamp-change-color" class="control-label col-sm-4" style="text-align: right">Select color:</label>
              <div class="col-sm-8">
                <div id="cp3" class="input-group colorpicker-component">
                  <input type="text" value="#00AABB" class="form-control" id="lamp-change-color" placeholder="Enter hexadecimal color">
                  <span class="input-group-addon"><i></i></span>
                </div>
                <p class="error" id="error-lamp-color">The color must be between #000000 and #FFFFFF</p>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="saveChangesLamp()">Accept</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-default pull-left" onclick="deleteLamp()"><span class="glyphicon glyphicon-trash"></span> Delete</button>
        </div>
      </div>
    </div>
  </div>

      <!-- Modal de oven -->
  <div class="modal fade" id="device-oven" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Oven</h3>
        </div>
        <div class="modal-body">
          <form class="form-horizontal">
            <div class="form-group">
              <label for="oven-name" class="control-label col-sm-5" style="text-align: right;">Name:</label>
              <div class="col-sm-7">
                <p class="form-control-static" id="oven-name" style="text-align: left"></p> <!--hay que agregar el nombre que eligio el usuario-->
              </div>
              <label for="oven-change-name" class="control-label col-sm-5" style="text-align: right">Change name:</label>
              <div class="col-sm-7">
                <input type="text" class="form-control" id="oven-change-name" placeholder="Enter new name" name="oven-change-name">
                <p class="error" id="error-name-oven">The name must have between 3 and 30 characters </p>
                <p class="error" id="error-nameExist-oven">This name already exists</p>
              </div>
              <br>
              <label for="oven-description" class="control-label col-sm-5" style="text-align: right">Description:</label>
              <div class="col-sm-7">
                <p class="form-control-static" id="oven-description" style="text-align: left"></p> <!--hay que agregar la descripcion que puso el usuario si es que la hubo, y "none" si es que no puso nada-->
              </div>
              <label for="oven-change-description" class="control-label col-sm-5" style="text-align: right">Change description:</label>
              <div class="col-sm-7">
                <input type="text" class="form-control" id="oven-change-description" placeholder="Enter new description" name="oven-change-description">
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="oven-status" class="control-label col-sm-5" style="text-align: right">Status:</label>
              <div class="col-sm-7">
                <input type="checkbox" data-toggle="toggle" id="oven-switch">
              </div> 
              <br>
              <p class="trampa">a</p>
              <label for="oven-change-temperature" class="control-label col-sm-5" style="text-align: right;">Set temperature:</label>
              <div class="col-sm-7">
                <input type="number" class="form-control" id="oven-change-temperature" placeholder="Enter temperature (90 - 230)" name="oven-change-temperature" min="90" max="230">    <!--hay que verificar que este entre 90 y 230-->
                <p class="error" id="error-oven-temperature">The temperature must be between 90 and 230</p>
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="oven-change-heatmode" class="control-label col-sm-5" style="text-align: right;">Select heat mode:</label>
              <div class="col-sm-7">
                <select class="form-control" id="oven-change-heatmode">
                    <option val="conventional">Conventional</option>
                    <option val="bottom">Bottom</option>
                    <option val="top">Top</option>
                  </select>
                  <p class="error" id="error-oven-heatmode">You must select an option</p>
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="oven-change-grillmode" class="control-label col-sm-5" style="text-align: right;">Select grill mode:</label>
              <div class="col-sm-7">
                <select class="form-control" id="oven-change-grillmode">
                    <option val="large">Large</option>
                    <option val="eco">Eco</option>
                    <option val="off">Off</option>
                  </select>
                  <p class="error" id="error-oven-grillmode">You must select an option</p>
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="oven-change-convectionmode" class="control-label col-sm-5" style="text-align: right;">Select convection mode:</label>
              <div class="col-sm-7">
                <select class="form-control" id="oven-change-convectionmode">
                    <option val="normal">Normal</option>
                    <option val="eco">Eco</option>
                    <option val="off">Off</option>
                  </select>
                  <p class="error" id="error-oven-convectionmode">You must select an option</p>
              </div>
            </div> 
          </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="saveChangesOven()">Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-default pull-left" onclick="deleteOven()"><span class="glyphicon glyphicon-trash"></span> Delete</button>
        </div>
      </div>  
    </div>
  </div>

  <!-- Modal de ac -->
  <div class="modal fade" id="device-ac" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Ac</h3>
        </div>
        <div class="modal-body">
          <form class="form-horizontal">
            <div class="form-group">
              <label for="ac-name" class="control-label col-sm-5" style="text-align: right;">Name:</label>
              <div class="col-sm-7">
                <p class="form-control-static" id="ac-name" style="text-align: left"></p> <!--hay que agregar el nombre que eligio el usuario-->
              </div>
              <label for="ac-change-name" class="control-label col-sm-5" style="text-align: right">Change name:</label>
              <div class="col-sm-7">
                <input type="text" class="form-control" id="ac-change-name" placeholder="Enter new name" name="ac-change-name">
                <p class="error" id="error-name-ac">The name must have between 3 and 30 characters </p>
                <p class="error" id="error-nameExist-ac">This name already exists</p>
              </div>
              <br>
              <label for="ac-description" class="control-label col-sm-5" style="text-align: right">Description:</label>
              <div class="col-sm-7">
                <p class="form-control-static" id="ac-description" style="text-align: left"></p> <!--hay que agregar la descripcion que puso el usuario si es que la hubo, y "none" si es que no puso nada-->
              </div>
              <label for="ac-change-description" class="control-label col-sm-5" style="text-align: right">Change description:</label>
              <div class="col-sm-7">
                <input type="text" class="form-control" id="ac-change-description" placeholder="Enter new description" name="ac-change-description">
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="ac-status" class="control-label col-sm-5" style="text-align: right">Status:</label>
              <div class="col-sm-7">
                <input type="checkbox" data-toggle="toggle" id="ac-switch">
              </div> 
              <br>
              <p class="trampa">a</p>
              <label for="ac-change-temperature" class="control-label col-sm-5" style="text-align: right;">Set temperature:</label>
              <div class="col-sm-7">
                <input type="number" class="form-control" id="ac-change-temperature" placeholder="Enter temperature (18 - 38)" name="ac-change-temperature" min="18" max="38">    <!--hay que verificar que este entre 18 y 38-->
                <p class="error" id="error-ac-temperature">The temperature must be between 18 and 38</p>
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="ac-change-mode" class="control-label col-sm-5" style="text-align: right;">Select mode:</label>
              <div class="col-sm-7">
                <select class="form-control" id="ac-change-mode">
                    <option val="cool">Cool</option>
                    <option val="heat">Heat</option>
                    <option val="fan">Fan</option>
                  </select>
                  <p class="error" id="error-ac-mode">You must select an option</p>
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="ac-change-verticalswing" class="control-label col-sm-5" style="text-align: right;">Select vertical swing:</label>
              <div class="col-sm-7">
                <select class="form-control" id="ac-change-verticalswing">
                    <option val="auto">Auto</option>
                    <option val="22">22°</option>
                    <option val="45">45°</option>
                    <option val="67">67°</option>
                    <option val="90">90°</option>
                  </select>
                  <p class="error" id="error-ac-verticalswing">You must select an option</p>
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="ac-change-horizontalswing" class="control-label col-sm-5" style="text-align: right;">Select horizontal swing:</label>
              <div class="col-sm-7">
                <select class="form-control" id="ac-change-horizontalswing">
                    <option val="auto">Auto</option>
                    <option val="-90">-90°</option>
                    <option val="-45">-45°</option>
                    <option val="0">0°</option>
                    <option val="45">45°</option>
                    <option val="90">90°</option>
                  </select>
                  <p class="error" id="error-ac-horizontalswing">You must select an option</p>
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="ac-change-fanspeed" class="control-label col-sm-5" style="text-align: right;">Select fan speed:</label>
              <div class="col-sm-7">
                <select class="form-control" id="ac-change-fanspeed">
                    <option val="auto">Auto</option>
                    <option val="25">25</option>
                    <option val="50">50</option>
                    <option val="75">75</option>
                    <option val="100">100</option>
                  </select>
                  <p class="error" id="error-ac-fanspeed">You must select an option</p>
              </div>
            </div> 
          </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="saveChangesAc()">Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-default pull-left" onclick="deleteAc()"><span class="glyphicon glyphicon-trash"></span> Delete</button>
        </div>
      </div>  
    </div>
  </div>
      
  <!-- MODAL DE DOOR-->
  <div class="modal fade" id="device-door" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Door</h3>
        </div>
        <div class="modal-body">
          <form class="form-horizontal">
            <div class="form-group">
              <label for="door-name" class="control-label col-sm-4" style="text-align: right;">Name:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="door-name" style="text-align: left"></p> <!--hay que agregar el nombre que eligio el usuario-->
              </div>
              <label for="door-change-name" class="control-label col-sm-4" style="text-align: right">Change name:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" id="door-change-name" placeholder="Enter new name" name="door-change-name">
                <p class="error" id="error-name-door">The name must have between 3 and 30 characters </p>
                <p class="error" id="error-nameExist-door">This name already exists</p>
              </div>
              <br>
              <label for="door-description" class="control-label col-sm-4" style="text-align: right">Description:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="door-description" style="text-align: left" id="door-description"> </p> <!--hay que agregar la descripcion que puso el usuario si es que la hubo, y "none" si es que no puso nada-->
              </div>
              <label for="door-change-description" class="control-label col-sm-4" style="text-align: right">Change description:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" placeholder="Enter new description" name="door-change-description" id="door-change-description">
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="door-status" class="control-label col-sm-4" style="text-align: right">Status:</label>
              <div class="col-sm-8">
                <input type="checkbox" data-toggle="toggle" data-on="Open" data-off="Closed" id="door-switch" data-width="82">
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="door-lock" class="control-label col-sm-4" style="text-align: right">Lock state:</label>
              <div class="col-sm-8">
                <input type="checkbox" data-toggle="toggle" data-on="Locked" data-off="Unlocked" id="lock-switch" data-width="100">
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="saveChangesDoor()">Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-default pull-left" onclick="deleteDoor()"><span class="glyphicon glyphicon-trash"></span> Delete</button>
        </div>
      </div>  
    </div>
  </div>

  <!-- Modal de refrigerator-->
  <div class="modal fade" id="device-refrigerator" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Refrigerator</h3>
        </div>
        <div class="modal-body">
          <form class="form-horizontal">
            <div class="form-group">
              <label for="refrigerator-name" class="control-label col-sm-5" style="text-align: right;">Name:</label>
              <div class="col-sm-7">
                <p class="form-control-static" id="refrigerator-name" style="text-align: left"></p> <!--hay que agregar el nombre que eligio el usuario-->
              </div>
              <label for="refrigerator-change-name" class="control-label col-sm-5" style="text-align: right">Change name:</label>
              <div class="col-sm-7">
                <input type="text" class="form-control" id="refrigerator-change-name" placeholder="Enter new name" name="refrigerator-change-name">
                <p class="error" id="error-name-refrigerator">The name must have between 3 and 30 characters </p>
                <p class="error" id="error-nameExist-refrigerator">This name already exists</p>
              </div>
              <br>
              <label for="refrigerator-description" class="control-label col-sm-5" style="text-align: right">Description:</label>
              <div class="col-sm-7">
                <p class="form-control-static" id="refrigerator-description" style="text-align: left"></p> <!--hay que agregar la descripcion que puso el usuario si es que la hubo, y "none" si es que no puso nada-->
              </div>
              <label for="refrigerator-change-description" class="control-label col-sm-5" style="text-align: right">Change description:</label>
              <div class="col-sm-7">
                <input type="text" class="form-control" id="refrigerator-change-description" placeholder="Enter new description" name="refrigerator-change-description">
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="refrigerator-change-temperature" class="control-label col-sm-5" style="text-align: right;">Set temperature:</label>
              <div class="col-sm-7">
                <input type="number" class="form-control" id="refrigerator-change-temperature" placeholder="Enter temperature (2 - 8)" name="refrigerator-change-temperature" min="2" max="8">
                <p class="error" id="error-refrigerator-temperature">The temperature must be between 2 and 8</p>
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="refrigerator-change-freezertemperature" class="control-label col-sm-5" style="text-align: right;">Set freezer temperature:</label>
              <div class="col-sm-7">
                <input type="number" class="form-control" id="refrigerator-change-freezertemperature" placeholder="Enter temperature ((-20) - (-8))" name="refrigerator-change-freezertemperature" min="-20" max="-8">
                <p class="error" id="error-refrigerator-freezertemperature">The freezer temperature must be between -20 and -8</p>
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="refrigerator-change-mode" class="control-label col-sm-5" style="text-align: right;">Select mode:</label>
              <div class="col-sm-7">
                <select class="form-control" id="refrigerator-change-mode">
                    <option val="default">Default</option>
                    <option val="vacation">Vacation</option>
                    <option val="party">Party</option>
                  </select>
                  <p class="error" id="error-refrigerator-mode">You must select an option</p>
              </div>
            </div> 
          </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="saveChangesRefrigerator()">Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-default pull-left" onclick="deleteFridge()"><span class="glyphicon glyphicon-trash"></span> Delete</button>
        </div>
      </div>  
    </div>
  </div>  

<!-- Notification-->
<div class="notification" id="notification">
    <div class="body-notification">
        <div class="body-text-not">
            <p class="body-text"><span class="glyphicon glyphicon-ok"></span> Changes saved</p>
        </div>
    </div> 
</div>
<!-- End page content -->
  
  
<script>

var actualRoomName;

$(document).ready(function(){
    $("#new-room").click(function(){
        document.getElementById("room-name").value = "";
        document.getElementById("room-description").value = "";
        cleanAllErrors();
        $("#room").modal();
    });
});

$(document).ready(function(){
    $("#close-create-room").click(function(){
        $("#room").modal("hide");
    });
});

$(document).ready(function(){
    $("#cancel-modify-room").click(function(){
        $("#modify-room").modal("hide");
        document.getElementById("new-room-name").value = "";
    });
});

$(document).ready(function(){
    $("#cancel-icon-modify-room").click(function(){
        $("#modify-room").modal("hide");
        document.getElementById("new-room-name").value = "";
    });
});

$(document).ready(function () {
    $('#lamp-switch').on('change', function () {
        DisableLampOptions()
    });
});

$(document).ready(function () {
    $('#oven-switch').on('change', function () {
        DisableOvenOptions()
    });
});

$(document).ready(function () {
    $('#ac-switch').on('change', function () {
        DisableAcOptions()
    });
});

$(document).ready(function () {
    $('#door-switch').on('change', function () {
        DisableDoorOptions()
    });
});

/* Esto es para que el enter no haga nada */
addEventListener("keydown", function(event) {
    if (event.keyCode == 13){
    }
 });



function cancelRoom(){
    document.getElementById("room-name").value = "";
    $("#room").modal("hide");
}


var api = class {
  static get baseUrl() {
    return "http://127.0.0.1:8080/api/";
  }

  static get timeout() {
    return 60 * 1000;
  }
}
api.room = class {
  static get url() {
    return api.baseUrl + "rooms/";
  }

  static add(room) {
   return $.ajax({
      url: api.room.url,
      method: "POST",
      dataType: "json",
      timeout: api.timeout,
      async: false,
      data: room
    }); 
  }

  static modify(room) {
   return $.ajax({
      url: api.room.url + room.id,
      method: "PUT",
      dataType: "json",
      timeout: api.timeout,
      async: false,
      data: room
    }); 
  }

  static delete(id) {
   return $.ajax({
      url: api.room.url + id,
      method: "DELETE",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    }); 
  }

  static get(id) {
    return $.ajax({
      url: api.room.url + id,
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static getRoomDevices(id) {
    return $.ajax({
      url: api.room.url + id + "/devices",
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }


  static getAll(){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/rooms",
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }
}

api.device = class {
  static get url() {
    return api.baseUrl + "devices/";
  }

  static add(device) {
   return $.ajax({
      url: api.device.url,
      method: "POST",
      dataType: "json",
      timeout: api.timeout,
      async: false,
      data: device
    }); 
  }

  static modify(device) {
   return $.ajax({
      url: api.device.url + device.id,
      method: "PUT",
      dataType: "json",
      timeout: api.timeout,
      async: false,
      data:device
    }); 
  }

  static delete(id) {
   return $.ajax({
      url: api.device.url + id,
      method: "DELETE",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    }); 
  }

  static get(id) {
    return $.ajax({
      url: api.device.url + id,
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static linkToRoom(idDevice,idRoom){
      return $.ajax({
      url: "http://127.0.0.1:8080/api" + /devices/+ idDevice + /rooms/ + idRoom,
      method: "POST",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static getAll(){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices",
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static getTypes(){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devicetypes",
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static getType(id){
      return $.ajax({
      url: "http://127.0.0.1:8080/api/devicetypes/" + id,
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static getState(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/getState",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }
}

api.blind = class{

  constructor(id,typeId,name,description){
    this.id = id;
    this.typeId = typeId;
    this.name = name;
    this.description = description;
  }

  up(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "up",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }

  down(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "down",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }

}

api.lamp = class {

    constructor(id,typeId,name,description){
    this.id = id;
    this.typeId = typeId;
    this.name = name;
    this.description = description;
  }
    turnOn(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "turnOn",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }

    turnOff(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "turnOff",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }
    
    changeBrightness(deviceID,integer){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "changeBrightness",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
      data: integer
    });
  }


    changeColor(deviceID,string){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "changeColor",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
      data: string
    });
  }
}
  api.oven = class {

    constructor(id,typeId,name,description){
    this.id = id;
    this.typeId = typeId;
    this.name = name;
    this.description = description;
  }
    turnOn(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "turnOn",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }

    turnOff(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "turnOff",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }
    
    setTemperature(deviceID,integer){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "setTemperature",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
      data: integer
    });
  }

  setHeat(deviceID,integer){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "setHeat",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
      data: integer
    });
  }

  setGrill(deviceID,integer){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "setGrill",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
      data: integer
    });
  }

  setConvection(deviceID,integer){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "setConvection",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
      data: integer
    });
  }
}

  api.ac = class {

    constructor(id,typeId,name,description){
    this.id = id;
    this.typeId = typeId;
    this.name = name;
    this.description = description;
  }
    turnOn(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "turnOn",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }

    turnOff(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "turnOff",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }
    
    setTemperature(deviceID,integer){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "setTemperature",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
      data: integer
    });
  }

  setMode(deviceID,integer){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "setMode",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
      data: integer
    });
  }

  setVerticalSwing(deviceID,integer){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "setVerticalSwing",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
      data: integer
    });
  }

  setHorizontalSwing(deviceID,integer){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "setHorizontalSwing",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
      data: integer
    });
  }


  setFanSpeed(deviceID,integer){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "setFanSpeed",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
      data: integer
    });
  }
}

  api.door = class {

    constructor(id,typeId,name,description){
    this.id = id;
    this.typeId = typeId;
    this.name = name;
    this.description = description;
  }
    open(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "open",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }

    close(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "close",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }
    
    lock(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "lock",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
    });
  }

  unlock(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "unlock",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
    });
  }

}
  api.refrigerator = class {

  constructor(id,typeId,name,description){
    this.id = id;
    this.typeId = typeId;
    this.name = name;
    this.description = description;
  }
  
  setFreezerTemperature(deviceID,integer){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "setFreezerTemperature",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
      data: integer
    });
  }

  setTemperature(deviceID,integer){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "setTemperature",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
      data: integer
    });
  }

    setMode(deviceID,integer){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "setMode",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
      data: integer
    });
  }

}

api.model = api.model || {};

api.model.room = class {
  constructor(id, name, meta) {
    if (id) {
      this.id = id;
    } else {
      delete(this.id);
    }
    this.name = name;
    this.meta = meta;
  }
}

api.model.device = class {
  constructor(typeId, name, meta) {
    if (typeId) {
      this.typeId = typeId;
    } else {
      delete(this.typeId);
    }
    this.name = name;
    this.meta = meta;
  }
}

api.model.action = class{
    constructor(name,params) {
     this.name = name;
     this.params = params;
  }
}



function getNameRoom(){
    var name = document.getElementById("room-name").value;
    return name;
}


function createRoom(){
cleanAllErrors()
if(! isAlphaNumeric(getNameRoom())){
  document.getElementById("error-nameRoomAlpha").style.display = "block";
  return;
}

if( document.getElementById(getNameRoom())){
    document.getElementById("error-nameRoomExist").style.display = "block"
    return;
}

if(getNameRoom() == "" || getNameRoom().length < 3 || getNameRoom().length > 30){
    document.getElementById("error-nameRoomLength").style.display = "block";
    return;
}


var div = document.createElement("div");
div.classList.add("span-a");
var para = document.createElement("a");//Creo el tipo de elemento
para.setAttribute("id", getNameRoom() + "room");
var node = document.createTextNode(getNameRoom()); //le digo su contenido
para.setAttribute("type", getNameRoom());
para.setAttribute("onclick", "showDevicesRoom(this);");
para.setAttribute("href","#");
para.appendChild(node);
para.className = "chargeDiv";
var button = document.createElement("button");
button.setAttribute("onclick", "modifyRoom(this);");
button.setAttribute("id", getNameRoom());
button.classList.add("mod-room");
button.classList.add("mod-room-pencil");
var span = document.createElement("span");
span.classList.add("glyphicon");
span.classList.add("glyphicon-pencil");
var button1 = document.createElement("button");
button1.setAttribute("onclick", "confirmDelete(this);");
button1.setAttribute("id", getNameRoom() + "trash");
button1.setAttribute("data-info",getNameRoom());
button1.classList.add("mod-room");
var span1 = document.createElement("span");
span1.classList.add("glyphicon");
span1.classList.add("glyphicon-trash");
button.appendChild(span);
button1.appendChild(span1);
div.appendChild(para);
div.appendChild(button);
div.appendChild(button1);
var element = document.getElementById("ver-menu");
element.appendChild(div);
createRightContainer(getNameRoom());
var roomDesc = document.getElementById("room-description").value
if(roomDesc == "")
  roomDesc = "None"
button.setAttribute("data-desc", roomDesc)
var room = new api.model.room(null, getNameRoom(), roomDesc);
api.room.add(room)
.fail(function (jqXHR, textStatus) {
   ("#data-base-error").modal()
})
$("#room").modal("hide");
}

function cleanAllErrors(){
    document.getElementById("error-nameRoomLength").style.display = "none";  
    document.getElementById("error-nameRoomExist").style.display = "none";
    document.getElementById("error-nameRoomAlpha").style.display = "none";  
    document.getElementById("error-nameNewRoomAlpha").style.display = "none";
    document.getElementById("error-nameDeviceLength").style.display = "none";
    document.getElementById("error-nameNewRoomExist").style.display = "none";
    document.getElementById("error-nameNewRoomLength").style.display = "none";
    document.getElementById("error-deviceType").style.display = "none"
    document.getElementById("error-name-blind").style.display = "none"
    document.getElementById("error-name-lamp").style.display = "none"
    document.getElementById("error-name-oven").style.display = "none"
    document.getElementById("error-name-ac").style.display = "none"
    document.getElementById("error-name-door").style.display = "none"
    document.getElementById("error-name-refrigerator").style.display = "none"
    document.getElementById("error-nameExist-blind").style.display = "none"
    document.getElementById("error-nameExist-lamp").style.display = "none"
    document.getElementById("error-nameExist-oven").style.display = "none"
    document.getElementById("error-nameExist-ac").style.display = "none"
    document.getElementById("error-nameExist-door").style.display = "none"
    document.getElementById("error-nameExist-refrigerator").style.display = "none"
    document.getElementById("error-lamp-color").style.display = "none"
    document.getElementById("error-lamp-brightness").style.display = "none"
    document.getElementById("error-oven-temperature").style.display = "none"
    document.getElementById("error-oven-heatmode").style.display = "none"
    document.getElementById("error-oven-grillmode").style.display = "none"
    document.getElementById("error-oven-convectionmode").style.display = "none"
    document.getElementById("error-ac-temperature").style.display = "none"
    document.getElementById("error-ac-mode").style.display = "none"
    document.getElementById("error-ac-verticalswing").style.display = "none"
    document.getElementById("error-ac-horizontalswing").style.display = "none"
    document.getElementById("error-ac-fanspeed").style.display = "none"
    document.getElementById("error-refrigerator-temperature").style.display = "none"
    document.getElementById("error-refrigerator-freezertemperature").style.display = "none"
    document.getElementById("error-refrigerator-mode").style.display = "none"
    document.getElementById("error-exist-device-name").style.display = "none"
}


function loadAll(){
  api.room.getAll()
  .done(function (data) {
    // data tiene el valor retornado por la petición Ajax
    loadRooms(data)
    loadDevices(data)
  })
  .fail(function (jqXHR, textStatus) {
    ("#data-base-error").modal()
  })
  
  api.device.getTypes()
  .done(function (data) {
    updateNewDeviceModal(data)
  })
  .fail(function (jqXHR, textStatus) {
  })  
  
}

function loadRooms(data){
  var allRooms = data;
  for (var i = 0; i < allRooms.rooms.length; i++) {
      loadRoom(allRooms.rooms[i])
  }
}

function loadRoom(room){
  var roomName = room.name
  var roomDesc = room.meta
  var div = document.createElement("div");
  div.classList.add("span-a");
  var para = document.createElement("a");//Creo el tipo de elemento
  para.setAttribute("id", roomName + "room");
  var node = document.createTextNode(roomName); //le digo su contenido
  para.setAttribute("type", roomName);
  para.setAttribute("onclick", "showDevicesRoom(this);");
  para.setAttribute("href","#");
  para.appendChild(node);
  para.className = "chargeDiv";
  var button = document.createElement("button");
  button.setAttribute("onclick", "modifyRoom(this);");
  button.setAttribute("id", roomName);
  button.setAttribute("data-desc", room.meta)
  button.classList.add("mod-room");
  button.classList.add("mod-room-pencil");
  var span = document.createElement("span");
  span.classList.add("glyphicon");
  span.classList.add("glyphicon-pencil");
  var button1 = document.createElement("button");
  button1.setAttribute("onclick", "confirmDelete(this);");
  button1.setAttribute("id", roomName + "trash");
  button1.setAttribute("data-info",roomName);
  button1.classList.add("mod-room");
  var span1 = document.createElement("span");
  span1.classList.add("glyphicon");
  span1.classList.add("glyphicon-trash");
  button.appendChild(span);
  button1.appendChild(span1);
  div.appendChild(para);
  div.appendChild(button);
  div.appendChild(button1);
  var element = document.getElementById("ver-menu");
  element.appendChild(div);
  createRightContainer(roomName);
}

function isAlphaNumeric(str) {
  var code, i, len;
  for (i = 0, len = str.length; i < len; i++) {
    code = str.charCodeAt(i);
    if (!(code > 47 && code < 58) && // numeric (0-9)
        !(code > 64 && code < 91) && // upper alpha (A-Z)
        !(code > 96 && code < 123) && // lower alpha (a-z)
        !(code == '-')) {         // '-'
      return false;
    }
  }
  return true;
}

function createRightContainer(roomName){

  var hiddenDiv = document.getElementById("hidden-div");

    var div = document.createElement("div");
    var idDivName = roomName + "holder";
    div.classList.add("right-container");
    div.setAttribute("id", idDivName);
    var div2 = document.createElement("div");
    div2.classList.add("wrapper-room-title-two");
    var h1 = document.createElement("h1");
    h1.classList.add("title-right-container");
    var h1Id = "title-room-" + roomName;
    h1.setAttribute("id",h1Id);
    var node = document.createTextNode(roomName);
    h1.appendChild(node);
    var hr = document.createElement("hr");
    hr.classList.add("right-fine-line");
    
    var div3 = document.createElement("div");
    div3.classList.add("wrapper-devices-container");
    var div4 = document.createElement("div");
    div4.classList.add("devices-container");
    div4.setAttribute("id", roomName + "devices-container");
    var div5 = document.createElement("div");
    div5.classList.add("device-container");
    var button = document.createElement("button");
    button.classList.add("create-device");
    button.setAttribute("onclick","openCreateDeviceModal();");
    var tag = document.createElement("div");
    tag.classList.add("my-display-topleft");
    tag.classList.add("my-black");
    tag.classList.add("my-padding");
    tag.innerHTML = "Add Device";
    var idButtonName = roomName + "new-device";
    button.setAttribute("id", idButtonName);
    
    
    hiddenDiv.appendChild(div);
    div.appendChild(div2);
    div.appendChild(div3);
    
    div2.appendChild(h1);
    div2.appendChild(hr);
    
    div3.appendChild(div4);
    div4.appendChild(div5);
    
    div5.appendChild(button);
    div5.appendChild(tag);

}

function showDevicesRoom(nameRoom){
  var hiddenDiv = document.getElementById("hidden-div")
  var mainDiv = document.getElementById("main-container");
  requiredDiv = mainDiv.children[1];
  clone = requiredDiv.cloneNode(true);//problema espacio
  hiddenDiv.appendChild(clone);
  var idName = "#" + nameRoom.getAttribute("type") + "holder";
  var idName2 = nameRoom.getAttribute("type") + "holder";
  var idRightDevicesContainer = document.getElementById(nameRoom.getAttribute("type") + "devices-container")
  var modalDevice = document.getElementById("device");
  actualRoomName = nameRoom.getAttribute("type");
  modalDevice.setAttribute("type", idRightDevicesContainer.getAttribute("id"));
  $(requiredDiv).replaceWith($(idName));
}

function createTag(deviceName){
    var tag = document.createElement("div");
    tag.classList.add("my-display-topleft");
    tag.classList.add("my-black");
    tag.classList.add("my-padding");

    if(deviceName.length > 23){
      tag.innerHTML = deviceName.substring(0, 21) + "...";
    }else
      tag.innerHTML = deviceName;
      
    return tag;
}

function showInitialDevicesRoom(){
  var hiddenDiv = document.getElementById("hidden-div")
  var mainDiv = document.getElementById("main-container");
  requiredDiv = mainDiv.children[1];
  $(requiredDiv).replaceWith( $("#starter-right-container"));
}

function modifyRoom(button){
 document.getElementById("new-room-name").value = ""
 document.getElementById("new-room-description").value = ""
 document.getElementById("modify-room-header").setAttribute("type",button.getAttribute('id'));
 document.getElementById("modify-room-header").setAttribute("type-desc",button.getAttribute("data-desc"))
 var roomName = button.getAttribute('id');
 var roomDesc = button.getAttribute("data-desc")
 document.getElementById("actual-room-name").innerHTML = roomName;
 document.getElementById("actual-room-description").innerHTML = roomDesc;
 cleanAllErrors()
 $("#modify-room").modal();
}

function getNewNameRoom(){
    var newName = document.getElementById("new-room-name").value;
    return newName;
}

function changeName(){
  cleanAllErrors()
  var newName = getNewNameRoom()
  if(! isAlphaNumeric(newName)){
    document.getElementById("error-nameNewRoomAlpha").style.display = "block";
    return;
  }

if((newName == "" && getNewDescRoom() == "") || (newName.length < 3 && newName.length != 0) || newName.length > 30){
    document.getElementById("error-nameNewRoomLength").style.display = "block";
    return;
}

if( document.getElementById(newName)){
    document.getElementById("error-nameNewRoomExist").style.display = "block"
    return;
}

    var info = document.getElementById("modify-room-header");
    if(newName.length == 0){
     newName = info.getAttribute("type")
    }
    var oldName = info.getAttribute("type")
    var trashButton = document.getElementById(info.getAttribute("type") + "trash");
    var rightContainer = document.getElementById(info.getAttribute("type") + "holder")
    var idroom = info.getAttribute("type") + "room";
    var idbutton = info.getAttribute("type");
    var editButton = document.getElementById(idbutton);
    var titleId = "title-room-" + info.getAttribute("type");
    var title = document.getElementById(titleId);
    var newTitle = newName;
    var newDeviceButton = document.getElementById(info.getAttribute("type") + "new-device");
    title.innerHTML = newTitle;
    var room = document.getElementById(idroom);
    var devCont = document.getElementById(info.getAttribute("type") + "devices-container");
    devCont.setAttribute("id", newName + "devices-container");
    newDeviceButton.setAttribute("id", newName + "new-device")
    room.setAttribute("id",newName + "room");
    room.setAttribute("type", newName);
    title.setAttribute("id", "title-room-" + newTitle);
    editButton.setAttribute("id",newName);
    trashButton.setAttribute("data-info",newName);
    trashButton.setAttribute("id", newName + "trash")
    rightContainer.setAttribute("id" , newName + "holder")
    room.innerHTML = newName;
    if(actualRoomName == info.getAttribute("type")){
      actualRoomName = newName
      var modalDevice = document.getElementById("device");
      modalDevice.setAttribute("type", devCont.getAttribute("id"));
    }
    document.getElementById("new-room-name").value = "";
    info.setAttribute("type", newName);
    if(document.getElementById("new-room-description").value.length != 0)
      editButton.setAttribute("data-desc", document.getElementById("new-room-description").value)
    modifyRoomFromDB(oldName,newName)
    document.getElementById("new-room-description").value = "";
    $("#modify-room").modal("hide");

}

function getNewDescRoom(){
  return document.getElementById("new-room-description").value
}

function modifyRoomFromDB(roomName, newRoomName){

  api.room.getAll()
  .done(function (data) {
    findAndUpdate(data,roomName,newRoomName)
  })
  .fail(function (jqXHR, textStatus) {
    ("#data-base-error").modal()
  })
}

function findAndUpdate(data,roomName,newRoomName){
  var allRooms = data;
  var idRoom;
  var actualDescRoom;
  for (var i = 0; i < allRooms.rooms.length; i++) {
      if(roomName == allRooms.rooms[i].name){
        idRoom = allRooms.rooms[i].id;
        actualDescRoom = allRooms.rooms[i].meta
      }
  }
  var roomDesc = getNewDescRoom();
  if(roomDesc == "")
    roomDesc = actualDescRoom
  var modifiedRoom = new api.model.room(idRoom, newRoomName, roomDesc);
  api.room.modify(modifiedRoom)
   .fail(function (jqXHR, textStatus) {
    ("#data-base-error").modal()
  })
}

function confirmDelete(roomName){
    $("#modify-room").modal("hide");
    updateRoomToDelete(roomName);
    $("#confirmation-Delete").modal();
    document.getElementById("confirmation-Delete-name").innerHTML = "Delete " + roomName.getAttribute("data-info") + "?";
}

function updateRoomToDelete(roomName){
  var updateName = roomName.getAttribute("data-info");
  document.getElementById("modify-room-header").setAttribute("type",updateName);

}

function closeConfirmationRoomDelete(){
    $("#confirmation-Delete").modal("hide");
    $("#modify-room").modal();
}

function removeRoom(){  
    var info = document.getElementById("modify-room-header");
    var rightContainer = document.getElementById(info.getAttribute("type") + "holder")
    var idroom = info.getAttribute("type") + "room";
    var room = document.getElementById(idroom);
    var parentRoom = room.parentNode
    parentRoom.parentNode.removeChild(parentRoom);
    if(actualRoomName == info.getAttribute("type")){
      showInitialDevicesRoom();
    }
    document.getElementById("hidden-div").appendChild(rightContainer);
    rightContainer.parentNode.removeChild(rightContainer);
    $("#confirmation-Delete").modal("hide");
    removeRoomFromDB(info.getAttribute("type"))
}

function removeRoomFromDB(roomName){
  api.room.getAll()
  .done(function (data) {
    findAndDelete(data,roomName)
  })
  .fail(function (jqXHR, textStatus) {
    ("#data-base-error").modal()
  })
}

function findAndDelete(data,roomName){
  var allRooms = data;
  var idRoom;
  for (var i = 0; i < allRooms.rooms.length; i++) {
      if(roomName == allRooms.rooms[i].name){
        idRoom = allRooms.rooms[i].id;
        deleteAllDevicesOfRoom(allRooms.rooms[i])
      }
  }
  api.room.delete(idRoom)
  .fail(function (jqXHR, textStatus) {
    ("#data-base-error").modal()
  })
}

function deleteAllDevicesOfRoom(room){
  api.room.getRoomDevices(room.id)
  .done(function (data) {
    deleteAllDevices(data,room)
  })
  .fail(function (jqXHR, textStatus) {
    ("#data-base-error").modal()
  })
}

function deleteAllDevices(data,room){
  var allDevices = data;
  for (var i = 0; i < allDevices.devices.length; i++){
    api.device.delete(allDevices.devices[i].id)
  }
}

function openCreateDeviceModal(){
  cleanAllErrors()
  $("#device").modal()  
}

function createDevice(){
  cleanAllErrors()
  var comboBoxTypeDevices = document.getElementById("comboBoxTypeDevices")
  var deviceTypeId = comboBoxTypeDevices.options[comboBoxTypeDevices.selectedIndex].value
  var deviceName = document.getElementById("device-name").value;
  var deviceDesc = document.getElementById("device-description").value
  var error = false;
  if(deviceTypeId == "none" && (deviceName.length < 3 || deviceName.length == 0 || deviceName.length > 30)){
    document.getElementById("error-deviceType").style.display = "block"
    document.getElementById("error-nameDeviceLength").style.display = "block"
  }
  var errorExist = document.getElementById("error-exist-device-name")
  if(deviceNameExist(deviceName,errorExist)){
  	error = true;
  }

  if(deviceTypeId == "none"){
    document.getElementById("error-deviceType").style.display = "block"
    error = true;
  }
  
  if(deviceName.length < 3 || deviceName.length == 0 || deviceName.length > 30){
    document.getElementById("error-nameDeviceLength").style.display = "block"
    error = true;
  }

  if(error == true)
  	return;

  if(deviceDesc == ""){
    deviceDesc = "None"
  }

  var description = deviceDesc;
  var newDevice = new api.model.device(deviceTypeId, deviceName, description);
  api.device.add(newDevice)
  .done(function (data) {
    addDeviceToRoom(actualRoomName,data.device.id,data.device,1);
  })
  .fail(function (jqXHR, textStatus) {
    ("#data-base-error").modal()
  })
  document.getElementById("device-name").value = "";
  document.getElementById("device-description").value = "";
  comboBoxTypeDevices.selectedIndex = "0";
  $("#device").modal("hide") 
}



function addDeviceToRoom(roomName,deviceID,device,boolean){
  api.room.getAll()
  .done(function (data) {
    findRoomForDevice(data,roomName,deviceID,device,boolean)
  })
  .fail(function (jqXHR, textStatus) {
    alert ('Request failed:' + textStatus);
  })
  
}

function findRoomForDevice(dato,roomName,deviceID,device,boolean){
  var allRooms = dato;
  var idRoom;
  var room;
  for (var i = 0; i < allRooms.rooms.length; i++) {
      if(roomName == allRooms.rooms[i].name){
        idRoom = allRooms.rooms[i].id;
        room = allRooms.rooms[i];
      }
  }
  api.device.linkToRoom(deviceID,idRoom)
  .done(function (data) {
    if(boolean == 1)
      chargeDevice(device,room)
  })
  .fail(function (jqXHR, textStatus) {
    ("#data-base-error").modal()
  })

}

function loadDevices(data){
  var allRooms = data;
  for (var i = 0; i < allRooms.rooms.length; i++) {
    getDevices(allRooms.rooms[i])
  }
}

function getDevices(room){
  api.room.getRoomDevices(room.id)
  .done(function (data) {
      chargeDevices(data,room)
  })
  .fail(function (jqXHR, textStatus) {
      ("#data-base-error").modal()
  })
}

function chargeDevices(data,room){
  var allDevices = data;
  for (var i = 0; i < allDevices.devices.length; i++){
    chargeDevice(allDevices.devices[i],room)
  }
  
}

function chargeDevice(device,room){
  var idDevicesContainer = room.name + "devices-container"
  var devicesContainer = document.getElementById(idDevicesContainer);
  var deviceContainer = document.createElement("div");
  deviceContainer.classList.add("device-container");
  deviceContainer.setAttribute("data-name",device.name)
  deviceContainer.setAttribute("data-desc",device.meta)
  deviceContainer.setAttribute("data-typeID",device.typeId)
  deviceContainer.setAttribute("data-ID",device.id)
  var buttonDevice = document.createElement("button");
  setDeviceImage(buttonDevice, device.typeId)
  buttonDevice.classList.add("new-device-button");
  buttonDevice.setAttribute("data-name",device.name)
  buttonDevice.setAttribute("data-desc",device.meta)
  buttonDevice.setAttribute("data-typeID",device.typeId)
  buttonDevice.setAttribute("data-ID",device.id)
  buttonDevice.setAttribute("id",device.id)
  deviceContainer.appendChild(buttonDevice);
  var deviceTag = createTag(device.name);
  deviceContainer.appendChild(deviceTag);
  devicesContainer.appendChild(deviceContainer);
}

function setDeviceImage(buttonDevice,deviceTypeId){
    switch(deviceTypeId) {
    case "eu0v2xgprrhhg41g":
        buttonDevice.style.backgroundImage = "url('Blinds.png')";
        buttonDevice.setAttribute("data-type","blinds");
        buttonDevice.setAttribute("onclick","viewBlindState(this)");
        break;
    case "go46xmbqeomjrsjr":
        buttonDevice.style.backgroundImage = "url('Lamp.png')";
        buttonDevice.setAttribute("data-type","lamp");
        buttonDevice.setAttribute("onclick","viewLampState(this)");
        break;
    case "im77xxyulpegfmv8":
        buttonDevice.style.backgroundImage = "url('Oven.png')";
        buttonDevice.setAttribute("data-type","oven");
        buttonDevice.setAttribute("onclick","viewOvenState(this)");
        break;
    case "li6cbv5sdlatti0j":
        buttonDevice.style.backgroundImage = "url('Ac.png')";
        buttonDevice.setAttribute("data-type","ac");
        buttonDevice.setAttribute("onclick","viewAcState(this)");
        break;
    case "lsf78ly0eqrjbz91":
        buttonDevice.style.backgroundImage = "url('Door.png')";
        buttonDevice.setAttribute("data-type","door");
        buttonDevice.setAttribute("onclick","viewDoorState(this)");
        break;
    case "rnizejqr2di0okho":
        buttonDevice.style.backgroundImage = "url('Fridge.png')";
        buttonDevice.setAttribute("data-type","refrigerator");
        buttonDevice.setAttribute("onclick","viewRefrigeratorState(this)");
        break;
    default:
        buttonDevice.style.backgroundImage = "url('Default.png')";
  }
}

function deviceNameExist(deviceName,errorElement){
  var boolean = false;
  api.device.getAll()
  .done(function (data){
      for(var i=0; i < data.devices.length ; i++){
        if(data.devices[i].name == deviceName){
            errorElement.style.display = "block"
            boolean = true;
        }
      }
  })
  .fail(function (jqXHR, textStatus) {
      ("#data-base-error").modal()
  })
  return boolean;
}

function updateNewDeviceModal(data){
  var allDevicesTypes = data;
  var typeName;
  for (var i = 0; i < allDevicesTypes.devices.length; i++){
    if((allDevicesTypes.devices[i].id != "ofglvd9gqX8yfl3l") && (allDevicesTypes.devices[i].id != "mxztsyjzsrq7iaqc")){//si no es una alarma ni un timer sigo
      typeName = allDevicesTypes.devices[i].name
      var select = document.getElementById("comboBoxTypeDevices")
      var option = document.createElement("option")
      option.setAttribute("value",allDevicesTypes.devices[i].id)
      option.innerHTML = typeName
      select.appendChild(option)
    }
  }
}

function viewBlindState(button){
   cleanAllErrors()
   document.getElementById("device-blinds").setAttribute("data-device",button.getAttribute("id"))
   updateDeviceBlindModal(button)
   $("#device-blinds").modal();
}

function updateDeviceBlindModal(button){
  document.getElementById("blinds-name").innerHTML = button.getAttribute("data-name");
  document.getElementById("blinds-description").innerHTML = button.getAttribute("data-desc");
  api.device.getState(button.getAttribute("data-ID"))
  .done(function (data) {
      updateBlindState(button,data)
  })
  .fail(function (jqXHR, textStatus) {
      ("#data-base-error").modal()
  })
}

function updateBlindState(button,data){
  var status = data.result.status
  if(status == "opened" || status == "opening"){
    document.getElementById("blinds-switch").checked = true;
    $('#blinds-switch').bootstrapToggle('on')
  }
  else{
    document.getElementById("blinds-switch").checked = false;
    $('#blinds-switch').bootstrapToggle('off')
  }
  button.setAttribute("data-status", document.getElementById("blinds-switch").checked)
}


function saveChangesBlinds(){
    cleanAllErrors()
    var device = document.getElementById(document.getElementById("device-blinds").getAttribute("data-device"));
    var blind = new api.blind(null,null,null,null)
    var change = modifyDevice("device-blinds","blinds-change-name","blinds-change-description",blind,"blind")
    var changeState = false;
    if(change == false){
      return;
    }
    if(change == true){
    	updateDevice(blind)
	}

	var currentState = document.getElementById("blinds-switch").checked
	var previousState = device.getAttribute("data-status")
	if((currentState == true && previousState == "false") || (currentState == false && previousState == "true")){
		changeState = true;
	}
	if(changeState){
		if(document.getElementById("blinds-switch").checked != device.getAttribute("data-status")){
		    if(document.getElementById("blinds-switch").checked == true){
		      blind.up(blind.id)
		    }
		    else{
		      blind.down(blind.id)
		    }
		}
	}
	if(change == true || changeState == true){
		showNotification()
	}
    $("#device-blinds").modal("hide");

}

function deleteBlinds(){
  var device = document.getElementById(document.getElementById("device-blinds").getAttribute("data-device"));

  $("#device-blinds").modal("hide");
  $("#confirmation-Delete-device").modal();

  document.getElementById("delete-modal-device-name").innerHTML = "Delete " + device.getAttribute("data-name") + "?";

  document.getElementById("accept-delete-device").onclick = function() {deleteDevice(device)};
}

function deleteLamp(){
  var device = document.getElementById(document.getElementById("device-lamp").getAttribute("data-device"));

  $("#device-lamp").modal("hide");
  $("#confirmation-Delete-device").modal();

  document.getElementById("delete-modal-device-name").innerHTML = "Delete " + device.getAttribute("data-name") + "?";

  document.getElementById("accept-delete-device").onclick = function() {deleteDevice(device)};
}

function deleteDoor(){
  var device = document.getElementById(document.getElementById("device-door").getAttribute("data-device"));

  $("#device-door").modal("hide");
  $("#confirmation-Delete-device").modal();

  document.getElementById("delete-modal-device-name").innerHTML = "Delete " + device.getAttribute("data-name") + "?";

  document.getElementById("accept-delete-device").onclick = function() {deleteDevice(device)};
}

function deleteAc(){
  var device = document.getElementById(document.getElementById("device-ac").getAttribute("data-device"));

  $("#device-ac").modal("hide");
  $("#confirmation-Delete-device").modal();

  document.getElementById("delete-modal-device-name").innerHTML = "Delete " + device.getAttribute("data-name") + "?";

  document.getElementById("accept-delete-device").onclick = function() {deleteDevice(device)};
}

function deleteOven(){
  var device = document.getElementById(document.getElementById("device-oven").getAttribute("data-device"));

  $("#device-oven").modal("hide");
  $("#confirmation-Delete-device").modal();

  document.getElementById("delete-modal-device-name").innerHTML = "Delete " + device.getAttribute("data-name") + "?";

  document.getElementById("accept-delete-device").onclick = function() {deleteDevice(device)};
}

function deleteFridge(){
  var device = document.getElementById(document.getElementById("device-refrigerator").getAttribute("data-device"));

  $("#device-refrigerator").modal("hide");
  $("#confirmation-Delete-device").modal();

  document.getElementById("delete-modal-device-name").innerHTML = "Delete " + device.getAttribute("data-name") + "?";

  document.getElementById("accept-delete-device").onclick = function() {deleteDevice(device)};
}

function deleteDevice(device){
  api.device.delete(device.getAttribute("data-ID"))

  .done(function(data){
    var father = device.parentElement;
    father.parentElement.removeChild(father);
    $("#confirmation-Delete-device").modal("hide");
  })

  .fail(function(jqXHR, textStatus){
    ("#data-base-error").modal()
  })  
}

function modifyDevice(modalID,newNameID,newDescID,deviceObj,deviceType){
   var device = document.getElementById(document.getElementById(modalID).getAttribute("data-device"));
   deviceObj.id = device.getAttribute("data-ID")
   deviceObj.name = document.getElementById(newNameID).value;
   deviceObj.description = document.getElementById(newDescID).value;
   deviceObj.typeId = device.getAttribute("data-typeID")
   var errorName = document.getElementById("error-name-" + deviceType)
   var errorExistName = document.getElementById("error-nameExist-" + deviceType)
   if( (deviceObj.name.length != 0 && deviceObj.name.length < 3) || deviceObj.name.length > 30){
    errorName.style.display = "block";
    document.getElementById(newNameID).value = ""
    return false;
   }
   if(deviceNameExist(deviceObj.name,errorExistName)){
    document.getElementById(newNameID).value = ""
    return false;
   }
   if(deviceObj.name.length != 0 || deviceObj.description.length != 0){
     if(deviceObj.description == "")
      deviceObj.description = device.getAttribute("data-desc");
     if(deviceObj.name  == "")
      deviceObj.name = device.getAttribute("data-name")
    }else{
      deviceObj.description = device.getAttribute("data-desc");
      deviceObj.name = device.getAttribute("data-name")
      return null;
    }

  device.setAttribute("data-name",deviceObj.name)
  device.setAttribute("data-desc",deviceObj.description)
  document.getElementById(newDescID).value = "";
  document.getElementById(newNameID).value = "";
  return true;
}

function updateDevice(deviceObj){
    api.device.get(deviceObj.id)
    .done(function (data) {
        data.device.name = deviceObj.name
        data.device.meta = deviceObj.description
        api.device.modify(data.device)
        .done(function (boolean){
        })
        .fail(function (jqXHR, textStatus) {
        ("#data-base-error").modal()
        })
      })
    .fail(function (jqXHR, textStatus) {
      ("#data-base-error").modal()
      })

    var deviceTag = createTag(deviceObj.name);
    var button = document.getElementById(deviceObj.id)
    var deviceContainer = button.parentNode
    var divToRemove = deviceContainer.children[1]
    deviceContainer.removeChild(divToRemove)
    deviceContainer.appendChild(deviceTag)
}



function viewLampState(button){
   cleanAllErrors()
   document.getElementById("device-lamp").setAttribute("data-device",button.getAttribute("id"))
   updateDeviceLampModal(button)
   $("#device-lamp").modal();
}


function updateDeviceLampModal(button){
  document.getElementById("lamp-name").innerHTML = button.getAttribute("data-name");
  document.getElementById("lamp-description").innerHTML = button.getAttribute("data-desc");
  api.device.getState(button.getAttribute("data-ID"))
  .done(function (data) {
      updateLampState(button,data)
  })
  .fail(function (jqXHR, textStatus) {
      ("#data-base-error").modal()
  })
}

function updateLampState(button,data){
  var status = data.result.status
  if(status == "on"){
    document.getElementById("lamp-switch").checked = true;
    $('#lamp-switch').bootstrapToggle('on')
    document.getElementById("lamp-change-brightness").disabled = false
    document.getElementById("lamp-change-color").disabled = false
  }
  else{
    document.getElementById("lamp-switch").checked = false
    $('#lamp-switch').bootstrapToggle('off')
    document.getElementById("lamp-change-brightness").disabled = true
    document.getElementById("lamp-change-color").disabled = true
  }
  button.setAttribute("data-brightness", data.result.brightness);
  button.setAttribute("data-color", data.result.color);
  button.setAttribute("data-status", document.getElementById("lamp-switch").checked)
  document.getElementById("lamp-change-brightness").value = data.result.brightness;
  document.getElementById("lamp-change-color").value = data.result.color;
}

function DisableLampOptions(){
	var switchLamp = document.getElementById("lamp-switch")
	var button = document.getElementById(document.getElementById("device-lamp").getAttribute("data-device"))
	if(switchLamp.checked == true){
		document.getElementById("lamp-change-brightness").disabled = false
    	document.getElementById("lamp-change-color").disabled = false
	}else{
		document.getElementById("lamp-change-brightness").disabled = true
    	document.getElementById("lamp-change-color").disabled = true
    	document.getElementById("lamp-change-brightness").value = button.getAttribute("data-brightness")
    	document.getElementById("lamp-change-color").value = button.getAttribute("data-color")
	}
}



function saveChangesLamp(){
    cleanAllErrors()
    var fieldError = false;
    var changeNameOrDesc = false
    var changes = false;
    var lamp = new api.lamp(null,null,null,null)

    changeNameOrDesc = modifyDevice("device-lamp","lamp-change-name","lamp-change-description",lamp,"lamp")
    if( changeNameOrDesc == false){
      fieldError = true;
    }
    var newBrightness = document.getElementById("lamp-change-brightness").value;
    if(newBrightness > 100 || newBrightness < 0 || newBrightness == ""){
      document.getElementById("error-lamp-brightness").style.display = "block"
      document.getElementById("lamp-change-brightness").value = document.getElementById(lamp.id).getAttribute("data-brightness")
      fieldError = true;
    }
    var newColor = document.getElementById("lamp-change-color").value;
    var firstChar = newColor.charAt(0);
    if(firstChar == '#')
    	newColor = newColor.substring(1);
    if(! isColor(newColor) || newColor == ""){
      document.getElementById("lamp-change-brightness").value = document.getElementById(lamp.id).getAttribute("data-color")
      document.getElementById("error-lamp-color").style.display = "block"
      fieldError = true;
    }
    if(fieldError){
      return;
    }

    if((newBrightness != document.getElementById(lamp.id).getAttribute("data-brightness")) 
    		|| newColor != document.getElementById(lamp.id).getAttribute("data-color")){
    	changes = true;
	}

	var currentState = document.getElementById("lamp-switch").checked
	var previousState = document.getElementById(lamp.id).getAttribute("data-status")

	if((currentState == true && previousState == "false") || (currentState == false && previousState == "true")){
		changes = true;
	}

	if(changeNameOrDesc == true){
    	updateDevice(lamp)
	}
    if(changes){
	    var newBrightnessJSON={"0":newBrightness}; //si fueran 2 parametros seria {"0":newBrightness,"1":segundaParam}
	    var newColorJSON={"0":newColor}
	    var parameterBrightness = JSON.stringify(newBrightnessJSON)
	    var parameterColor = JSON.stringify(newColorJSON)
	    if(document.getElementById("lamp-switch").checked == true){
	      lamp.turnOn(lamp.id)
	      .done(function (data) {
	        lamp.changeBrightness(lamp.id,parameterBrightness)
	        lamp.changeColor(lamp.id,parameterColor)
	        })
	      .fail(function (jqXHR, textStatus) {
	        $("#data-base-error").modal()
	        })
	    }
	    else{
	      lamp.turnOff(lamp.id)
	    }
	}

	if(changeNameOrDesc == true || changes == true){
		showNotification()
	}
    $("#device-lamp").modal("hide");
}

  function viewOvenState(button){
    cleanAllErrors()
    document.getElementById("device-oven").setAttribute("data-device",button.getAttribute("id"))
    updateDeviceOvenModal(button)
    $("#device-oven").modal();
  }

  function updateDeviceOvenModal(button){
    document.getElementById("oven-name").innerHTML = button.getAttribute("data-name");
    document.getElementById("oven-description").innerHTML = button.getAttribute("data-desc");
    api.device.getState(button.getAttribute("data-ID"))
    .done(function (data) {
        updateOvenState(button,data)
    })
    .fail(function (jqXHR, textStatus) {
        ("#data-base-error").modal()
    })
}

  function updateOvenState(button,data){
    var status = data.result.status
    if(status == "on"){
      document.getElementById("oven-switch").checked = true;
      $('#oven-switch').bootstrapToggle('on')
    }
    else{
      document.getElementById("oven-switch").checked = false;
      $('#oven-switch').bootstrapToggle('off')
    }
    document.getElementById("oven-change-temperature").value = data.result.temperature;
    document.getElementById("oven-change-heatmode").value = data.result.heat;
    document.getElementById("oven-change-grillmode").value = data.result.grill;
    document.getElementById("oven-change-convectionmode").value = data.result.convection;
    button.setAttribute("data-temperature", data.result.temperature);
    button.setAttribute("data-heatmode", data.result.heat);
    button.setAttribute("data-grillmode", data.result.grill);
    button.setAttribute("data-convectionmode", data.result.convection);
    button.setAttribute("data-status", document.getElementById("oven-switch").checked)
    DisableOvenOptions()

}

function DisableOvenOptions(){
	var switchOven = document.getElementById("oven-switch")
	var button = document.getElementById(document.getElementById("device-oven").getAttribute("data-device"))
	if(switchOven.checked == true){
    	document.getElementById("oven-change-temperature").disabled = false;
    	document.getElementById("oven-change-heatmode").disabled = false;
    	document.getElementById("oven-change-grillmode").disabled = false;
    	document.getElementById("oven-change-convectionmode").disabled = false;
	}else{
    	document.getElementById("oven-change-temperature").disabled = true;
    	document.getElementById("oven-change-heatmode").disabled = true;
    	document.getElementById("oven-change-grillmode").disabled = true;
    	document.getElementById("oven-change-convectionmode").disabled = true;
    	document.getElementById("oven-change-temperature").value = button.getAttribute("data-temperature")
    	document.getElementById("oven-change-heatmode").value = button.getAttribute("data-heatmode")
    	document.getElementById("oven-change-grillmode").value = button.getAttribute("data-grillmode")
    	document.getElementById("oven-change-convectionmode").value = button.getAttribute("data-convectionmode")

	}
}

function saveChangesOven(){
    cleanAllErrors()
    var fieldError = false;
    var changeNameOrDesc = false;
    var changes = false;
    var oven = new api.oven(null,null,null,null)
    
    changeNameOrDesc = modifyDevice("device-oven","oven-change-name","oven-change-description",oven,"oven")

    if(changeNameOrDesc == false){
      fieldError = true
    }

    var newTemperature = document.getElementById("oven-change-temperature").value;
    if(newTemperature < 90 || newTemperature > 230){
      document.getElementById("error-oven-temperature").style.display = "block"
      document.getElementById("oven-change-temperature").value = document.getElementById(oven.id).getAttribute("data-temperature")
      fieldError = true
    }
    var newTemperatureJSON={"0":newTemperature}
    var parameterTemperature = JSON.stringify(newTemperatureJSON)
    var newHeatMode = document.getElementById("oven-change-heatmode").value;
    var newHeatModeJSON={"0":newHeatMode}
    var parameterHeatMode = JSON.stringify(newHeatModeJSON)
    var newGrillMode = document.getElementById("oven-change-grillmode").value;
    var newGrillModeJSON={"0":newGrillMode}
    var parameterGrillMode = JSON.stringify(newGrillModeJSON)
    var newConvectionMode = document.getElementById("oven-change-convectionmode").value;
    var newConvectionModeJSON={"0":newConvectionMode}
    var parameterConvectionMode = JSON.stringify(newConvectionModeJSON)
    
    if(newHeatMode == ""){
      document.getElementById("error-oven-heatmode").style.display = "block"
      document.getElementById("oven-change-heatmode").value = document.getElementById(oven.id).getAttribute("data-heatmode")
      fieldError = true;
    }
    if(newGrillMode == ""){
      document.getElementById("error-oven-grillmode").style.display = "block"
      document.getElementById("oven-change-grillmode").value = document.getElementById(oven.id).getAttribute("data-grillmode")
      fieldError = true;
    }
    if(newConvectionMode == ""){
      document.getElementById("error-oven-convectionmode").style.display = "block"
      document.getElementById("oven-change-convectionmode").value = document.getElementById(oven.id).getAttribute("data-convectionmode")
      fieldError = true;
    }
    if(fieldError)
      return;

  	if(changeNameOrDesc == true){
    	updateDevice(oven)
    }

    if(newTemperature != document.getElementById(oven.id).getAttribute("data-temperature") ||
    	newHeatMode != document.getElementById(oven.id).getAttribute("data-heatmode") ||
    	newGrillMode != document.getElementById(oven.id).getAttribute("data-grillmode") ||
    	newConvectionMode != document.getElementById(oven.id).getAttribute("data-convectionmode")){
    		changes = true;
    }

    var currentState = document.getElementById("oven-switch").checked
	var previousState = document.getElementById(oven.id).getAttribute("data-status")

	if((currentState == true && previousState == "false") || (currentState == false && previousState == "true")){
		changes = true;
	}
	if(changes){
	    if(document.getElementById("oven-switch").checked == true){
	      oven.turnOn(oven.id)
	      .done(function (data) {
	        if(newTemperature != "")
	          oven.setTemperature(oven.id,parameterTemperature)
	        if(newHeatMode != "")
	          oven.setHeat(oven.id,parameterHeatMode)
	        if(newGrillMode != "")
	          oven.setGrill(oven.id,parameterGrillMode)
	        if(newConvectionMode != "")
	          oven.setConvection(oven.id,parameterConvectionMode)
	        })
	      .fail(function (jqXHR, textStatus) {
	        ("#data-base-error").modal()
	        })
	    }
	    else{
	      oven.turnOff(oven.id)
	    }
	}

	if(changes == true || changeNameOrDesc == true)
		showNotification()
    $("#device-oven").modal("hide");
}

  function viewAcState(button){
    cleanAllErrors()
    document.getElementById("device-ac").setAttribute("data-device",button.getAttribute("id"))
    updateDeviceAcModal(button)
    $("#device-ac").modal();
  }

  function updateDeviceAcModal(button){
    document.getElementById("ac-name").innerHTML = button.getAttribute("data-name");
    document.getElementById("ac-description").innerHTML = button.getAttribute("data-desc");
    api.device.getState(button.getAttribute("data-ID"))
    .done(function (data) {
        updateAcState(button,data)
    })
    .fail(function (jqXHR, textStatus) {
       ("#data-base-error").modal()
    })
}

  function updateAcState(button,data){
    var status = data.result.status
    if(status == "on"){
    document.getElementById("ac-switch").checked = true;
    $('#ac-switch').bootstrapToggle('on')
    }else{
    document.getElementById("ac-switch").checked = false;
    $('#ac-switch').bootstrapToggle('off')
    }
    document.getElementById("ac-change-temperature").value = data.result.temperature;
    document.getElementById("ac-change-mode").value = data.result.mode;
    document.getElementById("ac-change-verticalswing").value = data.result.verticalSwing;
    document.getElementById("ac-change-horizontalswing").value = data.result.horizontalSwing;
    document.getElementById("ac-change-fanspeed").value = data.result.fanSpeed;
    button.setAttribute("data-temperature", data.result.temperature);
    button.setAttribute("data-verticalswing", data.result.verticalSwing);
    button.setAttribute("data-horizontalswing", data.result.horizontalSwing);
    button.setAttribute("data-mode", data.result.mode);
    button.setAttribute("data-fanspeed", data.result.fanSpeed);
    button.setAttribute("data-status", document.getElementById("ac-switch").checked)
    DisableAcOptions()
}

function DisableAcOptions(){
	var switchAc = document.getElementById("ac-switch")
	var button = document.getElementById(document.getElementById("device-ac").getAttribute("data-device"))
	if(switchAc.checked == true){
    document.getElementById("ac-change-temperature").disabled = false;
    document.getElementById("ac-change-mode").disabled = false;
    document.getElementById("ac-change-verticalswing").disabled = false;
    document.getElementById("ac-change-horizontalswing").disabled = false;
    document.getElementById("ac-change-fanspeed").disabled = false;
	}else{
    document.getElementById("ac-change-temperature").disabled = true;
    document.getElementById("ac-change-mode").disabled = true;
    document.getElementById("ac-change-verticalswing").disabled = true;
    document.getElementById("ac-change-horizontalswing").disabled = true;
    document.getElementById("ac-change-fanspeed").disabled = true;
    document.getElementById("ac-change-temperature").value = button.getAttribute("data-temperature")
    document.getElementById("ac-change-mode").value = button.getAttribute("data-mode")
    document.getElementById("ac-change-verticalswing").value = button.getAttribute("data-verticalswing")
    document.getElementById("ac-change-horizontalswing").value = button.getAttribute("data-horizontalswing")
    document.getElementById("ac-change-fanspeed").value = button.getAttribute("data-fanspeed")
	}
}

function saveChangesAc(){
    cleanAllErrors()
    var fieldError = false;
    var ac = new api.ac(null,null,null,null)
    var changeNameOrDesc = false;
    var changes = false;

    changeNameOrDesc = modifyDevice("device-ac","ac-change-name","ac-change-description",ac,"ac")
    if( changeNameOrDesc == false){
      fieldError = true;
    }
    var newTemperature = document.getElementById("ac-change-temperature").value;
    var newTemperatureJSON={"0":newTemperature}
    var parameterTemperature = JSON.stringify(newTemperatureJSON)
    if(newTemperature < 18 || newTemperature > 38){
      fieldError = true;
      document.getElementById("error-ac-temperature").style.display = "block"
      document.getElementById("ac-change-temperature").value = document.getElementById(ac.id).getAttribute("data-temperature");
    }
    var newMode = document.getElementById("ac-change-mode").value;
    var newModeJSON={"0":newMode}
    var parameterMode = JSON.stringify(newModeJSON)
    var newVerticalswing = document.getElementById("ac-change-verticalswing").value;
    var newVerticalswingJSON={"0":newVerticalswing}
    var parameterVerticalswing = JSON.stringify(newVerticalswingJSON)
    var newHorizontalswing = document.getElementById("ac-change-horizontalswing").value;
    var newHorizontalswingJSON={"0":newHorizontalswing}
    var parameterHorizontalswing = JSON.stringify(newHorizontalswingJSON)
    var newFanspeed = document.getElementById("ac-change-fanspeed").value;
    var newFanspeedJSON={"0":newFanspeed}
    var parameterFanspeed = JSON.stringify(newFanspeedJSON)

    if(newMode == ""){
      fieldError = true;
      document.getElementById("error-ac-mode").style.display = "block"
      document.getElementById("ac-change-mode").value = document.getElementById(ac.id).getAttribute("data-mode");
    }

    if(newVerticalswing == ""){
      fieldError = true;
      document.getElementById("error-ac-verticalswing").style.display = "block"
      document.getElementById("ac-change-verticalswing").value = document.getElementById(ac.id).getAttribute("data-verticalswing");
    }

    if(newHorizontalswing == ""){
      fieldError = true;
      document.getElementById("error-ac-horizontalswing").style.display = "block"
      document.getElementById("ac-change-horizontalswing").value = document.getElementById(ac.id).getAttribute("data-horizontalswing");
    }

    if(newFanspeed == ""){
      fieldError = true;
      document.getElementById("error-ac-fanspeed").style.display = "block"
      document.getElementById("ac-change-fanspeed").value = document.getElementById(ac.id).getAttribute("data-fanspeed");
    }

    if(fieldError)
      return;

  	if(newTemperature != document.getElementById(ac.id).getAttribute("data-temperature") ||
  		newMode != document.getElementById(ac.id).getAttribute("data-mode") ||
  		newVerticalswing != document.getElementById(ac.id).getAttribute("data-verticalswing") ||
  		newHorizontalswing != document.getElementById(ac.id).getAttribute("data-horizontalswing") ||
  		newFanspeed != document.getElementById(ac.id).getAttribute("data-fanspeed")){
  			changes = true;
  	}

  	var currentState = document.getElementById("ac-switch").checked
	var previousState = document.getElementById(ac.id).getAttribute("data-status")

	if((currentState == true && previousState == "false") || (currentState == false && previousState == "true")){
		changes = true;
	}

	if(changeNameOrDesc == true){
    	updateDevice(ac)
	}
	if(changes == true){
	    if(document.getElementById("ac-switch").checked == true){
	      ac.turnOn(ac.id)
	      .done(function (data) {
	        if(newTemperature != "")
	          ac.setTemperature(ac.id,parameterTemperature)
	        if(newMode != "")
	          ac.setMode(ac.id,parameterMode)
	        if(newVerticalswing != "")
	          ac.setVerticalSwing(ac.id,parameterVerticalswing)
	        if(newHorizontalswing != "")
	          ac.setHorizontalSwing(ac.id,parameterHorizontalswing)
	        if(newFanspeed != "")
	          ac.setFanSpeed(ac.id,parameterFanspeed)
	        })
	      .fail(function (jqXHR, textStatus) {
	        ("#data-base-error").modal()
	        })
	    }
	    else{
	      ac.turnOff(ac.id)
	    }
	}
	if(changes == true || changeNameOrDesc == true){
		showNotification()
	}
    $("#device-ac").modal("hide");
}


  function viewDoorState(button){
    cleanAllErrors()
    document.getElementById("device-door").setAttribute("data-device",button.getAttribute("id"))
    updateDeviceDoorModal(button)
    $("#device-door").modal();
  }

  function updateDeviceDoorModal(button){
    document.getElementById("door-name").innerHTML = button.getAttribute("data-name");
    document.getElementById("door-description").innerHTML = button.getAttribute("data-desc");
    api.device.getState(button.getAttribute("data-ID"))
    .done(function (data) {
        updateDoorState(button,data)
    })
    .fail(function (jqXHR, textStatus) {
       ("#data-base-error").modal()
    })
}

  function updateDoorState(button,data){
    var status = data.result.status
    var lock = data.result.lock
    if(status == "opened"){
      document.getElementById("door-switch").checked = true;
      $('#door-switch').bootstrapToggle('on')
    }else{
      document.getElementById("door-switch").checked = false;
      $('#door-switch').bootstrapToggle('off')
    }
    if(lock == "unlocked"){
      document.getElementById("lock-switch").checked = false;
      $('#lock-switch').bootstrapToggle('off')
    }else{
      document.getElementById("lock-switch").checked = true;
      $('#lock-switch').bootstrapToggle('on')
    }
    button.setAttribute("data-status", document.getElementById("door-switch").checked)
    button.setAttribute("data-lock", document.getElementById("lock-switch").checked)
    DisableDoorOptions()
}

function DisableDoorOptions(){
	var switchDoor = document.getElementById("door-switch")
	if(switchDoor.checked == true){
		$('#lock-switch').bootstrapToggle('off')
    	$('#lock-switch').bootstrapToggle('disable')
	}else{
		$('#lock-switch').bootstrapToggle('enable')
	}
}


function saveChangesDoor(){
    cleanAllErrors()
    var changeNameOrDesc = false;
    var changes = false;
    var door = new api.door(null,null,null,null)

    changeNameOrDesc = modifyDevice("device-door","door-change-name","door-change-description",door,"door")
    if( changeNameOrDesc == false)
      return;

  	if(changeNameOrDesc == true){
    	updateDevice(door)
  	}

  	var currentState = document.getElementById("door-switch").checked
	var previousState = document.getElementById(door.id).getAttribute("data-status")
	var currentStateLock = document.getElementById("lock-switch").checked
	var previousStateLock = document.getElementById(door.id).getAttribute("data-lock")

	if((currentState == true && previousState == "false") || (currentState == false && previousState == "true")){
		changes = true;
	}

	if((currentStateLock == true && previousStateLock == "false") || (currentStateLock == false && previousStateLock == "true")){
		changes = true;
	}
	if(changes == true){
	    if(document.getElementById("door-switch").checked == true){
	      door.open(door.id)
	      door.unlock(door.id)
	    }
	    else{
	      door.close(door.id)
	      .done(function (data) {
	        if(document.getElementById("lock-switch").checked == true){
	          door.lock(door.id)
	        }else{
	          door.unlock(door.id)
	        }
	        })
	      .fail(function (jqXHR, textStatus) {
	        ("#data-base-error").modal()
	        })
	    }
	}

	if(changes == true || changeNameOrDesc == true){
		showNotification()
	}
    $("#device-door").modal("hide");
}

function viewRefrigeratorState(button){
    cleanAllErrors()
    document.getElementById("device-refrigerator").setAttribute("data-device",button.getAttribute("id"))
    updateDeviceRefrigeratorModal(button)
    $("#device-refrigerator").modal();
  }

function updateDeviceRefrigeratorModal(button){
    document.getElementById("refrigerator-name").innerHTML = button.getAttribute("data-name");
    document.getElementById("refrigerator-description").innerHTML = button.getAttribute("data-desc");
    api.device.getState(button.getAttribute("data-ID"))
    .done(function (data) {
        updateRefrigeratorState(button,data)
    })
    .fail(function (jqXHR, textStatus) {
        ("#data-base-error").modal()
    })
}

function updateRefrigeratorState(button,data){
    document.getElementById("refrigerator-change-freezertemperature").value = data.result.freezerTemperature;
    document.getElementById("refrigerator-change-temperature").value = data.result.temperature;
    document.getElementById("refrigerator-change-mode").value = data.result.mode;
    button.setAttribute("data-temperature",data.result.temperature)
    button.setAttribute("data-freezertemperature",data.result.freezerTemperature)
    button.setAttribute("data-mode",data.result.mode)
}

function saveChangesRefrigerator(){
    cleanAllErrors()
    var fieldError = false;
    var changes = false;
    var changeNameOrDesc = false;
    var refrigerator = new api.refrigerator(null,null,null,null)

    changeNameOrDesc = modifyDevice("device-refrigerator","refrigerator-change-name","refrigerator-change-description",refrigerator,"refrigerator")
    if(changeNameOrDesc == false){
      fieldError = true;
    }
    var newTemperature = document.getElementById("refrigerator-change-temperature").value;
    var newTemperatureJSON={"0":newTemperature}
    var parameterTemperature = JSON.stringify(newTemperatureJSON)
    if(newTemperature < 2 || newTemperature > 8){
      fieldError = true;
      document.getElementById("error-refrigerator-temperature").style.display = "block"
      document.getElementById("refrigerator-change-temperature").value = document.getElementById(refrigerator.id).getAttribute("data-temperature");
    }
    var newFreezerTemperature = document.getElementById("refrigerator-change-freezertemperature").value;
    var newFreezerTemperatureJSON={"0":newFreezerTemperature}
    var parameterFreezerTemperature = JSON.stringify(newFreezerTemperatureJSON)
    if(newFreezerTemperature > -2 || newFreezerTemperature < -20){
      fieldError = true;
      document.getElementById("error-refrigerator-freezertemperature").style.display = "block"
      document.getElementById("refrigerator-change-freezertemperature").value = document.getElementById(refrigerator.id).getAttribute("data-freezertemperature");
    }
    var newMode = document.getElementById("refrigerator-change-mode").value;
    var newModeJSON={"0":newMode}
    var parameterMode = JSON.stringify(newModeJSON)
    if(newMode == ""){
      fieldError = true;
      document.getElementById("error-refrigerator-mode").style.display = "block"
      document.getElementById("refrigerator-change-mode").value = document.getElementById(refrigerator.id).getAttribute("data-mode");
    }
    if(fieldError){
      return;
    }

    if(newTemperature != document.getElementById(refrigerator.id).getAttribute("data-temperature") ||
    	newFreezerTemperature != document.getElementById(refrigerator.id).getAttribute("data-freezertemperature") ||
    	newMode != document.getElementById(refrigerator.id).getAttribute("data-mode")){
    		changes = true;
    }
    if(changeNameOrDesc == true){
    	updateDevice(refrigerator)
    }
    if(changes == true){
    	refrigerator.setFreezerTemperature(refrigerator.id,parameterFreezerTemperature)
    	refrigerator.setTemperature(refrigerator.id,parameterTemperature)
    	refrigerator.setMode(refrigerator.id,parameterMode)
    	.fail(function (jqXHR, textStatus) {
        ("#data-base-error").modal()
    	})
    }

    if(changes == true || changeNameOrDesc == true){
    	showNotification()
    }

    $("#device-refrigerator").modal("hide");
}

function showNotification(){
  $("#notification").fadeIn(2000);
  setTimeout(function(){
    $("#notification").fadeOut(2000);
}, 6000);
  
}
$(function() {
    $('#cp3').colorpicker({
       color: '#AA3399',
        format: 'hex',
    });
});


function isColor(color){
  for (var i = 0; i < color.length; i++) {
    var c = color.charAt(i);
    if( (c < '0' || c > '9') && ( c < 'a' || c > 'z') && ( c < 'A' || c > 'Z'))
      return false;
  }
  return true;
}

//SEARCH
function mySearch(){
  api.room.getAll()
  .done(function (data) {
    // data tiene el valor retornado por la petición Ajax
    createRoomList(data);
    searchRoomList();
  })
  .fail(function (jqXHR, textStatus) {
    ("#data-base-error").modal()
  })
}

function createRoomList(data){
  if(document.getElementById("myUL") != null){
    var deleteUL = document.getElementById("myUL");
    deleteUL.parentNode.removeChild(deleteUL);
  }

  var allRooms = data;
  myUL = document.createElement("ul");
  myUL.setAttribute("id", "myUL");
  myUL.setAttribute("hidden", "true");
  document.getElementById("myBody").appendChild(myUL);
  for (var i = 0; i < allRooms.rooms.length; i++) {
      var myLI = document.createElement("li");
      var myA = document.createElement("a");
      myA.innerHTML = allRooms.rooms[i].name;
      myLI.appendChild(myA);
      myUL.appendChild(myLI);
  }
}

function searchRoomList(){
  var input, filter, ul, li, a, i;
    input = document.getElementById("my-search");
    filter = input.value.toUpperCase();
    ul = document.getElementById("myUL");
    li = ul.getElementsByTagName("li");
    for (i = 0; i < li.length; i++) {
        a = li[i].getElementsByTagName("a")[0];
        if (a.innerHTML.toUpperCase().indexOf(filter) > -1) {
          document.getElementById(a.innerHTML + "room").parentNode.style.display = "";
        } else {
          document.getElementById(a.innerHTML + "room").parentNode.style.display = "none";
        }
    }
}

</script>
</body>
</html>
