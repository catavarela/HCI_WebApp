<!DOCTYPE html>
<html lang="en">
<head>
  <title>Rooms and Devices</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="animate.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.3.6/css/bootstrap-colorpicker.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-2.2.2.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.3.6/js/bootstrap-colorpicker.js"></script>
  <style>

  /* W3.CSS 4.04 Apr 2017 by Jan Egil and Borge Refsnes */
html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}
/* Extract from normalize.css by Nicolas Gallagher and Jonathan Neal git.io/normalize */
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}
img{border-style:none}

::-webkit-input-placeholder{color:inherit;opacity:0.54}
::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}
/* End extract */

html,body{font-family:Verdana,sans-serif;font-size:15px;line-height:1.5}html{overflow-x:hidden}

h3{font-family:"Segoe UI",Arial,sans-serif;font-weight:10;margin:10px 0;color:#3b7aaf;
    text-align:left;
    font-size:3vw;
    display: block;}

html{
    height: 100%;
}

body{
    background-color:white;
    height:100%;
    width:100%;
}


 .logo{
 background-image:url("smart_house_logo.png");
 background-size: 56px 56px;
 background-repeat: no-repeat;
 width: 56px;
 height: 56px;
}

 .justify-center-56px{
  justify-content: center;
  display: flex;
  flex-direction: row;
  height: 56px;
 }

 .flex-center{
  display: flex;
  align-items: center;
 }

 .tam{
    font-size:16px;
 }

 .color{
  background-color: black;
 }

.my-container{
    width:100%;
    height:90%;
}

.left-container{
    background-color:white;
    width: 25%;
    height:95%;
    position:relative;
    right:-2%;
    border-radius: 25px;
    border-width:thin;
    border-color:transparent;
    border-style:solid;
    float:left;
}

.wrapper-room-title{
    background-color: transparent;
    width:100%;
    height:10%;
    padding:-2%;
}

.title-left-container{
    font-family:"Segoe UI",Arial,sans-serif;
    font-weight:10;
    color:#3b7aaf;
    text-align:center;
    font-size:3vw;
    display: block;
}

.left-fine-line{
    width:80%;
    border-right-color: transparent;
    border-left-color: transparent;
    border-top-color:transparent;
    border-bottom-color:#d3d3d3;
    border-style:solid;
    border-bottom-width:thin;
    position:relative;
    top:-20px;
}

.middle{
    background-color:transparent;
    position:relative;
    top:1.5%;
    width:100%;
    height:70%;
}

.wrapper{
    background-color:#D8E4EF;
    position:relative;
    right:-7.5%;
    border-radius: 15px;
    border-color:transparent;
    border-style: solid;
    height: 100%;
    width:85%;
}

.scrollContent{
  overflow-y: auto;
  float: left;
}

.vertical-menu {
    position:relative;
    top:2%;
    right:-8%;
    width: 83%;
    height:95%;
    overflow-y: auto;
    float:left;
    text-overflow: ellipsis;
}

.mod-room{
    width:15%;
    height:100%;
    background-color: white;
    border-right-color: transparent;
    border-bottom-color: transparent;
    border-top-color: transparent;
    border-left-color:#d3d3d3;
    border-left-width: thin;
    border-bottom-right-radius:10px;
    border-top-right-radius:10px;
    color:#3b7aaf;
}

.mod-room:hover{
    background-color: #B1CADF;
    color: black;
}

.mod-room-pencil{
    border-bottom-right-radius:0px;
    border-top-right-radius:0px;
}

.span-a{
    width:100%;
    height:10%;
    display: flex;
    margin-bottom:5%;

    line-height: 20px;
}
.vertical-menu a {
    color: #3b7aaf;
    background-color: white;
    border-bottom-left-radius: 10px;
    border-top-left-radius: 10px;
    display: block;
    width: 83%;
    padding: 5%;
    text-decoration: none;
    font-size:1.5vw;
    display: block;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;

    vertical-align: middle;
}

.vertical-menu a:hover {
    background-color: #B1CADF;
    color:black;
}

.wrapper-button-new-room{
    height:20%;
    width:100%;
    background-color:transparent;
    
}

.button-new-room{
    width:78%;
    height:33%;
    min-width:50%;
    border-radius: 10px;/*
    border-color:#d3d3d3;
    background-color:white;*/
    color:#3b7aaf;
    font-size: 1.5vw;
    position:relative;
    left:11%;
    top:30%;
}

.button-new-room:hover{
    background-color:#B1CADF;
}

.right-container{
    background-color:white;
    width:70%;
    height:95%;
    position:relative;
    right:-4.5%;
    float:left;
    /*border-radius: 25px;*/
    border-style:solid;
    border-width:thin;
    border-left-color: #d3d3d3;
    border-right-color: transparent;
    border-top-color: transparent;
    border-bottom-color:transparent;

}

.wrapper-room-title-two{
    background-color: transparent;
    width:95%;
    height:10%;
    position:relative;
    right:-25px;
    border-radius: 25px;
    margin-bottom:2%;
}

.title-right-container{
    color:#3b7aaf;
    text-align:center;
    font-size:3vw;
    font-family:"Segoe UI",Arial,sans-serif;
    font-weight:10;
    display: block;
}

.right-fine-line{
    width:80%;
    border-right-color: transparent;
    border-left-color: transparent;
    border-top-color:transparent;
    border-bottom-color:#d3d3d3;
    border-style:solid;
    border-bottom-width:thin;
    position:relative;
    top:-20px;
}

.wrapper-devices-container{
    position:relative;
    top:-1.75%;
    left:5%;
    width:90%;
    height:81.25%;
    background-color:#D8E4EF;
    border-radius: 15px;
    border-color:transparent;
    border-style:solid;
}

.devices-container{
    position:relative;
    top:1%;
    width:97%;
    height:97%;
    background-color: #D8E4EF;
    border-radius: 15px;
    overflow-y: auto;

}

.text-starter-devices-container{
    font-size:150%;
    position: relative;
    float: left;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.device-container{
    width:25%;
    height:35%;
    position:relative;
    top:-5%;
    float: left;
    margin-left:5%;
    margin-bottom: 5%;
    
}

.create-device{
    position:relative;
    top:25%;
    width:100%;
    height:100%;
    background-image:url("https://i.imgur.com/3OBKX7l.png");
    background-size: 100% 100%;
    background-repeat: no-repeat;
    border-color:transparent;
    
}

.new-device-button{
    position:relative;
    top:25%;
    width:100%;
    height:100%;
    background-image:url("https://i.imgur.com/RkNu2T3.jpg");
    background-size: 100% 100%;
    background-repeat: no-repeat;
    border-color:transparent;
}

.hidden-devices{
    display:none;
}

.modal-footer{
  background-color: #D8E4EF;
  border-bottom-right-radius: 12px;
  border-bottom-left-radius: 12px;
 }

.modal-header{
  border-bottom-right-radius: 12px;
  border-bottom-left-radius: 12px;
 }

.modal-text-device{
  font-size:200%;
}

/* The switch - the box around the slider */
.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
}

/* Hide default HTML checkbox */
.switch input {display:none;}

/* The slider */
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  -webkit-transition: .4s;
  transition: .4s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
}

input:checked + .slider {
  background-color: #3b7aaf;
}

input:focus + .slider {
  box-shadow: 0 0 1px #3b7aaf;
}

input:checked + .slider:before {
  -webkit-transform: translateX(26px);
  -ms-transform: translateX(26px);
  transform: translateX(26px);
}

/* Rounded sliders */
.slider.round {
  border-radius: 34px;
}

.slider.round:before {
  border-radius: 50%;
}

.trampa{
  color:white;
}

 </style>
</head>
<body onload="loadAll()">

  <nav class="navbar navbar-inverse color">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>                        
        </button>
        <a class="navbar-brand logo" href="Home.html"></a>
      </div>
      <div class="collapse navbar-collapse" id="myNavbar">
        <ul class="nav navbar-nav justify-center-56px">
          <li><a class="flex-center tam" href="MyDevices.html">Rooms and Devices</a></li>
          <li><a class="flex-center tam" href="MyCombos.html">Combinations</a></li>
          <li><a class="flex-center tam" href="MyAgenda.html">Agenda</a></li>
          <li><a class="flex-center tam" href="Now On.html">Switched On</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li class="dropdown">
            <a class="dropdown-toggle flex-center tam" data-toggle="dropdown" href="#">My Profile <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="#">Configurations</a></li>
              <li><a href="#">News</a></li>
              <li><a href="Profiles.html">Change Profile</a></li>
              <li><a href="Main Page.html">Log out</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="my-container" id="main-container">
    <div class="left-container">
        <div class="wrapper-room-title">
            <h1 class="title-left-container">Rooms</h1>
            <hr class="left-fine-line">
        </div>
        <div class="middle">
            <div class="wrapper scrollContent">
                <div class="vertical-menu" id="ver-menu">
                </div>
            </div>
        </div>
        <div class="wrapper-button-new-room">
            <button class="button-new-room btn btn-default" id="new-room">Add room</button>
        </div>
    </div>
    <div class="right-container" id="starter-right-container">
        <div class="wrapper-room-title-two">
            <h1 class="title-right-container">"Room name"</h1>
            <hr class="right-fine-line">
        </div>
        <div class="wrapper-devices-container scrollContent">
            <div class="devices-container">
                <p class="text-starter-devices-container">To see the devices, please select or create a room!!</p>
            </div>
        </div>
    </div>
  </div>



  <!-- Idea del href del "a" del ver-menu-->
  <div class="hidden-devices" id ="hidden-div">
  </div>

  
  
  <!-- Modal -->
  <div class="modal fade" id="room" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Add room</h3>
        </div>
        <div class="modal-body">
           <form role="form">
            <div class="form-group">
              <label for="room-name"><span class="glyphicon glyphicon-home"></span>Name:</label>
              <input type="text" class="form-control" id="room-name" placeholder="Enter name" name="room-name">
              <label for="room-description">Description (optional):</label>
              <input type="text" class="form-control" id="room-description" placeholder="Enter description" name="room-description">
            </div>
           </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="createRoom();" id="new-room-accept">Accept </button>
          <button type="submit" class="btn btn-default" onclick="cancelRoom();">Cancel</button>
        </div>
      </div>  
    </div>
  </div> 
  
  
  <!-- Modal -->
  <div class="modal fade" id="device" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Add device</h3>
        </div>
        <div class="modal-body">
           <form role="form">
            <div class="form-group">
              <label for="usrname">Name:</label>
              <input type="text" class="form-control" id="device-name" placeholder="Enter name" name="usrname">
              <label for="descr">Description (optional):</label>
              <input type="text" class="form-control" id="device-description" placeholder="Enter description" name="descr">
            </div>
           </form>
           <p> Select type:
           <select id="comboBoxTypeDevices">
            <option value="none"></option>
           </select>
         </p>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="createDevice();">Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>  
    </div>
  </div> 
  
  
  <!-- Modal de modify-->
  <div class="modal fade" id="modify-room" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title text-center" type="none" id="modify-room-header">Edit room</h3>
        </div>
        <div class="modal-body">
           <form role="form">
            <div class="form-group">
              <label for="actual-room-name" class="control-label">Current name:</label>
              <p class="room-name-modal form-control-static" id="actual-room-name"></p>
              <label for="actual-room-description" class="control-label">Current description:</label>
              <p class="room-description-modal form-control-static" id="actual-room-description"></p>                           <!--hay que poner la descripcion actual-->
              <label for="new-room-name"><span class="glyphicon glyphicon-home"></span> Change name:</label>
              <input type="text" class="form-control" id="new-room-name" placeholder="Enter new name" name="new-room-name">
              <label for="new-room-description">Change description:</label>                                                     <!--hay que updatear la descripcion tambien-->
              <input type="text" class="form-control" id="new-room-description" placeholder="Enter new description" name="new-room-description">
            </div>
           </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="changeName();">Accept </button>
          <button type="submit" class="btn btn-default" id="cancel-modify-room">Cancel</button>
        </div>
      </div>  
    </div>
  </div> 
  
  <!-- Confirmation modal delete-->
  <div class="modal fade" id="confirmation-Delete" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title text-center">Delete room<h3>
        </div>
        <div class="modal-body">
          <p class="confirm-delete-text">Are you sure you want to delete the room? All devices in this room will be deleted.</p>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="removeRoom()">Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>  
      </div>
    </div>
  </div> 


  <!-- MODALS DE DEVICES-->

  <!-- MODAL DE BLIND-->
  <div class="modal fade" id="device-blinds" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Blinds</h3>
        </div>
        <div class="modal-body">
          <form class="form-horizontal">
            <div class="form-group">
              <label for="blinds-type" class="control-label col-sm-4" style="text-align: right">Type:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="blinds-type" style="text-align: left">Blinds</p>
              </div>
              <br>
              <label for="blinds-name" class="control-label col-sm-4" style="text-align: right;">Name:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="blinds-name" style="text-align: left"></p> <!--hay que agregar el nombre que eligio el usuario-->
              </div>
              <label for="blinds-change-name" class="control-label col-sm-4" style="text-align: right">Change name:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" id="blinds-change-name" placeholder="Enter new name" name="blinds-change-name">
              </div>
              <br>
              <label for="blinds-description" class="control-label col-sm-4" style="text-align: right">Description:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="blinds-description" style="text-align: left"> </p> <!--hay que agregar la descripcion que puso el usuario si es que la hubo, y "none" si es que no puso nada-->
              </div>
              <label for="blinds-change-description" class="control-label col-sm-4" style="text-align: right">Change description:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" placeholder="Enter new description" name="blinds-change-description" id="blinds-change-description">
              </div>
              <br>
              <label for="blinds-status" class="control-label col-sm-4" style="text-align: right">Current status:</label>
              <div class="col-sm-8">
                <label class="radio-inline"><input type="radio" name="optradio" id="blinds-open">Open</label>
                <label class="radio-inline"><input type="radio" name="optradio" id="blinds-closed" checked>Closed</label>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="saveChangesBlinds()">Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>  
    </div>
  </div>

    <!-- Modal de lamp -->
  <div class="modal fade" id="device-lamp" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title text-center">Lamp</h3>
        </div>
        <div class="modal-body">
          <form class="form-horizontal">
            <div class="form-group">
              <label for="lamp-type" class="control-label col-sm-4" style="text-align: right">Type:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="lamp-type" style="text-align: left">Lamp</p>
              </div>
              <br>
              <label for="lamp-name" class="control-label col-sm-4" style="text-align: right">Name:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="lamp-name" style="text-align: left"></p> <!--hay que agregar el nombre que eligio el usuario-->
              </div>
              <label for="lamp-change-name" class="control-label col-sm-4" style="text-align: right">Change name:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" id="lamp-change-name" placeholder="Enter new name" name="lamp-change-name">
              </div>
              <br>
              <label for="lamp-description" class="control-label col-sm-4" style="text-align: right">Description:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="lamp-description" style="text-align: left"></p> <!--hay que agregar la descripcion que puso el usuario si es que la hubo, y "none" si es que no puso nada-->
              </div>
              <label for="lamp-change-description" class="control-label col-sm-4" style="text-align: right">Change description:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" id="lamp-change-description" placeholder="Enter new description" name="lamp-change-description">
              </div>
              <p class="trampa">a</p>
              <label for="lamp-status" class="control-label col-sm-4" style="text-align: right">Current status:</label>
              <div class="col-sm-8">
                <label class="switch">
                  <input type="checkbox" id="lamp-switch">
                  <span class="slider round"></span>
                </label>
              </div>      
              <br>
              <label for="lamp-brightness" class="control-label col-sm-4" style="text-align: right">Current brightness:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="lamp-brightness" style="text-align: left">asd</p> <!--hay que poner el brillo actual-->
              </div>
              <label for="lamp-change-brightness" class="control-label col-sm-4" style="text-align: right">Change brightness:</label>
              <div class="col-sm-8">
                <input type="number" class="form-control" id="lamp-change-brightness" placeholder="Enter new brightness (0 - 100)" name="lamp-change-brightness" min="0" max="100"> <!--hay que verificar que sea un numero entre 0 y 100-->
              </div>
              <br>
              <label for="lamp-color" class="control-label col-sm-4" style="text-align: right">Current color:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="lamp-color" style="text-align: left"></p> <!--hay que poner el color actual-->
              </div>
              <label for="lamp-change-color" class="control-label col-sm-4" style="text-align: right">Select new color:</label>
              <div class="col-sm-8">
                <div id="cp3" class="input-group colorpicker-component">
                  <input type="text" value="#00AABB" class="form-control" />
                  <span class="input-group-addon"><i></i></span>
                </div>
              </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="saveChangesLamp()">Accept</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>

      <!-- Modal de oven -->
  <div class="modal fade" id="device-oven" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Oven</h3>
        </div>
        <div class="modal-body">
          <form class="form-horizontal">
            <div class="form-group">
              <label for="oven-type" class="control-label col-sm-6" style="text-align: right">Type:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="oven-type" style="text-align: left">Oven</p>
              </div>
              <br>
              <label for="oven-name" class="control-label col-sm-6" style="text-align: right;">Name:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="oven-name" style="text-align: left"></p> <!--hay que agregar el nombre que eligio el usuario-->
              </div>
              <label for="oven-change-name" class="control-label col-sm-6" style="text-align: right">Change name:</label>
              <div class="col-sm-6">
                <input type="text" class="form-control" id="oven-change-name" placeholder="Enter new name" name="oven-change-name">
              </div>
              <br>
              <label for="oven-description" class="control-label col-sm-6" style="text-align: right">Description:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="oven-description" style="text-align: left"></p> <!--hay que agregar la descripcion que puso el usuario si es que la hubo, y "none" si es que no puso nada-->
              </div>
              <label for="oven-change-description" class="control-label col-sm-6" style="text-align: right">Change description:</label>
              <div class="col-sm-6">
                <input type="text" class="form-control" id="oven-change-description" placeholder="Enter new description" name="oven-change-description">
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="oven-status" class="control-label col-sm-6" style="text-align: right">Current status:</label>
              <div class="col-sm-6">
                <label class="switch">
                  <input type="checkbox" id="oven-switch">
                  <span class="slider round"></span>
                </label>
              </div> 
              <br>
              <label for="oven-temperature" class="control-label col-sm-6" style="text-align: right">Current temperature (in centigrades):</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="oven-temperature" style="text-align: left;"></p>       <!--hay que poner la temperatura actual-->
              </div>
              <label for="oven-change-temperature" class="control-label col-sm-6" style="text-align: right;">Change temperature:</label>
              <div class="col-sm-6">
                <input type="number" class="form-control" id="oven-change-temperature" placeholder="Enter new temperature (90 - 230)" name="oven-change-temperature" min="90" max="230">    <!--hay que verificar que este entre 90 y 230-->
              </div>
              <br>
              <label for="oven-heatmode" class="control-label col-sm-6" style="text-align: right;">Current heat mode:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="oven-heatmode" style="text-align: left;"></p>        <!--hay que poner el heat mode actual-->
              </div>
              <label for="oven-change-heatmode" class="control-label col-sm-6" style="text-align: right;">Change heat mode:</label>
              <div class="col-sm-6">
                <select class="form-control" id="oven-change-heatmode">
                    <option val="conventional">Conventional</option>
                    <option val="bottom">Bottom</option>
                    <option val="top">Top</option>
                  </select>
              </div>
              <br>
              <label for="oven-grillmode" class="control-label col-sm-6" style="text-align: right;">Current grill mode:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="oven-grillmode" style="text-align: left;"></p>        <!--hay que poner el grill mode actual-->
              </div>
              <label for="oven-change-grillmode" class="control-label col-sm-6" style="text-align: right;">Change grill mode:</label>
              <div class="col-sm-6">
                <select class="form-control" id="oven-change-grillmode">
                    <option val="large">Large</option>
                    <option val="eco">Eco</option>
                    <option val="off">Off</option>
                  </select>
              </div>
              <br>
              <label for="oven-convectionmode" class="control-label col-sm-6" style="text-align: right;">Current convection mode:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="oven-convectionmode" style="text-align: left;"></p>        <!--hay que poner el convection mode actual-->
              </div>
              <label for="oven-change-convectionmode" class="control-label col-sm-6" style="text-align: right;">Change convection mode:</label>
              <div class="col-sm-6">
                <select class="form-control" id="oven-change-convectionmode">
                    <option val="normal">Normal</option>
                    <option val="eco">Eco</option>
                    <option val="off">Off</option>
                  </select>
              </div>
            </div> 
          </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" >Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>  
    </div>
  </div>

  <!-- Modal de ac -->
  <div class="modal fade" id="device-ac" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Ac</h3>
        </div>
        <div class="modal-body">
          <form class="form-horizontal">
            <div class="form-group">
              <label for="ac-type" class="control-label col-sm-6" style="text-align: right">Type:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="ac-type" style="text-align: left">Ac</p>
              </div>
              <br>
              <label for="ac-name" class="control-label col-sm-6" style="text-align: right;">Name:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="ac-name" style="text-align: left"></p> <!--hay que agregar el nombre que eligio el usuario-->
              </div>
              <label for="ac-change-name" class="control-label col-sm-6" style="text-align: right">Change name:</label>
              <div class="col-sm-6">
                <input type="text" class="form-control" id="ac-change-name" placeholder="Enter new name" name="ac-change-name">
              </div>
              <br>
              <label for="ac-description" class="control-label col-sm-6" style="text-align: right">Description:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="ac-description" style="text-align: left"></p> <!--hay que agregar la descripcion que puso el usuario si es que la hubo, y "none" si es que no puso nada-->
              </div>
              <label for="ac-change-description" class="control-label col-sm-6" style="text-align: right">Change description:</label>
              <div class="col-sm-6">
                <input type="text" class="form-control" id="ac-change-description" placeholder="Enter new description" name="ac-change-description">
              </div>
              <br>
              <p class="trampa">a</p>
              <label for="ac-status" class="control-label col-sm-6" style="text-align: right">Current status:</label>
              <div class="col-sm-6">
                <label class="switch">
                  <input type="checkbox" id="ac-switch">
                  <span class="slider round"></span>
                </label>
              </div> 
              <br>
              <label for="ac-temperature" class="control-label col-sm-6" style="text-align: right">Current temperature (in centigrades):</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="ac-temperature" style="text-align: left;"></p>       <!--hay que poner la temperatura actual-->
              </div>
              <label for="ac-change-temperature" class="control-label col-sm-6" style="text-align: right;">Change temperature:</label>
              <div class="col-sm-6">
                <input type="number" class="form-control" id="ac-change-temperature" placeholder="Enter new temperature (18 - 38)" name="ac-change-temperature" min="18" max="38">    <!--hay que verificar que este entre 18 y 38-->
              </div>
              <br>
              <label for="ac-mode" class="control-label col-sm-6" style="text-align: right;">Current mode:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="ac-mode" style="text-align: left;"></p>        <!--hay que poner el mode actual-->
              </div>
              <label for="ac-change-mode" class="control-label col-sm-6" style="text-align: right;">Change mode:</label>
              <div class="col-sm-6">
                <select class="form-control" id="ac-change-mode">
                    <option val="cool">Cool</option>
                    <option val="heat">Heat</option>
                    <option val="fan">Fan</option>
                  </select>
              </div>
              <br>
              <label for="ac-verticalswing" class="control-label col-sm-6" style="text-align: right;">Current vertical swing:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="ac-verticalswing" style="text-align: left;"></p>        <!--hay que poner el vertical swing actual-->
              </div>
              <label for="ac-change-verticalswing" class="control-label col-sm-6" style="text-align: right;">Change vertical swing:</label>
              <div class="col-sm-6">
                <select class="form-control" id="ac-change-verticalswing">
                    <option val="auto">Auto</option>
                    <option val="22">22°</option>
                    <option val="45">45°</option>
                    <option val="67">67°</option>
                    <option val="90">90°</option>
                  </select>
              </div>
              <br>
              <label for="ac-horizontalswing" class="control-label col-sm-6" style="text-align: right;">Current horizontal swing:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="ac-horizontal swing" style="text-align: left;"></p>        <!--hay que poner el horizontal swing actual-->
              </div>
              <label for="ac-change-horizontalswing" class="control-label col-sm-6" style="text-align: right;">Change horizontal swing:</label>
              <div class="col-sm-6">
                <select class="form-control" id="ac-change-horizontalswing">
                    <option val="auto">Auto</option>
                    <option val="-90">-90°</option>
                    <option val="-45">-45°</option>
                    <option val="0">0°</option>
                    <option val="45">45°</option>
                    <option val="90">90°</option>
                  </select>
              </div>
              <br>
              <label for="ac-fanspeed" class="control-label col-sm-6" style="text-align: right;">Current fan speed:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="ac-fanspeed" style="text-align: left;"></p>        <!--hay que poner el fan speed actual-->
              </div>
              <label for="ac-change-fanspeed" class="control-label col-sm-6" style="text-align: right;">Change fan speed:</label>
              <div class="col-sm-6">
                <select class="form-control" id="ac-change-fanspeed">
                    <option val="auto">Auto</option>
                    <option val="25">25</option>
                    <option val="50">50</option>
                    <option val="75">75</option>
                    <option val="100">100</option>
                  </select>
              </div>
            </div> 
          </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" >Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>  
    </div>
  </div>
      
  <!-- MODAL DE DOOR-->
  <div class="modal fade" id="device-door" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Door</h3>
        </div>
        <div class="modal-body">
          <form class="form-horizontal">
            <div class="form-group">
              <label for="door-type" class="control-label col-sm-4" style="text-align: right">Type:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="door-type" style="text-align: left">Door</p>
              </div>
              <br>
              <label for="door-name" class="control-label col-sm-4" style="text-align: right;">Name:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="door-name" style="text-align: left"></p> <!--hay que agregar el nombre que eligio el usuario-->
              </div>
              <label for="door-change-name" class="control-label col-sm-4" style="text-align: right">Change name:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" id="door-change-name" placeholder="Enter new name" name="door-change-name">
              </div>
              <br>
              <label for="door-description" class="control-label col-sm-4" style="text-align: right">Description:</label>
              <div class="col-sm-8">
                <p class="form-control-static" id="door-description" style="text-align: left" id="door-description"> </p> <!--hay que agregar la descripcion que puso el usuario si es que la hubo, y "none" si es que no puso nada-->
              </div>
              <label for="door-change-description" class="control-label col-sm-4" style="text-align: right">Change description:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" placeholder="Enter new description" name="door-change-description" id="door-change-description">
              </div>
              <br>
              <label for="door-status" class="control-label col-sm-4" style="text-align: right">Current status:</label>
              <div class="col-sm-8">
                <fieldset id="door-status-check">  
                  <label class="radio-inline"><input type="radio" name="door-status-check" id="door-open">Open</label>
                  <label class="radio-inline"><input type="radio" name="door-status-check" id="door-closed" checked>Closed</label>
                </fieldset>
              </div>
              <br>
              <label for="door-lock" class="control-label col-sm-4" style="text-align: right">Current lock:</label>
              <div class="col-sm-8">
                <fieldset id="door-lock-check">  
                  <label class="radio-inline"><input type="radio" name="door-lock-check" id="door-locked">Locked</label>                <!--esto hay que ponerlo en disabled si la puerta esta abierta-->
                  <label class="radio-inline"><input type="radio" name="door-lock-check" id="door-unlocked" checked>Unlocked</label>      
                </fieldset>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>  
    </div>
  </div>

  <!-- Modal de refrigerator-->
  <div class="modal fade" id="device-refrigerator" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Refrigerator</h3>
        </div>
        <div class="modal-body">
          <form class="form-horizontal">
            <div class="form-group">
              <label for="refrigerator-type" class="control-label col-sm-6" style="text-align: right">Type:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="refrigerator-type" style="text-align: left">Refrigerator</p>
              </div>
              <br>
              <label for="refrigerator-name" class="control-label col-sm-6" style="text-align: right;">Name:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="refrigerator-name" style="text-align: left"></p> <!--hay que agregar el nombre que eligio el usuario-->
              </div>
              <label for="refrigerator-change-name" class="control-label col-sm-6" style="text-align: right">Change name:</label>
              <div class="col-sm-6">
                <input type="text" class="form-control" id="refrigerator-change-name" placeholder="Enter new name" name="refrigerator-change-name">
              </div>
              <br>
              <label for="refrigerator-description" class="control-label col-sm-6" style="text-align: right">Description:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="refrigerator-description" style="text-align: left"></p> <!--hay que agregar la descripcion que puso el usuario si es que la hubo, y "none" si es que no puso nada-->
              </div>
              <label for="refrigerator-change-description" class="control-label col-sm-6" style="text-align: right">Change description:</label>
              <div class="col-sm-6">
                <input type="text" class="form-control" id="refrigerator-change-description" placeholder="Enter new description" name="refrigerator-change-description">
              </div>
              <br>
              <label for="refrigerator-temperature" class="control-label col-sm-6" style="text-align: right">Current temperature (in centigrades):</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="refrigerator-temperature" style="text-align: left;"></p>       <!--hay que poner la temperatura actual-->
              </div>
              <label for="refrigerator-change-temperature" class="control-label col-sm-6" style="text-align: right;">Change temperature:</label>
              <div class="col-sm-6">
                <input type="number" class="form-control" id="refrigerator-change-temperature" placeholder="Enter new temperature (2 - 8)" name="refrigerator-change-temperature" min="2" max="8">
              </div>
              <br>
              <label for="refrigerator-freezertemperature" class="control-label col-sm-6" style="text-align: right">Current freezer temperature (in centigrades):</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="refrigerator-freezertemperature" style="text-align: left;"></p>       <!--hay que poner la temperatura del freezer actual-->
              </div>
              <label for="refrigerator-change-freezertemperature" class="control-label col-sm-6" style="text-align: right;">Change freezer temperature:</label>
              <div class="col-sm-6">
                <input type="number" class="form-control" id="refrigerator-change-freezertemperature" placeholder="Enter new temperature ((-20) - (-8))" name="refrigerator-change-freezertemperature" min="-20" max="-8">
              </div>
              <br>
              <label for="refrigerator-mode" class="control-label col-sm-6" style="text-align: right;">Current mode:</label>
              <div class="col-sm-6">
                <p class="form-control-static" id="refrigerator-mode" style="text-align: left;"></p>        <!--hay que poner el mode actual-->
              </div>
              <label for="refrigerator-change-mode" class="control-label col-sm-6" style="text-align: right;">Change mode:</label>
              <div class="col-sm-6">
                <select class="form-control" id="refrigerator-change-mode">
                    <option val="default">Default</option>
                    <option val="vacation">Vacation</option>
                    <option val="party">Party</option>
                  </select>
              </div>
            </div> 
          </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" >Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>  
    </div>
  </div>    
<!-- End page content -->
  
  
<script>

var actualRoomName;

$(document).ready(function(){
    $("#new-room").click(function(){
        document.getElementById("room-name").value = "";
        $("#room").modal();
    });
});

$(document).ready(function(){
    $("#close-create-room").click(function(){
        $("#room").modal("hide");
        document.getElementById("room-name").value = "";
    });
});

$(document).ready(function(){
    $("#cancel-modify-room").click(function(){
        $("#modify-room").modal("hide");
        document.getElementById("new-room-name").value = "";
    });
});

$(document).ready(function(){
    $("#cancel-icon-modify-room").click(function(){
        $("#modify-room").modal("hide");
        document.getElementById("new-room-name").value = "";
    });
});


/* Esto es para que el enter no haga nada */
addEventListener("keydown", function(event) {
    if (event.keyCode == 13){
    }
 });



function cancelRoom(){
    document.getElementById("room-name").value = "";
    $("#room").modal("hide");
}


var api = class {
  static get baseUrl() {
    return "http://127.0.0.1:8080/api/";
  }

  static get timeout() {
    return 60 * 1000;
  }
}
api.room = class {
  static get url() {
    return api.baseUrl + "rooms/";
  }

  static add(room) {
   return $.ajax({
      url: api.room.url,
      method: "POST",
      dataType: "json",
      timeout: api.timeout,
      async: false,
      data: room
    }); 
  }

  static modify(room) {
   return $.ajax({
      url: api.room.url + room.id,
      method: "PUT",
      dataType: "json",
      timeout: api.timeout,
      async: false,
      data: room
    }); 
  }

  static delete(id) {
   return $.ajax({
      url: api.room.url + id,
      method: "DELETE",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    }); 
  }

  static get(id) {
    return $.ajax({
      url: api.room.url + id,
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static getRoomDevices(id) {
    return $.ajax({
      url: api.room.url + id + "/devices",
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }


  static getAll(){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/rooms",
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }
}

api.device = class {
  static get url() {
    return api.baseUrl + "devices/";
  }

  static add(device) {
   return $.ajax({
      url: api.device.url,
      method: "POST",
      dataType: "json",
      timeout: api.timeout,
      async: false,
      data: device
    }); 
  }

  static modify(device) {
   return $.ajax({
      url: api.device.url + device.id,
      method: "PUT",
      dataType: "json",
      timeout: api.timeout,
      async: false,
      data:device
    }); 
  }

  static delete(id) {
   return $.ajax({
      url: api.device.url + id,
      method: "DELETE",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    }); 
  }

  static get(id) {
    return $.ajax({
      url: api.device.url + id,
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static linkToRoom(idDevice,idRoom){
      return $.ajax({
      url: "http://127.0.0.1:8080/api" + /devices/+ idDevice + /rooms/ + idRoom,
      method: "POST",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static getAll(){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices",
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static getTypes(){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devicetypes",
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static getType(id){
      return $.ajax({
      url: "http://127.0.0.1:8080/api/devicetypes/" + id,
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static getState(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/getState",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }
}

api.blind = class{

  constructor(id,typeId,name,description){
    this.id = id;
    this.typeId = typeId;
    this.name = name;
    this.description = description;
  }

  up(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "up",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }

  down(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "down",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }

}

api.lamp = class {

    constructor(id,typeId,name,description){
    this.id = id;
    this.typeId = typeId;
    this.name = name;
    this.description = description;
  }
    turnOn(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "turnOn",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }

    turnOff(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "turnOff",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }
    
    changeBrightness(deviceID,integer){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/" + "changeBrightness",
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      async: false,
      data: integer
    });
  }

}

api.model = api.model || {};

api.model.room = class {
  constructor(id, name, meta) {
    if (id) {
      this.id = id;
    } else {
      delete(this.id);
    }
    this.name = name;
    this.meta = meta;
  }
}

api.model.device = class {
  constructor(typeId, name, meta) {
    if (typeId) {
      this.typeId = typeId;
    } else {
      delete(this.typeId);
    }
    this.name = name;
    this.meta = meta;
  }
}

api.model.action = class{
    constructor(name,params) {
     this.name = name;
     this.params = params;
  }
}



function getNameRoom(){
    var name = document.getElementById("room-name").value;
    return name;
}


function createRoom(){
if(! isAlphaNumeric(getNameRoom())){
  alert("The room name must contain only letters or numbers")
  return;
}

if( document.getElementById(getNameRoom())){
    alert("Name already exists");
    return;
}

if(getNameRoom() == ""){
    alert("Please put a name for the room");
    return;
}

if(getNameRoom().length < 3){
  alert("The room name must have at least 3 characters");
  return;
}
var div = document.createElement("div");
div.classList.add("span-a");
var para = document.createElement("a");//Creo el tipo de elemento
para.setAttribute("id", getNameRoom() + "room");
var node = document.createTextNode(getNameRoom()); //le digo su contenido
para.setAttribute("type", getNameRoom());
para.setAttribute("onclick", "showDevicesRoom(this);");
para.setAttribute("href","#");
para.appendChild(node);
para.className = "chargeDiv";
var button = document.createElement("button");
button.setAttribute("onclick", "modifyRoom(this);");
button.setAttribute("id", getNameRoom());
button.classList.add("mod-room");
button.classList.add("mod-room-pencil");
var span = document.createElement("span");
span.classList.add("glyphicon");
span.classList.add("glyphicon-pencil");
var button1 = document.createElement("button");
button1.setAttribute("onclick", "confirmDelete(this);");
button1.setAttribute("id", getNameRoom() + "trash");
button1.setAttribute("data-info",getNameRoom());
button1.classList.add("mod-room");
var span1 = document.createElement("span");
span1.classList.add("glyphicon");
span1.classList.add("glyphicon-trash");
button.appendChild(span);
button1.appendChild(span1);
div.appendChild(para);
div.appendChild(button);
div.appendChild(button1);
var element = document.getElementById("ver-menu");
element.appendChild(div);
createRightContainer(getNameRoom());
var room = new api.model.room(null, getNameRoom(), "{ size: 9 metros }");
api.room.add(room)
$("#room").modal("hide");
}


function loadAll(){
  api.room.getAll()
  .done(function (data) {
    // data tiene el valor retornado por la petición Ajax
    loadRooms(data)
    loadDevices(data)
  })
  .fail(function (jqXHR, textStatus) {
    alert ('Request failed:' + textStatus);
  })
  
  api.device.getTypes()
  .done(function (data) {
    updateNewDeviceModal(data)
  })
  .fail(function (jqXHR, textStatus) {
    alert ('Request failed:' + textStatus);
  }) 
    
  
}

function loadRooms(data){
  var allRooms = data;
  for (var i = 0; i < allRooms.rooms.length; i++) {
      loadRoom(allRooms.rooms[i])
  }
}

function loadRoom(room){
  var roomName = room.name
  var div = document.createElement("div");
  div.classList.add("span-a");
  var para = document.createElement("a");//Creo el tipo de elemento
  para.setAttribute("id", roomName + "room");
  var node = document.createTextNode(roomName); //le digo su contenido
  para.setAttribute("type", roomName);
  para.setAttribute("onclick", "showDevicesRoom(this);");
  para.setAttribute("href","#");
  para.appendChild(node);
  para.className = "chargeDiv";
  var button = document.createElement("button");
  button.setAttribute("onclick", "modifyRoom(this);");
  button.setAttribute("id", roomName);
  button.classList.add("mod-room");
  button.classList.add("mod-room-pencil");
  var span = document.createElement("span");
  span.classList.add("glyphicon");
  span.classList.add("glyphicon-pencil");
  var button1 = document.createElement("button");
  button1.setAttribute("onclick", "confirmDelete(this);");
  button1.setAttribute("id", roomName + "trash");
  button1.setAttribute("data-info",roomName);
  button1.classList.add("mod-room");
  var span1 = document.createElement("span");
  span1.classList.add("glyphicon");
  span1.classList.add("glyphicon-trash");
  button.appendChild(span);
  button1.appendChild(span1);
  div.appendChild(para);
  div.appendChild(button);
  div.appendChild(button1);
  var element = document.getElementById("ver-menu");
  element.appendChild(div);
  createRightContainer(roomName);
}




function isAlphaNumeric(str) {
  var code, i, len;
  for (i = 0, len = str.length; i < len; i++) {
    code = str.charCodeAt(i);
    if (!(code > 47 && code < 58) && // numeric (0-9)
        !(code > 64 && code < 91) && // upper alpha (A-Z)
        !(code > 96 && code < 123) && // lower alpha (a-z)
        !(code == '-')) {         // '-'
      return false;
    }
  }
  return true;
};

function createRightContainer(roomName){

  var hiddenDiv = document.getElementById("hidden-div");

    var div = document.createElement("div");
    var idDivName = roomName + "holder";
    div.classList.add("right-container");
    div.setAttribute("id", idDivName);
    var div2 = document.createElement("div");
    div2.classList.add("wrapper-room-title-two");
    var h1 = document.createElement("h1");
    h1.classList.add("title-right-container");
    var h1Id = "title-room-" + roomName;
    h1.setAttribute("id",h1Id);
    var node = document.createTextNode(roomName);
    h1.appendChild(node);
    var hr = document.createElement("hr");
    hr.classList.add("right-fine-line");
    
    var div3 = document.createElement("div");
    div3.classList.add("wrapper-devices-container");
    var div4 = document.createElement("div");
    div4.classList.add("devices-container");
    div4.setAttribute("id", roomName + "devices-container");
    var div5 = document.createElement("div");
    div5.classList.add("device-container");
    var button = document.createElement("button");
    button.classList.add("create-device");
    button.setAttribute("onclick","openCreateDeviceModal();");
    var idButtonName = roomName + "new-device";
    button.setAttribute("id", idButtonName);
    
    
    hiddenDiv.appendChild(div);
    div.appendChild(div2);
    div.appendChild(div3);
    
    div2.appendChild(h1);
    div2.appendChild(hr);
    
    div3.appendChild(div4);
    div4.appendChild(div5);
    
    div5.appendChild(button);

}

function showDevicesRoom(nameRoom){
  var hiddenDiv = document.getElementById("hidden-div")
  var mainDiv = document.getElementById("main-container");
  requiredDiv = mainDiv.children[1];
  clone = requiredDiv.cloneNode(true);//problema espacio
  hiddenDiv.appendChild(clone);
  var idName = "#" + nameRoom.getAttribute("type") + "holder";
  var idName2 = nameRoom.getAttribute("type") + "holder";
  var idRightDevicesContainer = document.getElementById(nameRoom.getAttribute("type") + "devices-container")
  var modalDevice = document.getElementById("device");
  actualRoomName = nameRoom.getAttribute("type");
  modalDevice.setAttribute("type", idRightDevicesContainer.getAttribute("id"));
  $(requiredDiv).replaceWith($(idName));
}

function showInitialDevicesRoom(){
  var hiddenDiv = document.getElementById("hidden-div")
  var mainDiv = document.getElementById("main-container");
  requiredDiv = mainDiv.children[1];
  $(requiredDiv).replaceWith( $("#starter-right-container"));
}

function modifyRoom(button){
 document.getElementById("modify-room-header").setAttribute("type",button.getAttribute('id'));
 var roomName = button.getAttribute('id');
 document.getElementById("actual-room-name").innerHTML = roomName;
 $("#modify-room").modal();
}

function getNewNameRoom(){
    var newName = document.getElementById("new-room-name").value;
    return newName;
}

function changeName(){
  if(! isAlphaNumeric(getNewNameRoom())){
    alert("The room name must contain only letters or numbers")
    return;
  }

    if( document.getElementById(getNewNameRoom())){
    alert("Name already exists");
    return;
}

    if(getNewNameRoom() == ""){
        alert("Please put a name to change the room name");
        return;
}

if(getNewNameRoom().length < 3){
  alert("The room name must have at least 3 characters");
  return;
}

  var info = document.getElementById("modify-room-header");
  var oldName = info.getAttribute("type")
    var trashButton = document.getElementById(info.getAttribute("type") + "trash");
    var rightContainer = document.getElementById(info.getAttribute("type") + "holder")
    var idroom = info.getAttribute("type") + "room";
    var idbutton = info.getAttribute("type");
    var editButton = document.getElementById(idbutton);
    var titleId = "title-room-" + info.getAttribute("type");
    var title = document.getElementById(titleId);
    var newTitle = getNewNameRoom();
    var newDeviceButton = document.getElementById(info.getAttribute("type") + "new-device");
    title.innerHTML = newTitle;
    var room = document.getElementById(idroom);
    var devCont = document.getElementById(info.getAttribute("type") + "devices-container");
    devCont.setAttribute("id", getNewNameRoom() + "devices-container");
    newDeviceButton.setAttribute("id", getNewNameRoom() + "new-device")
    room.setAttribute("id",getNewNameRoom() + "room");
    room.setAttribute("type", getNewNameRoom());
    title.setAttribute("id", "title-room-" + newTitle);
    editButton.setAttribute("id",getNewNameRoom());
    trashButton.setAttribute("data-info",getNewNameRoom());
    trashButton.setAttribute("id", getNewNameRoom() + "trash")
    rightContainer.setAttribute("id" , getNewNameRoom() + "holder")
    room.innerHTML = getNewNameRoom();
    if(actualRoomName == info.getAttribute("type")){
      actualRoomName = getNewNameRoom();
      var modalDevice = document.getElementById("device");
      modalDevice.setAttribute("type", devCont.getAttribute("id"));

    }
    var newName = getNewNameRoom()
    document.getElementById("new-room-name").value = "";
    info.setAttribute("type", getNewNameRoom());
    modifyRoomFromDB(oldName,newName)
    $("#modify-room").modal("hide");

}

function modifyRoomFromDB(roomName, newRoomName){
  api.room.getAll()
  .done(function (data) {
    findAndUpdate(data,roomName,newRoomName)
  })
  .fail(function (jqXHR, textStatus) {
    alert ('Request failed:' + textStatus);
  })
}

function findAndUpdate(data,roomName,newRoomName){
  var allRooms = data;
  var idRoom;
  for (var i = 0; i < allRooms.rooms.length; i++) {
      if(roomName == allRooms.rooms[i].name){
        idRoom = allRooms.rooms[i].id;
      }
  }
  var modifiedRoom = new api.model.room(idRoom, newRoomName, "{ size: \"9m2\" }");
  api.room.modify(modifiedRoom)
}

function confirmDelete(roomName){
    $("#modify-room").modal("hide");
    updateRoomToDelete(roomName);
    $("#confirmation-Delete").modal();
}

function updateRoomToDelete(roomName){
  var updateName = roomName.getAttribute("data-info");
  document.getElementById("modify-room-header").setAttribute("type",updateName);

}

function closeConfirmationRoomDelete(){
    $("#confirmation-Delete").modal("hide");
    $("#modify-room").modal();
}

function removeRoom(){  
    var info = document.getElementById("modify-room-header");
    var rightContainer = document.getElementById(info.getAttribute("type") + "holder")
    var idroom = info.getAttribute("type") + "room";
    var room = document.getElementById(idroom);
    var parentRoom = room.parentNode
    parentRoom.parentNode.removeChild(parentRoom);
    if(actualRoomName == info.getAttribute("type")){
      showInitialDevicesRoom();
    }
    document.getElementById("hidden-div").appendChild(rightContainer);
    rightContainer.parentNode.removeChild(rightContainer);
    $("#confirmation-Delete").modal("hide");
    removeRoomFromDB(info.getAttribute("type"))
}

function removeRoomFromDB(roomName){
  api.room.getAll()
  .done(function (data) {
    findAndDelete(data,roomName)
  })
  .fail(function (jqXHR, textStatus) {
    alert ('Request failed:' + textStatus);
  })
}

function findAndDelete(data,roomName){
  var allRooms = data;
  var idRoom;
  for (var i = 0; i < allRooms.rooms.length; i++) {
      if(roomName == allRooms.rooms[i].name){
        idRoom = allRooms.rooms[i].id;
        deleteAllDevicesOfRoom(allRooms.rooms[i])
      }
  }
  api.room.delete(idRoom)
}

function deleteAllDevicesOfRoom(room){
  api.room.getRoomDevices(room.id)
  .done(function (data) {
    deleteAllDevices(data,room)
  })
  .fail(function (jqXHR, textStatus) {
    alert ('Request failed:' + textStatus);
  })
}

function deleteAllDevices(data,room){
  var allDevices = data;
  for (var i = 0; i < allDevices.devices.length; i++){
    api.device.delete(allDevices.devices[i].id)
  }
}

function openCreateDeviceModal(){
  $("#device").modal()  
}

function createDevice(){
  var comboBoxTypeDevices = document.getElementById("comboBoxTypeDevices")
  var deviceTypeId = comboBoxTypeDevices.options[comboBoxTypeDevices.selectedIndex].value
  var deviceName = document.getElementById("device-name").value;
  var deviceDesc = document.getElementById("device-description").value
  if(deviceTypeId == "none"){
    alert("You have not selected a device type");
    return;
  }
  
  if(deviceName.length < 3){
    alert("The device name must have at least 3 characters");
    return;
  }

  if(deviceDesc == ""){
    deviceDesc = "None"
  }

  var description = deviceDesc;
  var newDevice = new api.model.device(deviceTypeId, deviceName, description);
  api.device.add(newDevice)
  .done(function (data) {
    addDeviceToRoom(actualRoomName,data.device.id,data.device,1);
  })
  .fail(function (jqXHR, textStatus) {
    alert ('Request failed: Fallo al agregar el device' + textStatus);
  })
  document.getElementById("device-name").value = "";
  document.getElementById("device-description").value = "";
  comboBoxTypeDevices.selectedIndex = "0";
  $("#device").modal("hide") 
}



function addDeviceToRoom(roomName,deviceID,device,boolean){
  api.room.getAll()
  .done(function (data) {
    findRoomForDevice(data,roomName,deviceID,device,boolean)
  })
  .fail(function (jqXHR, textStatus) {
    alert ('Request failed:' + textStatus);
  })
  
}

function findRoomForDevice(dato,roomName,deviceID,device,boolean){
  var allRooms = dato;
  var idRoom;
  var room;
  for (var i = 0; i < allRooms.rooms.length; i++) {
      if(roomName == allRooms.rooms[i].name){
        idRoom = allRooms.rooms[i].id;
        room = allRooms.rooms[i];
      }
  }

  api.device.linkToRoom(deviceID,idRoom)
  .done(function (data) {
    if(boolean == 1)
      chargeDevice(device,room)
  })
  .fail(function (jqXHR, textStatus) {
    alert ('Request failed:' + textStatus);
  })

}

function loadDevices(data){
  var allRooms = data;
  for (var i = 0; i < allRooms.rooms.length; i++) {
    getDevices(allRooms.rooms[i])
  }
}

function getDevices(room){
  api.room.getRoomDevices(room.id)
  .done(function (data) {
      chargeDevices(data,room)
  })
  .fail(function (jqXHR, textStatus) {
      alert ('Request failed:' + textStatus);
  })
}

function chargeDevices(data,room){
  var allDevices = data;
  for (var i = 0; i < allDevices.devices.length; i++){
    chargeDevice(allDevices.devices[i],room)
  }
  
}

function chargeDevice(device,room){
  var idDevicesContainer = room.name + "devices-container"
  var devicesContainer = document.getElementById(idDevicesContainer);
  var deviceContainer = document.createElement("div");
  deviceContainer.classList.add("device-container");
  deviceContainer.setAttribute("data-name",device.name)
  deviceContainer.setAttribute("data-desc",device.meta)
  deviceContainer.setAttribute("data-typeID",device.typeId)
  deviceContainer.setAttribute("data-ID",device.id)
  var buttonDevice = document.createElement("button");
  setDeviceImage(buttonDevice, device.typeId)
  buttonDevice.classList.add("new-device-button");
  buttonDevice.setAttribute("data-name",device.name)
  buttonDevice.setAttribute("data-desc",device.meta)
  buttonDevice.setAttribute("data-typeID",device.typeId)
  buttonDevice.setAttribute("data-ID",device.id)
  buttonDevice.setAttribute("id", device.name + "-" + device.typeId)
  deviceContainer.appendChild(buttonDevice);
  devicesContainer.appendChild(deviceContainer);
  var newDeviceButton = document.getElementById(room.name + "new-device");
  var parentNewDeviceButton = newDeviceButton.parentNode
  parentNewDeviceButton.parentNode.removeChild(parentNewDeviceButton);
  devicesContainer.appendChild(parentNewDeviceButton);
}

function setDeviceImage(buttonDevice,deviceTypeId){
  api.device.getType(deviceTypeId)
  .done(function (data) {
    switch(data.device.name) {
    case "blind":
        buttonDevice.style.backgroundImage = "url('Blinds.png')";
        buttonDevice.setAttribute("data-type","blinds")
        buttonDevice.setAttribute("onclick","viewBlindState(this)");
        break;
    case "lamp":
        buttonDevice.style.backgroundImage = "url('Lamp.png')";
        buttonDevice.setAttribute("data-type","lamp")
        buttonDevice.setAttribute("onclick","viewLampState(this)");
        break;
    case "oven":
        buttonDevice.style.backgroundImage = "url('Oven.png')";
        buttonDevice.setAttribute("data-type","oven")
        break;
    case "ac":
        buttonDevice.style.backgroundImage = "url('Ac.png')";
        buttonDevice.setAttribute("data-type","ac")
        break;
    case "alarm":
        buttonDevice.style.backgroundImage = "url('Alarm.png')";
        buttonDevice.setAttribute("data-type","alarm")
        break;
    case "timer":
        buttonDevice.style.backgroundImage = "url('Timer.png')";
        buttonDevice.setAttribute("data-type","timer")
        break;
    case "door":
        buttonDevice.style.backgroundImage = "url('Door.png')";
        buttonDevice.setAttribute("data-type","door")
        break;
    case "refrigerator":
        buttonDevice.style.backgroundImage = "url('Fridge.png')";
        buttonDevice.setAttribute("data-type","refrigerator")
        break;
    default:
        buttonDevice.style.backgroundImage = "url('Default.png')";
}
  })
  .fail(function (jqXHR, textStatus) {
    alert ('Request failed: error en setDeviceImage' + textStatus);
  })
}


function updateNewDeviceModal(data){
  var allDevicesTypes = data;
  var typeName;
  for (var i = 0; i < allDevicesTypes.devices.length; i++){
    typeName = allDevicesTypes.devices[i].name
    var select = document.getElementById("comboBoxTypeDevices")
    var option = document.createElement("option")
    option.setAttribute("value",allDevicesTypes.devices[i].id)
    option.innerHTML = typeName
    select.appendChild(option)
  }
}

function viewBlindState(button){
   document.getElementById("device-blinds").setAttribute("data-device",button.getAttribute("id"))
   updateDeviceBlindModal(button)
   $("#device-blinds").modal();
}

function updateDeviceBlindModal(button){
  document.getElementById("blinds-name").innerHTML = button.getAttribute("data-name");
  document.getElementById("blinds-description").innerHTML = button.getAttribute("data-desc");
  api.device.getState(button.getAttribute("data-ID"))
  .done(function (data) {
      updateBlindState(button,data)
  })
  .fail(function (jqXHR, textStatus) {
      alert ('Request failed: al cargar el status de cortina' + textStatus);
  })
}


function saveChangesBlinds(){
    var blind = new api.blind(null,null,null,null)
    modifyDevice("device-blinds","blinds-change-name","blinds-change-description",blind)
    if(document.getElementById("blinds-open").checked == true){
      blind.up(blind.id)
    }
    else{
      blind.down(blind.id)
    }
    $("#device-blinds").modal("hide");
}

function modifyDevice(modalID,newNameID,newDescID,deviceObj){
   var device = document.getElementById(document.getElementById(modalID).getAttribute("data-device"));
   deviceObj.id = device.getAttribute("data-ID")
   deviceObj.name = document.getElementById(newNameID).value;
   deviceObj.description = document.getElementById(newDescID).value;
   deviceObj.typeId = device.getAttribute("data-typeID")
   if(deviceObj.name.length != 0 && deviceObj.name.length < 3){
    alert("The device name must have at least 3 characters")
    return;
   }
   if(deviceObj.name.length != 0 || deviceObj.description.length != 0){
     if(deviceObj.description == "")
      deviceObj.description = device.getAttribute("data-desc");
     if(deviceObj.name  == "")
      deviceObj.name = device.getAttribute("data-name")
     api.device.get(deviceObj.id)
      .done(function (data) {
        data.device.name = deviceObj.name
        data.device.meta = deviceObj.description
        api.device.modify(data.device)
        .done(function (boolean){
          addDeviceToRoom(actualRoomName,data.device.id,data.device,0)
        })
      .fail(function (jqXHR, textStatus) {
        alert ('Request failed:' + textStatus);
        })
      })
      .fail(function (jqXHR, textStatus) {
      alert ('Request failed:' + textStatus);
      })
    }else{
      deviceObj.description = device.getAttribute("data-desc");
      deviceObj.name = device.getAttribute("data-name")
    }

  device.setAttribute("data-name",deviceObj.name)
  device.setAttribute("data-desc",deviceObj.description)
  document.getElementById(newDescID).value = "";
  document.getElementById(newNameID).value = "";
}

function updateBlindState(button,data){
  var status = data.result.status
  if(status == "opened" || status == "opening")
    document.getElementById("blinds-open").checked = true
  else
    document.getElementById("blinds-closed").checked = true
}

function viewLampState(button){
   document.getElementById("device-lamp").setAttribute("data-device",button.getAttribute("id"))
   updateDeviceLampModal(button)
   $("#device-lamp").modal();
}

function updateDeviceLampModal(button){
  document.getElementById("lamp-name").innerHTML = button.getAttribute("data-name");
  document.getElementById("lamp-description").innerHTML = button.getAttribute("data-desc");
  api.device.getState(button.getAttribute("data-ID"))
  .done(function (data) {
      updateLampState(button,data)
  })
  .fail(function (jqXHR, textStatus) {
      alert ('Request failed: al cargar el status de cortina' + textStatus);
  })
}

function updateLampState(button,data){
  var status = data.result.status
  if(status == "on"){
    document.getElementById("lamp-switch").checked = true;
    document.getElementById("lamp-brightness").innerHTML = data.result.brightness;
    document.getElementById("lamp-color").innerHTML = data.result.color;
  }
  else{
    document.getElementById("lamp-switch").checked = false
    document.getElementById("lamp-brightness").innerHTML = "";
    document.getElementById("lamp-color").innerHTML = "";
  }
}


function saveChangesLamp(){
    var lamp = new api.lamp(null,null,null,null)
    modifyDevice("device-lamp","lamp-change-name","lamp-change-description",lamp)
    var newBrightness = document.getElementById("lamp-change-brightness").value;
    if(newBrightness == "")
      newBrightness = 100;
    var newBrightnessJSON={"0":newBrightness}; //si fueran 2 parametros seria {"0":newBrightness,"1":segundaParam}
    var parameter = JSON.stringify(newBrightnessJSON)
    var action = new api.model.action("changeColor", ["FFFFF"])
    if(document.getElementById("lamp-switch").checked == true){
      lamp.turnOn(lamp.id)
      .done(function (data) {
        lamp.changeBrightness(lamp.id,parameter)
        })
      .fail(function (jqXHR, textStatus) {
        alert ('Request failed:' + textStatus);
        })
    }
    else{
      lamp.turnOff(lamp.id)
    }
    document.getElementById("lamp-change-brightness").value = "";
    $("#device-blinds").modal("hide");
}

$(function() {
    $('#cp3').colorpicker({
       color: '#AA3399',
        format: 'hex',
    });
});

</script>
</body>
</html>
