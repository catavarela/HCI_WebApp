<!DOCTYPE html>
<html lang="en">
<head>
  <title>Combinations</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.3.6/css/bootstrap-colorpicker.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-2.2.2.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.3.6/js/bootstrap-colorpicker.js"></script>
<style>

html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}
/* Extract from normalize.css by Nicolas Gallagher and Jonathan Neal git.io/normalize */
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}
img{border-style:none}

::-webkit-input-placeholder{color:inherit;opacity:0.54}
::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}
/* End extract */

html,body{font-family:Verdana,sans-serif;font-size:15px;line-height:1.5}html{overflow-x:hidden}
h3{font-family:"Segoe UI",Arial,sans-serif;font-weight:10;margin:10px 0;color:#3b7aaf;
    text-align:left;
    font-size:3vw;
    display: block;}

.my-image{max-width:100%;height:auto}img{margin-bottom:-5px}

.my-display-container{position:relative}
.my-container:after,.my-container:before,.my-row-padding:after,.my-row-padding:before{content:"";display:table;clear:both}
.my-col{float:left;width:100%}

@media (min-width:601px){.my-col.m6{width:49.99999%}}
@media (min-width:993px){.my-col.l3{width:24.99999%}}
.my-content{max-width:980px;margin:auto}

.my-display-topleft{position:absolute;left:0;top:0}

.my-row-padding,.my-row-padding>.my-col{padding:0 8px}
.my-container{padding:0.01em 16px}

.my-border-bottom{border-bottom-color: #d3d3d3; border-style: solid; border-bottom-width: thin; border-top-color: transparent; border-right-color: transparent; border-left-color: transparent;}
.my-margin-bottom{margin-bottom:16px!important}
.my-padding{padding:8px 16px!important}
.my-padding-16{padding-top:16px!important;padding-bottom:16px!important}
.my-padding-0-16{padding-top:0px!important;padding-bottom:16px!important}
.my-padding-32{padding-top:32px!important;padding-bottom:32px!important}
.my-padding-0-32{padding-top:0px!important;padding-bottom:32px!important}

.my-black{color:#fff!important;background-color:#000!important}

 .logo{
 background-image:url("smart_house_logo.png");
 background-size: 56px 56px;
 background-repeat: no-repeat;
 width: 56px;
 height: 56px;
}

 .justify-center-56px{
  justify-content: center;
  display: flex;
  flex-direction: row;
  height: 56px;
 }

 .flex-center{
  display: flex;
  align-items: center;
 }

 .tam{
    font-size:16px;
 }

 .color{
  background-color: black;
 }
}

 .modal-footer{
  background-color: #D8E4EF;
  border-bottom-right-radius: 12px;
  border-bottom-left-radius: 12px;
 }

.modal-header{
  border-bottom-right-radius: 12px;
  border-bottom-left-radius: 12px;
 }

.error{
  color:red;
  font-size:75%;
  display:none;
}

.notification{
  width:200px;
  height:35px;
  background-color: #B1CADF;
  position: absolute;
  bottom:15px;
  right:15px;
  display:none;
}

.body-text{
  font-size: 20px;
  text-align: center;
  color: black;
  font-weight: 10;
  /*width:150px;
  height:100%;
  margin-top:32px;*/
}

 </style>
</head>
<body onload="loadRoutines()">

<nav class="navbar navbar-inverse color">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>                        
      </button>
      <a class="navbar-brand logo" href="index.html"></a>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav justify-center-56px">
        <li><a class="flex-center tam" href="MyDevices.html">Rooms and Devices</a></li>
        <li><a class="flex-center tam" href="MyCombos.html">Combinations</a></li>
        <li><a class="flex-center tam" href="Now On.html">Switched On</a></li>
      </ul>
    </div>
  </div>
</nav>
  
<!-- Page content -->
<div class="my-content my-padding" id="routinesContainer" style="max-width:1564px">

  <!-- Project Section -->
  <div class="my-container my-padding-0-32">
    <h3 class="my-border-bottom my-padding-0-16">Combinations</h3>
  </div>
  <div class="my-row-padding" id="firstRow">
    <div class="my-col l3 m6 my-margin-bottom">
      <div class="my-display-container">
        <div class="my-display-topleft my-black my-padding">Add Combination</div>
          <button class="btn btn-default" data-toggle="modal" data-target="#create-combo">
            <img src="Add Combo.png" alt="Agregar Combinacion" class="my-image">
          </button>
      </div>
    </div>
  </div>

<!--modal-->
  <div class="modal fade" id="create-combo" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Add Combination</h3>
        </div>
        <div class="modal-body">
          <form class="form-horizontal">
            <label class="control-label">Name: </label>
            <input type="text" class="form-control" id="combination-name" placeholder="Enter name" name="combination-name">
            <div class="form-group" id="append-here">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="submitRoutines(true)">Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>  
    </div>
  </div>

  <!--modal modify-->
  <div class="modal fade" id="modify-combo" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title text-center">Combination</h3>
        </div>
        <div class="modal-body">
          <form class="form-horizontal">
            <label class="control-label">Name: </label>
            <input type="text" class="form-control" id="combination-modify-name" placeholder="Enter name" name="combination-name">
            <div class="form-group" id="append-here-modify">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" onclick="executeRoutine()">Execute </button>
          <button type="submit" class="btn btn-default" onclick="submitRoutines(false)">Save Changes </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-default pull-left" onclick="deleteR()"><span class="glyphicon glyphicon-trash"></span> Delete</button>
        </div>
      </div>  
    </div>
  </div>

<!-- delete routine modal-->
    <div class="modal fade" id="confirmation-delete-routine" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title text-center" id="delete-modal-routine-name"><h3>
        </div>
        <div class="modal-body">
          <p class="confirm-delete-text">Are you sure you want to delete this routine?</p>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" id="accept-delete-routine">Accept </button>
          <button type="submit" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>  
      </div>
    </div>
  </div> 

    <!-- Notification-->
  <div class="notification" id="notification">
    <div class="body-notification">
        <div class="body-text-not">
            <p class="body-text"><span class="glyphicon glyphicon-ok"></span> Executed </p>
        </div>
    </div> 
</div>
 
<!-- End page content -->
</div>

<script>

function showNotification(){
  $("#notification").fadeIn(2000);
  setTimeout(function(){
    $("#notification").fadeOut(2000);
}, 6000);
  
}

var rowNumber = 1;

$(document).ready(function () {
    $('#lamp-switch').on('change', function () {
        DisableLampOptions()
    });
});

$(document).ready(function () {
    $('#oven-switch').on('change', function () {
        DisableOvenOptions()
    });
});

$(document).ready(function () {
    $('#ac-switch').on('change', function () {
        DisableAcOptions()
    });
});

$(document).ready(function () {
    $('#door-switch').on('change', function () {
        DisableDoorOptions()
    });
});

/* Esto es para que el enter no haga nada */
addEventListener("keydown", function(event) {
    if (event.keyCode == 13){
    }
 });

  var api = class {
  static get baseUrl() {
    return "http://127.0.0.1:8080/api/";
  }

  static get timeout() {
    return 60 * 1000;
  }
}

api.model = api.model || {};

api.model.routine = class {
  constructor(id, name, actions, meta) {
    if (id) {
      this.id = id;
    } else {
      delete(this.id);
    }
    this.name = name;
    this.actions = actions;
    this.meta = meta;
  }
}

api.model.action = class {
  constructor(deviceId, actionName, params, meta){
    this.deviceId = deviceId;
    this.actionName = actionName
    this.params = params
    this.meta = meta
  }
}

api.routine = class{
  static get url() {
    return api.baseUrl + "routines/";
  }

  static add(routine) {
   return $.ajax({
      url: api.routine.url,
      method: "POST",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      data: routine
    }); 
  }

  static modify(routine, id) {
   return $.ajax({
      url: api.routine.url + id,
      method: "PUT",
      dataType: "json",
      contentType: "application/json",
      timeout: api.timeout,
      data: routine
    }); 
  }

  static delete(id) {
   return $.ajax({
      url: api.routine.url + id,
      method: "DELETE",
      dataType: "json",
      timeout: api.timeout,
    }); 
  }

  static get(id) {
    return $.ajax({
      url: api.routine.url + id,
      method: "GET",
      dataType: "json",
      timeout: api.timeout
    });
  }

  static getAll(){
    return $.ajax({
      url: api.routine.url,
      method: "GET",
      dataType: "json",
      timeout: api.timeout
    });
  }

  static execute(id){
    return $.ajax({
      url: api.routine.url + id + "/execute",
      method: "PUT",
      dataType: "json",
      timeout: api.timeout
    });
  }
}

api.device = class {
  static get url() {
    return api.baseUrl + "devices/";
  }

  static add(device) {
   return $.ajax({
      url: api.device.url,
      method: "POST",
      dataType: "json",
      timeout: api.timeout,
      async: false,
      data: device
    }); 
  }

  static modify(device) {
   return $.ajax({
      url: api.device.url + device.id,
      method: "PUT",
      dataType: "json",
      timeout: api.timeout,
      async: false,
      data:device
    }); 
  }

  static delete(id) {
   return $.ajax({
      url: api.device.url + id,
      method: "DELETE",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    }); 
  }

  static get(id) {
    return $.ajax({
      url: api.device.url + id,
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static linkToRoom(idDevice,idRoom){
      return $.ajax({
      url: "http://127.0.0.1:8080/api" + /devices/+ idDevice + /rooms/ + idRoom,
      method: "POST",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static getAll(){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices",
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static getTypes(){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devicetypes",
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static getType(id){
      return $.ajax({
      url: "http://127.0.0.1:8080/api/devicetypes/" + id,
      method: "GET",
      dataType: "json",
      async: false,
      timeout: api.timeout
    });
  }

  static getState(deviceID){
    return $.ajax({
      url: "http://127.0.0.1:8080/api/devices/" + deviceID + "/getState",
      method: "PUT",
      dataType: "json",
      async: false,
      timeout: api.timeout,
    });
  }
}

function loadRoutines(){

  api.routine.getAll()

  .done(function (data) {
    loadRoutinesHTML(data);
  })

  .fail(function (jqXHR, textStatus) {
    alert ('Request failed:' + textStatus);
  })
}   

function loadRoutinesHTML(data){
  var i, father, currentRow;

  currentRow = document.getElementById("firstRow");
  father = document.getElementById("routinesContainer");

  for(i = 0; i < data.routines.length; i++){
    if((i % 4) == 0){
      if(i >= 3){
        currentRow = createRow();
        father.appendChild(currentRow);
        rowNumber++;
      }
    }

    currentRow.appendChild(loadRoutine(data.routines[i]));
  }
}

function createRow(){
  var row = document.createElement("div");
  row.classList.add("my-row-padding");

  return row;
}

function loadRoutine(routine){
  var routineContainer = document.createElement("div");
  routineContainer.classList.add("my-col");
  routineContainer.classList.add("l3");
  routineContainer.classList.add("m6");
  routineContainer.classList.add("my-margin-bottom");

  var displayContainer = document.createElement("div");
  displayContainer.classList.add("my-display-container");

  routineContainer.appendChild(displayContainer);

  var tag = document.createElement("div");
  tag.classList.add("my-display-topleft");
  tag.classList.add("my-black");
  tag.classList.add("my-padding");

  displayContainer.appendChild(tag);

  var routineName = routine.name;
  tag.innerHTML = routineName;

  var routineButton = document.createElement("button");
  routineButton.classList.add("btn");
  routineButton.classList.add("btn-default");
  routineButton.setAttribute("id", routine.id);
  routineButton.setAttribute("data-name", routine.name);
  routineButton.setAttribute("onclick", "modifyRoutine(this)");

  displayContainer.appendChild(routineButton);

  var routineImage = document.createElement("img");
  routineImage.setAttribute("alt", routineName);
  routineImage.classList.add("my-image");
  routineImage.setAttribute("src", "Combo.png");

  routineButton.appendChild(routineImage);

  return routineContainer;
}

function modifyRoutine(routineButton){

  api.routine.get(routineButton.id)

  .done(function (data) {
    $("#modify-combo").modal("show");
    $("#modify-combo").on('shown.bs.modal', function () {
      document.getElementById("modify-combo").setAttribute("data-routineId", routineButton.id);
      loadRoutineCamps(data);
    });
  })

  .fail(function (jqXHR, textStatus) {
    alert ('Request failed:' + textStatus);
  })
}

function loadRoutineCamps(rout){
  document.getElementById("combination-modify-name").value = rout.routine.name;
  
  createDivs(1, true, rout.routine.actions, rout.routine.actions[0]);
}


function displayDevices(num, boolean, routine, currentAction){
  if(document.getElementById("selectDevice" + num) != null){
      var deviceDiv = document.getElementById("deviceDiv" + num);
      deviceDiv.innerHTML = "";
    }
    
    var deviceLabel = document.createElement("label");
    deviceLabel.setAttribute("class", "control-label");
    deviceLabel.setAttribute("id", "deviceLabel" + num);
    deviceLabel.innerHTML = "Select Device: ";

    var selectDevice = document.createElement("select");
    selectDevice.setAttribute("id", "selectDevice" + num);
    selectDevice.setAttribute("class", "form-control");

    var none = document.createElement("option");    
    none.setAttribute("value", "none");   
    none.innerHTML = "None";
    selectDevice.appendChild(none);
    
    createOptions(selectDevice, currentAction);
    document.getElementById("deviceDiv" + num).appendChild(deviceLabel);
    document.getElementById("deviceDiv" + num).appendChild(selectDevice);
    if(routine == null){
      selectDevice.addEventListener("change", function handler(){displayActions(num, boolean, routine, currentAction);});
    } else{
      selectDevice.addEventListener("change", function handler(){displayActions(num, boolean, null, null);});
      displayActions(num, boolean, routine, currentAction);
      
    }
 
}


function loadDevices(data, selectDevice, currentAction){
  var i, boolean = false;

  for (i = 0; i < data.devices.length; i++){
    if(currentAction != null){
      if(data.devices[i].id == currentAction.deviceId){
        boolean = true;
      } else{
        boolean = false;
      }
    }

    loadDevice(data.devices[i], selectDevice, boolean);
  }
}

function loadDevice(device, selectDevice, boolean){
  var option = document.createElement("option");

  option.setAttribute("value", device.id);
  option.innerHTML = device.name;

  if(boolean){
    option.setAttribute("selected", "true");
  }

  selectDevice.appendChild(option);
}

function deviceType(deviceId){
  var returnValue = "none";
  api.device.get(deviceId)
  .done(function (data) {
    returnValue = deviceTypeName(data.device.typeId, returnValue);
  })
  .fail(function (jqXHR, textStatus) {
    alert ('Request failed:' + textStatus);
  })

  return returnValue;
}

function deviceTypeName(typeId, returnValue){
  switch(typeId){
    case "eu0v2xgprrhhg41g" : return "blind";

    case "go46xmbqeomjrsjr": return "lamp";

    case "im77xxyulpegfmv8": return "oven";

    case "li6cbv5sdlatti0j": return"ac";

    case "lsf78ly0eqrjbz91": return"door";

    case "rnizejqr2di0okho": return"refrigerator";

    default: return "none";
  }
}

function createOptions(selectDevice, currentAction){
  api.device.getAll()

  .done(function (data) {
    loadDevices(data, selectDevice, currentAction);
  })

  .fail(function (jqXHR, textStatus) {
    alert ('Request failed:' + textStatus);
  })
}

function submitRoutines(create){
  var num = 1;
  var currentDevice;
  var actionsArray = [];
  var errorsArray = [];

  while((currentDevice = document.getElementById("selectDevice" + num)) != null){
    if(currentDevice.value != "none")
      getActionInvolved(num, currentDevice.value, errorsArray, actionsArray);
    num++;
  }


  if(! finalCheckErrors(num)){
    if(create)
      createRoutine(actionsArray);
    else
      modifyRoutineInAPI(actionsArray);

    $("#create-combo").modal("hide");
    location.reload();
    return;
  }
}

function modifyRoutineInAPI(actionsArray){
  var routineName = document.getElementById("combination-modify-name").value;
  var routineId = document.getElementById("modify-combo").getAttribute("data-routineId");

  var routine = {"name":routineName,"actions":actionsArray,"meta":"{}"}

  var JSONroutine = JSON.stringify(routine);
  api.routine.modify(JSONroutine, routineId)
    .done(function(data){
    location.reload();
  }) 
}

function executeRoutine(){
  var routineId = document.getElementById("modify-combo").getAttribute("data-routineId");

  api.routine.execute(routineId)
  .done(function(data){
    $("#modify-combo").modal("hide");
    showNotification();    
  }) 
}

function getActionInvolved(num, deviceId, errorsArray, actionsArray){
  var action = document.getElementById("selectAction" + num);

  if(action.value == "")
    return;

  if(!isActionWithParameter(action.value)){
    putDeviceIntoRoutineWithoutParameter(deviceId, action.value, actionsArray);
    return;
  }
  getParameterInvolved(num, deviceId, action.value, errorsArray, actionsArray);
}

function isActionWithParameter(actionName){
  var val = actionName;

    if(val == "blinds-open" || val == "blinds-close" || val == "lamp-on" || val == "lamp-off" || val == "door-open" || val == "door-close" || val == "door-lock" || val == "door-unlock" || val =="oven-on" || val == "oven-off" || val == "ac-on" || val == "ac-off")
      return false;

    return true;
}

function putDeviceIntoRoutineWithoutParameter(deviceId, actionName, actionsArray){
  var actionString = parseAction(actionName);

  var action = {"deviceId":deviceId,"actionName":actionString,"params":[],"meta":"{}"}
  actionsArray.push(action);
}

function getParameterInvolved(num, deviceId, actionName, errorsArray, actionsArray){
  var parameter = document.getElementById("inputParameter" + num).value;
  if(parameter == "")
    return;

/*  if(!validParameter(parameter, actionName)){ //falta implementar
    addToErrorsArray(num, deviceId, actionName, parameter, errorsArray);
    return;
  }*/

  putDeviceIntoRoutineWithParameter(num, deviceId, actionName, parameter, actionsArray);
}

function putDeviceIntoRoutineWithParameter(num, deviceId, actionName, parameter, actionsArray){
  
  var actionString = parseAction(actionName);
  var action = {"deviceId":deviceId,"actionName":actionString,"params":[parameter],"meta":"{}"}
  actionsArray.push(action);
}

function addToErrorsArray(num, deviceId, actionName, parameter, errorsArray){
  var error = {num: num, deviceId: deviceId, actionName: actionName, params: [parameter]};
  errorsArray.push(error);
}

function parseAction(actionName){
  if("blinds-open" == actionName)
    return "up";

  if("blinds-close" == actionName)
    return "down";

  if("lamp-on" == actionName || "oven-on" == actionName || "ac-on" == actionName)
    return "turnOn";

  if("lamp-off" == actionName || "oven-off" == actionName || "ac-off" == actionName)
    return "turnOff";

  if("lamp-brightness" == actionName)
    return "changeBrightness";

  if("lamp-color" == actionName)
    return "changeColor";

  if("door-open" == actionName)
    return "open";

  if("door-close" == actionName)
    return "close";

  if("door-lock" == actionName)
    return "lock";

  if("door-unlock" == actionName)
    return "unlock";

  if("oven-heatmode" == actionName)
    return "setHeat";

  if("oven-temperature" == actionName || "ac-temperature" == actionName || "refrigerator-temperature" == actionName)
    return "setTemperature";

  if("oven-grillmode" == actionName)
    return "setGrill";

  if("oven-convectionmode" == actionName)
    return "setConvection";

  if("refrigerator-mode" == actionName || "ac-mode" == actionName)
    return "setMode";

  if("refrigerator-freezertemperature" == actionName)
    return "setFreezerTemperature";

  if("ac-verticalswing" == actionName)
    return "setVerticalSwing";

  if("ac-horizontalswing" == actionName)
    return "setHorizontalSwing";

  if("ac-fanspeed" == actionName)
    return "setFanSpeed";
}

function createRoutine(actionsArray){
  var routineName = document.getElementById("combination-name").value;

  var routine = {"name":routineName,"actions":actionsArray,"meta":"{}"}
  var JSONroutine = JSON.stringify(routine)
  api.routine.add(JSONroutine)
    .done(function(data){
    location.reload();
  })
}

function displayRoutine(routine){
  var rowContainer = document.getElementById("routinesContainer");
  var rows = rowContainer.children;

  if(rows[rowNumber].children.length == 4){
    rowNumber++;
    var newRow = createRow();
    rowContainer.appendChild(newRow);
  }
  rows[rowNumber].appendChild(loadRoutine(routine));
}

function deleteRoutine(routine){
  api.routine.delete(routine.id)

  .done(function(data){
    var father = routine.parentElement;
    father.parentElement.removeChild(father);
    $("#confirmation-delete-routine").modal("hide");
  })

  .fail(function(jqXHR, textStatus){
    alert('Request failed: trying to delete the routine' + textStatus);
  }) 
}

function deleteR(){
  var routine = document.getElementById(document.getElementById("modify-combo").getAttribute("data-routineId"));

  $("#modify-combo").modal("hide");
  $("#confirmation-delete-routine").modal();

  document.getElementById("delete-modal-routine-name").innerHTML = "Delete " + routine.getAttribute("data-name") + "?";

  document.getElementById("accept-delete-routine").onclick = function() {deleteRoutine(routine)};
}

function displayActions(num, boolean, routine, currentAction) {
  if(document.getElementById("selectAction" + num) != null){
    var actionDiv = document.getElementById("actionDiv" + num);
    actionDiv.innerHTML = " ";
        
    if(document.getElementById("inputParameter" + num) != null){
      var parameterDiv = document.getElementById("parameterDiv" + num);
      parameterDiv.innerHTML = " ";
    }
  }

  var action = null;

  if(currentAction != null){
    var retrieve, myDeviceType;
    retrieve = currentAction.actionName;
    myDeviceType = deviceType(currentAction.deviceId);

    if(retrieve == "up"){
      action = "blinds-open";
    }

    if(retrieve == "down"){
      action == "blinds-close";
    }

    if(retrieve == "turnOn"){
      if(myDeviceType == "lamp"){
        action = "lamp-on";
      } else if(myDeviceType == "oven"){
        action = "oven-on";
      } else if(myDeviceType == "ac"){
        action = "ac-on";
      }
    }

    if(retrieve == "turnOff"){
      if(myDeviceType == "lamp"){
        action = "lamp-off";
      } else if(myDeviceType == "oven"){
        action = "oven-off";
      } else if(myDeviceType == "ac"){
        action = "ac-off";
      }
    }

    if(retrieve == "changeColor"){
      action = "lamp-color";
    }

    if(retrieve == "changeBrightness"){
      action = "lamp-brightness";
    }

    if(retrieve == "setTemperature"){
      if(myDeviceType == "oven"){
        action = "oven-temperature";
      } else if(myDeviceType == "ac"){
        action = "ac-temperature";
      } else if(myDeviceType == "refrigerator"){
        action = "refrigerator-temperature";
      }
    }

    if(retrieve == "setHeat"){
      action = "oven-heatmode";
    }

    if(retrieve == "setGrill"){
      action = "oven-grillmode";
    }

    if(retrieve == "setConvection"){
      action = "oven-convectionmode";
    } 

    if(retrieve == "setMode"){
      if(myDeviceType == "ac"){
        action = "ac-mode";
      } else if(myDeviceType == "refrigerator"){
        action = "refrigerator-mode";
      }
    }

    if(retrieve == "setVerticalSwing"){
      action = "ac-verticalswing";
    }   

    if(retrieve == "setHorizontalSwing"){
      action = "ac-horizontalswing";
    }

    if(retrieve == "setFanSpeed"){
      action = "ac-fanspeed";
    }

    if(retrieve == "open"){
      action = "door-open";
    }

    if(retrieve == "close"){
      action = "door-close";
    }

    if(retrieve == "lock"){
      action = "door-lock";
    }

    if(retrieve == "unlock"){
      action = "door-unlock"
    }

    if(retrieve == "setFreezerTemperature"){
      action = "refrigerator-freezertemperature";
    }
  }
   
    var actionLabel = document.createElement("label");
    actionLabel.setAttribute("class", "control-label");
    actionLabel.setAttribute("id", "actionLabel" + num);
    actionLabel.innerHTML = "Select Action: ";

    var val = document.getElementById("selectDevice" + num).value;

    if(val != "none")
      val = deviceType(val);
    
  if(val != "none"){
      var selectAction = document.createElement("select");
      selectAction.setAttribute("id", "selectAction" + num);
      selectAction.setAttribute("class", "form-control");
    
    if(val == "blind"){
      var empty = document.createElement("option");
      var op1 = document.createElement("option");
      var op2 = document.createElement("option");
    
      empty.setAttribute("value", "");
      empty.setAttribute("disabled", "true");
      empty.setAttribute("selected", "true");
      op1.setAttribute("value", "blinds-open");
      op2.setAttribute("value", "blinds-close");

      if(action == "blinds-open"){
        op1.setAttribute("selected", "true");
      } else if(action == "blinds-close"){
        op2.setAttribute("selected", "true");
      }
    
      empty.innerHTML = "";    
      op1.innerHTML = "Open";
      op2.innerHTML = "Close";
   
      selectAction.appendChild(empty);
      selectAction.appendChild(op1);
      selectAction.appendChild(op2);
    }
    
    if(val == "lamp"){
      var empty = document.createElement("option");
      var op1 = document.createElement("option");
      var op2 = document.createElement("option");
      var op3 = document.createElement("option");
      var op4 = document.createElement("option");
      
      empty.setAttribute("value", "");
      empty.setAttribute("disabled", "true");
      empty.setAttribute("selected", "true");
      op1.setAttribute("value", "lamp-on");
      op2.setAttribute("value", "lamp-off");
      op3.setAttribute("value", "lamp-brightness");
      op4.setAttribute("value", "lamp-color");

      if(action == "lamp-on"){
        op1.setAttribute("selected", "true");
      } else if(action == "lamp-off"){
        op2.setAttribute("selected", "true");
      } else if(action == "lamp-brightness"){
        op3.setAttribute("selected", "true");
      } else if(action == "lamp-color"){
        op4.setAttribute("selected", "true");
      }
    
      empty.innerHTML = "";
      op1.innerHTML = "Turn on";
      op2.innerHTML = "Turn off";
      op3.innerHTML = "Set brightness";
      op4.innerHTML = "Select color";
      
      selectAction.appendChild(empty);
      selectAction.appendChild(op1);
      selectAction.appendChild(op2);
      selectAction.appendChild(op3);
      selectAction.appendChild(op4);
    }
    
    if(val == "door"){
      var empty = document.createElement("option");
      var op1 = document.createElement("option");
      var op2 = document.createElement("option");
      var op3 = document.createElement("option");
      var op4 = document.createElement("option");
    
      empty.setAttribute("value", "");
      empty.setAttribute("disabled", "true");
      empty.setAttribute("selected", "true");
      op1.setAttribute("value", "door-open");
      op2.setAttribute("value", "door-close");
      op3.setAttribute("value", "door-lock");
      op4.setAttribute("value", "door-unlock");

      if(action == "door-open"){
        op1.setAttribute("selected", "true");
      } else if(action == "door-close"){
        op2.setAttribute("selected", "true");
      } else if(action == "door-lock"){
        op3.setAttribute("selected", "true");
      } else if(action == "door-unlock"){
        op4.setAttribute("selected", "true");
      }

      empty.innerHTML = "";
      op1.innerHTML = "Open";
      op2.innerHTML = "Close";
      op3.innerHTML = "Lock";
      op4.innerHTML = "Unlock";
      
      selectAction.appendChild(empty);
      selectAction.appendChild(op1);
      selectAction.appendChild(op2);
      selectAction.appendChild(op3);
      selectAction.appendChild(op4);
    }
    
    if(val == "oven"){
      var empty = document.createElement("option");
      var op1 = document.createElement("option");
      var op2 = document.createElement("option");
      var op3 = document.createElement("option");
      var op4 = document.createElement("option");
      var op5 = document.createElement("option");
      var op6 = document.createElement("option");
    
      empty.setAttribute("value", "");
      empty.setAttribute("disabled", "true");
      empty.setAttribute("selected", "true");
      op1.setAttribute("value", "oven-on");
      op2.setAttribute("value", "oven-off");
      op3.setAttribute("value", "oven-temperature");
      op4.setAttribute("value", "oven-heatmode");
      op5.setAttribute("value", "oven-grillmode");
      op6.setAttribute("value", "oven-convectionmode");

      if(action == "oven-on"){
        op1.setAttribute("selected", "true");
      } else if(action == "oven-off"){
        op2.setAttribute("selected", "true");
      } else if(action == "oven-temperature"){
        op3.setAttribute("selected", "true");
      } else if(action == "oven-heatmode"){
        op4.setAttribute("selected", "true");
      } else if(action == "oven-grillmode"){
        op5.setAttribute("selected", "true");
      } else if(action == "oven-convectionmode"){
        op6.setAttribute("selected", "true");
      }
    
      empty.innerHTML = "";
      op1.innerHTML = "Turn on";
      op2.innerHTML = "Turn off";
      op3.innerHTML = "Set temperature";
      op4.innerHTML = "Select heat mode";
      op5.innerHTML = "Select grill mode";
      op6.innerHTML = "Select convection mode";
      
      selectAction.appendChild(empty);
      selectAction.appendChild(op1);
      selectAction.appendChild(op2);
      selectAction.appendChild(op3);
      selectAction.appendChild(op4);
      selectAction.appendChild(op5);
      selectAction.appendChild(op6);
    }
    
    if(val == "refrigerator"){
      var empty = document.createElement("option");
      var op1 = document.createElement("option");
      var op2 = document.createElement("option");
      var op3 = document.createElement("option");
    
      empty.setAttribute("value", "");
      empty.setAttribute("disabled", "true");
      empty.setAttribute("selected", "true");
      op1.setAttribute("value", "refrigerator-temperature");
      op2.setAttribute("value", "refrigerator-freezertemperature");
      op3.setAttribute("value", "refrigerator-mode");

      if(action == "refrigerator-temperature"){
        op1.setAttribute("selected", "true");
      } else if(action == "refrigerator-freezertemperature"){
        op2.setAttribute("selected", "true");
      } else if(action == "refrigerator-mode"){
        op3.setAttribute("selected", "true");
      }
      
      empty.innerHTML = "";
      op1.innerHTML = "Set temperature";
      op2.innerHTML = "Set freezer temperature";
      op3.innerHTML = "Select mode";
    
      selectAction.appendChild(empty);
      selectAction.appendChild(op1);
      selectAction.appendChild(op2);
      selectAction.appendChild(op3);
    }
    
    if(val == "ac"){
      var empty = document.createElement("option");
      var op1 = document.createElement("option");
      var op2 = document.createElement("option");
      var op3 = document.createElement("option");
      var op4 = document.createElement("option");
      var op5 = document.createElement("option");
      var op6 = document.createElement("option");
      var op7 = document.createElement("option");
      
      empty.setAttribute("value", "");
      empty.setAttribute("disabled", "true");
      empty.setAttribute("selected", "true");
      op1.setAttribute("value", "ac-on");
      op2.setAttribute("value", "ac-off");
      op3.setAttribute("value", "ac-temperature");
      op4.setAttribute("value", "ac-mode");
      op5.setAttribute("value", "ac-verticalswing");
      op6.setAttribute("value", "ac-horizontalswing");
      op7.setAttribute("value", "ac-fanspeed");

      if(action == "ac-on"){
        op1.setAttribute("selected", "true");
      } else if(action == "ac-off"){
        op2.setAttribute("selected", "true");
      } else if(action == "ac-temperature"){
        op3.setAttribute("selected", "true");
      } else if(action == "ac-mode"){
        op4.setAttribute("selected", "true");
      } else if(action == "ac-verticalswing"){
        op5.setAttribute("selected", "true");
      } else if(action == "ac-horizontalswing"){
        op6.setAttribute("selected", "true");
      } else if(action == "ac-fanspeed"){
        op7.setAttribute("selected", "true");
      }
      
      empty.innerHTML = "";
      op1.innerHTML = "Turn on";
      op2.innerHTML = "Turn off";
      op3.innerHTML = "Set temperature";
      op4.innerHTML = "Select mode";
      op5.innerHTML = "Select vertical swing";
      op6.innerHTML = "Select horizontal swing";
      op7.innerHTML = "Select fan speed";
      
      selectAction.appendChild(empty);
      selectAction.appendChild(op1);
      selectAction.appendChild(op2);
      selectAction.appendChild(op3);
      selectAction.appendChild(op4);
      selectAction.appendChild(op5);
      selectAction.appendChild(op6);
      selectAction.appendChild(op7);
    }
    
    document.getElementById("actionDiv" + num).appendChild(actionLabel);
    document.getElementById("actionDiv" + num).appendChild(selectAction);
    if(routine == null){
      selectAction.addEventListener("change", function handler(){inputParameters(num, boolean, routine, currentAction);});  
    } else{
      selectAction.addEventListener("change", function handler(){inputParameters(num, boolean, null, null);});
      inputParameters(num, boolean, routine, currentAction);

    }
    
    }
}

function inputParameters(n, boolean, routine, currentAction){
  if(document.getElementById("inputParameter" + n) != null){
        var parameterDiv = document.getElementById("parameterDiv" + n);
        parameterDiv.innerHTML = "";
      }
  
  var val = document.getElementById("selectAction" + n).value;
    
    
  if(val == "blinds-open" || val == "blinds-close" || val == "lamp-on" || val == "lamp-off" || val == "door-open" || val == "door-close" || val == "door-lock" || val == "door-unlock" || val =="oven-on" || val == "oven-off" || val == "ac-on" || val == "ac-off"){
    if(routine != null && routine.length == n){
      createDivs(n + 1, true, null, null);
    } else if(routine != null){
      createDivs(n + 1, boolean, routine, routine[n]);  
    } else {
      createDivs(n + 1, boolean, null, null);
    }
  }
    
  var inputParameter;
    
  if(val == "oven-heatmode" || val == "oven-grillmode" || val == "oven-convectionmode" || val == "ac-mode" || val == "ac-verticalswing" || val == "ac-horizontalswing" || val == "ac-fanspeed" || val == "refrigerator-mode"){
    inputParameter = document.createElement("select");
    inputParameter.setAttribute("id", "inputParameter" + n);
    inputParameter.setAttribute("class", "form-control");

    var parameterLabel = document.createElement("label");
    parameterLabel.setAttribute("class", "control-label");
    parameterLabel.setAttribute("id", "parameterLabel" + n);

    document.getElementById("parameterDiv" + n).appendChild(parameterLabel);
    document.getElementById("parameterDiv" + n).appendChild(inputParameter);
    if(routine == null){
      inputParameter.addEventListener("change", function handler(){
        createDivs(n + 1, boolean, null, null);
      });
    } else if(routine != null && routine.length == n){
        createDivs(n + 1, true, null, null);
    } else{
        createDivs(n + 1, true, routine, routine[n]);
    }
  } else if(val != "blinds-open" && val != "blinds-close" && val != "lamp-on" && val != "lamp-off" && val != "door-open" && val != "door-close" && val != "door-lock" && val != "door-unlock" && val !="oven-on" && val != "oven-off" && val != "ac-on" && val != "ac-off"){
    inputParameter = document.createElement("input");
    inputParameter.setAttribute("id", "inputParameter" + n);

    var parameterLabel = document.createElement("label");

    parameterLabel.setAttribute("class", "control-label");

    parameterLabel.setAttribute("id", "parameterLabel" + n);

    document.getElementById("parameterDiv" + n).appendChild(parameterLabel);

    if(val != "lamp-color"){
      document.getElementById("parameterDiv" + n).appendChild(inputParameter);
    }

    var errorText = document.createElement("p")
    errorText.classList.add("error")
    errorText.innerHTML = ""
    var father = inputParameter.parentNode
    father.appendChild(errorText)

    inputParameter.addEventListener("change", function handler(){
    if(routine != null && routine.length == n){
      lookForErrors(n + 1, val, inputParameter, errorText, true, null, null);
    } else if(routine != null){
      lookForErrors(n + 1, val, inputParameter, errorText, true, routine, routine[n]);  
    } else {
      lookForErrors(n + 1, val, inputParameter, errorText, boolean, null, null);
    }
    });
  } 

  var parameterType = null;
    
  if(val == "lamp-brightness"){
    inputParameter.setAttribute("type", "number");
    inputParameter.setAttribute("class", "form-control");
    inputParameter.setAttribute("data-type", "lamp-brightness");
    inputParameter.setAttribute("placeholder", "Enter brightness (0 - 100)");
    inputParameter.setAttribute("name", "lamp-brightness");
    inputParameter.setAttribute("min", "0");
    inputParameter.setAttribute("max", "100");
    
    parameterLabel.innerHTML = "Change brightness: ";

    if(currentAction != null){
      inputParameter.value = currentAction.params[0];
    }
  }
    
  if(val == "lamp-color"){
    var div = document.createElement("div");
    div.setAttribute("id", "cp3");
    div.classList.add("input-group");
    div.classList.add("colorpicker-component");
    inputParameter.setAttribute("type", "text");
    inputParameter.setAttribute("value", "#00AABB");
    inputParameter.setAttribute("class", "form-control");
    inputParameter.setAttribute("data-type", "lamp-color");
    var span = document.createElement("span");
    span.setAttribute("class", "input-group-addon");
    var i = document.createElement("i");
    span.appendChild(i);
    div.appendChild(inputParameter);
    div.appendChild(span);
    document.getElementById("parameterDiv" + n).appendChild(div);

    parameterLabel.innerHTML = "Select color: "

    if(currentAction != null){
      inputParameter.value = currentAction.params[0];
    }
  }
    
  if(val == "oven-temperature"){
    inputParameter.setAttribute("type", "number");
    inputParameter.setAttribute("class", "form-control");
    inputParameter.setAttribute("data-type", "oven-temperature");
    inputParameter.setAttribute("placeholder", "Enter temperature (90 - 230)");
    inputParameter.setAttribute("name", "oven-temperature");
    inputParameter.setAttribute("min", "90");
    inputParameter.setAttribute("max", "230");

    parameterLabel.innerHTML = "Change temperature: ";

    if(currentAction != null){
      inputParameter.value = currentAction.params[0];
    }
  }
    
  if(val == "oven-heatmode"){
    inputParameter.setAttribute("class", "form-control");
    inputParameter.setAttribute("data-type", "oven-heatmode");
    var empty = document.createElement("empty");
    var op1 = document.createElement("option");
    var op2 = document.createElement("option");
    var op3 = document.createElement("option");
    empty.setAttribute("value", "");
    empty.setAttribute("disabled", "true");
    empty.setAttribute("selected", "true");
    empty.innerHTML = "";
    op1.setAttribute("value", "conventional");
    op1.innerHTML = "Conventional";
    op2.setAttribute("value", "bottom");
    op2.innerHTML = "Bottom";
    op3.setAttribute("value", "top");
    op3.innerHTML = "Top";
    inputParameter.appendChild(empty);
    inputParameter.appendChild(op1);
    inputParameter.appendChild(op2);
    inputParameter.appendChild(op3);

    parameterLabel.innerHTML = "Change heat mode: ";

    if(currentAction != null){
      var parameter = currentAction.params[0];

      if(parameter == "conventional"){
        op1.setAttribute("selected", "true");
      } else if(parameter == "bottom"){
        op2.setAttribute("selected", "true");
      } else if(parameter == "top"){
        op3.setAttribute("selected", "true");
      }
    }
  }
    
  if(val == "oven-grillmode"){
    inputParameter.setAttribute("class", "form-control");
    inputParameter.setAttribute("data-type", "oven-grillmode");
    var empty = document.createElement("empty");
    var op1 = document.createElement("option");
    var op2 = document.createElement("option");
    var op3 = document.createElement("option");
    empty.setAttribute("value", "");
    empty.setAttribute("disabled", "true");
    empty.setAttribute("selected", "true");
    empty.innerHTML = "";
    op1.setAttribute("value", "large");
    op1.innerHTML = "Large";
    op2.setAttribute("value", "eco");
    op2.innerHTML = "Eco";
    op3.setAttribute("value", "off");
    op3.innerHTML = "Off";
    inputParameter.appendChild(empty);
    inputParameter.appendChild(op1);
    inputParameter.appendChild(op2);
    inputParameter.appendChild(op3);

    parameterLabel.innerHTML = "Change grill mode: ";

    if(currentAction != null){
      var parameter = currentAction.params[0];

      if(parameter == "large"){
        op1.setAttribute("selected", "true");
      } else if(parameter == "eco"){
        op2.setAttribute("selected", "true");
      } else if(parameter == "off"){
        op3.setAttribute("selected", "true");
      }
    }    
  }
  
  if(val == "oven-convectionmode"){
    inputParameter.setAttribute("class", "form-control");
    inputParameter.setAttribute("data-type", "oven-convectionmode");
    var empty = document.createElement("option");
    var op1 = document.createElement("option");
    var op2 = document.createElement("option");
    var op3 = document.createElement("option");
    empty.setAttribute("value", "");
    empty.setAttribute("disabled", "true");
    empty.setAttribute("selected", "true");
    empty.innerHTML = "";
    op1.setAttribute("value", "normal");
    op1.innerHTML = "Normal";
    op2.setAttribute("value", "eco");
    op2.innerHTML = "Eco";
    op3.setAttribute("value", "off");
    op3.innerHTML = "Off";
    inputParameter.appendChild(empty);
    inputParameter.appendChild(op1);
    inputParameter.appendChild(op2);
    inputParameter.appendChild(op3);

    parameterLabel.innerHTML = "Change convection mode: ";

    if(currentAction != null){
      var parameter = currentAction.params[0];

      if(parameter == "normal"){
        op1.setAttribute("selected", "true");
      } else if(parameter == "eco"){
        op2.setAttribute("selected", "true");
      } else if(parameter == "off"){
        op3.setAttribute("selected", "true");
      }
    }
  }
    
  if(val == "refrigerator-temperature"){
    inputParameter.setAttribute("type", "number");
    inputParameter.setAttribute("class", "form-control");
    inputParameter.setAttribute("data-type", "refrigerator-temperature");
    inputParameter.setAttribute("placeholder", "Enter temperature (2 - 8)");
    inputParameter.setAttribute("name", "refrigerator-temperature");
    inputParameter.setAttribute("min", "2");
    inputParameter.setAttribute("max", "8");

    parameterLabel.innerHTML = "Set temperature: ";

    if(currentAction != null){
      inputParameter.value = currentAction.params[0];
    }
  }
    
  if(val == "refrigerator-freezertemperature"){
    inputParameter.setAttribute("type", "number");
    inputParameter.setAttribute("class", "form-control");
    inputParameter.setAttribute("data-type", "refrigerator-freezertemperature");
    inputParameter.setAttribute("placeholder", "Enter temperature ((-20) - (-8))");
    inputParameter.setAttribute("name", "refrigerator-freezertemperature");
    inputParameter.setAttribute("min", "-20");
    inputParameter.setAttribute("max", "-8");

    parameterLabel.innerHTML = "Set freezer temperature: ";

    if(currentAction != null){
      inputParameter.value = currentAction.params[0];
    }
  }
    
  if(val == "refrigerator-mode"){
    inputParameter.setAttribute("class", "form-control");
    inputParameter.setAttribute("data-type", "refrigerator-mode");
    var empty = document.createElement("option");
    var op1 = document.createElement("option");
    var op2 = document.createElement("option");
    var op3 = document.createElement("option");
    empty.setAttribute("value", "");
    empty.setAttribute("disabled", "true");
    empty.setAttribute("selected", "true");
    empty.innerHTML = "";
    op1.setAttribute("value", "default");
    op1.innerHTML = "Default";
    op2.setAttribute("value", "vacation");
    op2.innerHTML = "Vacation";
    op3.setAttribute("value", "party");
    op3.innerHTML = "Party";
    inputParameter.appendChild(empty);
    inputParameter.appendChild(op1);
    inputParameter.appendChild(op2);
    inputParameter.appendChild(op3);

    parameterLabel.innerHTML = "Select mode: ";

    if(currentAction != null){
      var parameter = currentAction.params[0];

      if(parameter == "default"){
        op1.setAttribute("selected", "true");
      } else if(parameter == "vacation"){
        op2.setAttribute("selected", "true");
      } else if(parameter == "party"){
        op3.setAttribute("selected", "true");
      }
    }    
  }
    
  if(val == "ac-temperature"){
    inputParameter.setAttribute("type", "number");
    inputParameter.setAttribute("class", "form-control");
    inputParameter.setAttribute("data-type", "ac-temperature");
    inputParameter.setAttribute("placeholder", "Enter temperature (18 - 38)");
    inputParameter.setAttribute("name", "ac-temperature");
    inputParameter.setAttribute("min", "18");
    inputParameter.setAttribute("max", "38");

    parameterLabel.innerHTML = "Set temperature: ";

    if(currentAction != null){
      inputParameter.value = currentAction.params[0];
    }
  }
    
  if(val == "ac-mode"){
    inputParameter.setAttribute("class", "form-control");
    inputParameter.setAttribute("data-type", "ac-mode");
    var empty = document.createElement("option");
    var op1 = document.createElement("option");
    var op2 = document.createElement("option");
    var op3 = document.createElement("option");
    empty.setAttribute("value", "");
    empty.setAttribute("disabled", "true");
    empty.setAttribute("selected", "true");
    empty.innerHTML = "";
    op1.setAttribute("value", "cool");
    op1.innerHTML = "Cool";
    op2.setAttribute("value", "heat");
    op2.innerHTML = "Heat";
    op3.setAttribute("value", "fan");
    op3.innerHTML = "Fan";
    inputParameter.appendChild(empty);
    inputParameter.appendChild(op1);
    inputParameter.appendChild(op2);
    inputParameter.appendChild(op3);

    parameterLabel.innerHTML = "Select mode: ";

    if(currentAction != null){
      var parameter = currentAction.params[0];

      if(parameter == "cool"){
        op1.setAttribute("selected", "true");
      } else if(parameter == "heat"){
        op2.setAttribute("selected", "true");
      } else if(parameter == "fan"){
        op3.setAttribute("selected", "true");
      }
    }   
  }
    
  if(val == "ac-verticalswing"){
    inputParameter.setAttribute("class", "form-control");
    inputParameter.setAttribute("data-type", "ac-verticalswing");
    var empty = document.createElement("option");
    var op1 = document.createElement("option");
    var op2 = document.createElement("option");
    var op3 = document.createElement("option");
    var op4 = document.createElement("option");
    var op5 = document.createElement("option");
    empty.setAttribute("value", "");
    empty.setAttribute("disabled", "true");
    empty.setAttribute("selected", "true");
    empty.innerHTML = "";
    op1.setAttribute("value", "auto");
    op1.innerHTML = "Auto";
    op2.setAttribute("value", "22");
    op2.innerHTML = "22";
    op3.setAttribute("value", "45");
    op3.innerHTML = "45";
    op4.setAttribute("value", "67");
    op4.innerHTML = "67";
    op5.setAttribute("value", "90");
    op5.innerHTML = "90";
    inputParameter.appendChild(empty);
    inputParameter.appendChild(op1);
    inputParameter.appendChild(op2);
    inputParameter.appendChild(op3);
    inputParameter.appendChild(op4);
    inputParameter.appendChild(op5);

    parameterLabel.innerHTML = "Select vertical swing: ";

    if(currentAction != null){
      var parameter = currentAction.params[0];

      if(parameter == "auto"){
        op1.setAttribute("selected", "true");
      } else if(parameter == "22"){
        op2.setAttribute("selected", "true");
      } else if(parameter == "45"){
        op3.setAttribute("selected", "true");
      } else if(parameter == "67"){
        op4.setAttribute("selected", "true");
      } else if(parameter == "90"){
        op5.setAttribute("selected", "true");
      }
    }
  }
    
  if(val == "ac-horizontalswing"){
    inputParameter.setAttribute("class", "form-control");
    inputParameter.setAttribute("data-type", "ac-horizontalswing");
    var empty = document.createElement("option");
    var op1 = document.createElement("option");
    var op2 = document.createElement("option");
    var op3 = document.createElement("option");
    var op4 = document.createElement("option");
    var op5 = document.createElement("option");
    var op6 = document.createElement("option");
    empty.setAttribute("value", "");
    empty.setAttribute("disabled", "true");
    empty.setAttribute("selected", "true");
    empty.innerHTML = "";
    op1.setAttribute("value", "auto");
    op1.innerHTML = "Auto";
    op2.setAttribute("value", "-90");
    op2.innerHTML = "-90";
    op3.setAttribute("value", "-45");
    op3.innerHTML = "-45";
    op4.setAttribute("value", "0");
    op4.innerHTML = "0";
    op5.setAttribute("value", "45");
    op5.innerHTML = "45";
    op6.setAttribute("value", "90");
    op6.innerHTML = "90";
    inputParameter.appendChild(empty);
    inputParameter.appendChild(op1);
    inputParameter.appendChild(op2);
    inputParameter.appendChild(op3);
    inputParameter.appendChild(op4);
    inputParameter.appendChild(op5);
    inputParameter.appendChild(op6);

    parameterLabel.innerHTML = "Select horizontal swing: ";

    if(parameter == "auto"){
        op1.setAttribute("selected", "true");
      } else if(parameter == "-90"){
        op2.setAttribute("selected", "true");
      } else if(parameter == "-45"){
        op3.setAttribute("selected", "true");
      } else if(parameter == "0"){
        op4.setAttribute("selected", "true");
      } else if(parameter == "45"){
        op5.setAttribute("selected", "true");
      } else if(parameter == "90"){
        op6.setAttribute("selected", "true");
      }
  }
    
  if(val == "ac-fanspeed"){
    inputParameter.setAttribute("class", "form-control");
    inputParameter.setAttribute("data-type", "ac-fanspeed");
    var empty = document.createElement("option");
    var op1 = document.createElement("option");
    var op2 = document.createElement("option");
    var op3 = document.createElement("option");
    var op4 = document.createElement("option");
    var op5 = document.createElement("option");
    empty.setAttribute("value", "");
    empty.setAttribute("disabled", "true");
    empty.setAttribute("selected", "true");
    empty.innerHTML = "";
    op1.setAttribute("value", "auto");
    op1.innerHTML = "Auto";
    op2.setAttribute("value", "25");
    op2.innerHTML = "25";
    op3.setAttribute("value", "50");
    op3.innerHTML = "50";
    op4.setAttribute("value", "75");
    op4.innerHTML = "75";
    op5.setAttribute("value", "100");
    op5.innerHTML = "100";
    inputParameter.appendChild(empty);
    inputParameter.appendChild(op1);
    inputParameter.appendChild(op2);
    inputParameter.appendChild(op3);
    inputParameter.appendChild(op4);
    inputParameter.appendChild(op5);

    parameterLabel.innerHTML = "Select fan speed: ";

    if(parameter == "auto"){
        op1.setAttribute("selected", "true");
      } else if(parameter == "25"){
        op2.setAttribute("selected", "true");
      } else if(parameter == "50"){
        op3.setAttribute("selected", "true");
      } else if(parameter == "75"){
        op4.setAttribute("selected", "true");
      } else if(parameter == "100"){
        op5.setAttribute("selected", "true");
      }
  }

   if(routine != null && routine.length == n){
        createDivs(n + 1, true, null, null);
    } else{
        createDivs(n + 1, true, routine, routine[n]);
    }
}

function lookForErrors(num,val,input,errorText, boolean, routine, currentAction){
  var inputValue = input.value
  if(val == "lamp-brightness"){

    if( inputValue < 0 || inputValue > 100){
      errorText.innerHTML = "The brightness must be between 0 and 100"
      errorText.style.display = "block"
      document.getElementById("create-combo").setAttribute("error",true)
      return;
    }

  }
  if(val == "lamp-color"){

    if(! isColor(inputValue)){
      errorText.innerHTML = "The color must be between #000000 and #FFFFFF"
      errorText.style.display = "block"
      document.getElementById("create-combo").setAttribute("error",true)
      return;
    }

  }  
  if(val == "oven-temperature"){

    if( inputValue < 90 || inputValue > 230){
      errorText.innerHTML = "The temperature must be between 90 and 230"
      errorText.style.display = "block"
      document.getElementById("create-combo").setAttribute("error",true)
      return;
    }

  }
  if(val == "refrigerator-temperature"){

    if( inputValue < 2 || inputValue > 8){
      errorText.innerHTML = "The temperature must be between 2 and 8"
      errorText.style.display = "block"
      document.getElementById("create-combo").setAttribute("error",true)
      return;
    }

  }
  if(val == "refrigerator-freezertemperature"){

    if( inputValue < -20 || inputValue > -8){
      errorText.innerHTML = "The freezer temperature must be between -20 and -8"
      errorText.style.display = "block"
      document.getElementById("create-combo").setAttribute("error",true)
      return;
    }


  }
  if(val == "ac-temperature"){

    if( inputValue < 18 || inputValue > 38){
      errorText.innerHTML = "The temperature must be between 18 and 38"
      errorText.style.display = "block"
      document.getElementById("create-combo").setAttribute("error",true)
      return;
    }

  }
  var actualCantOfDivs = num - 1
  document.getElementById("create-combo").setAttribute("num",actualCantOfDivs)
  document.getElementById("create-combo").setAttribute("error",false)
  errorText.style.display = "none"
  createDivs(num, boolean, routine, currentAction);
}

function finalCheckErrors(num){
  var error = false;
  for(var i = 1 ; i <= num; i++){
    var device = document.getElementById("selectDevice" + i)
    var action = document.getElementById("selectAction" + i)
    var input = document.getElementById("inputParameter" + i)
    var errorExist = document.createElement("p")
    errorExist.classList.add("error")
    errorExist.innerHTML = "You must complete this field"
    if(device != null){
      device.parentNode.appendChild(errorExist)
      if(device.value == ""){
        errorExist.style.display = "block"
        error = true;
      }else{
        errorExist.style.display = "none"
      }
    }
    if(action != null){
      action.parentNode.appendChild(errorExist)
      if(action.value == ""){
        errorExist.style.display = "block"
        error = true;
      }else{
        errorExist.style.display = "none"
      }
    }
    if(input != null){
      input.parentNode.appendChild(errorExist)
      if(input.value == ""){
        errorExist.style.display = "block"
        error = true;
      }else{
        errorExist.style.display = "none"
      }
    }
  }
  if(document.getElementById("create-combo").getAttribute("error") == "true"){
      error = true
  }
  return error;
}

function createDivs(num, boolean, routine, currentAction){
  if(document.getElementById("deviceDiv" + num) != null){
    var deviceDiv = document.getElementById("deviceDiv" + num);
    deviceDiv.parentNode.removeChild(deviceDiv);
  }
    
  if(document.getElementById("actionDiv" + num) != null){
    var actionDiv = document.getElementById("actionDiv" + num);
    actionDiv.parentNode.removeChild(actionDiv);
  }
    
  if(document.getElementById("parameterDiv" + num) != null){
    var parameterDiv = document.getElementById("parameterDiv" + num);
    parameterDiv.parentNode.removeChild(parameterDiv);
  }

  var deviceDiv = document.createElement("div");
  var actionDiv = document.createElement("div");
  var parameterDiv = document.createElement("div");
   
  deviceDiv.setAttribute("id", "deviceDiv" + num);
  actionDiv.setAttribute("id", "actionDiv" + num);
  parameterDiv.setAttribute("id", "parameterDiv" + num);
  
  if(routine == null && !boolean){
    document.getElementById("append-here").appendChild(deviceDiv);
    document.getElementById("append-here").appendChild(actionDiv);
    document.getElementById("append-here").appendChild(parameterDiv);
  } else if(routine != null || boolean){
    document.getElementById("append-here-modify").appendChild(deviceDiv);
    document.getElementById("append-here-modify").appendChild(actionDiv);
    document.getElementById("append-here-modify").appendChild(parameterDiv);
  }
  
  if(routine == null && !boolean){
    displayDevices(num, false, null, null);
  } else if(routine == null && boolean){
    displayDevices(num, true, null, null);
  } else{
    displayDevices(num, true, routine, currentAction);
  }
}

$("#create-combo").on('shown.bs.modal', function () {
  createDivs(1, false, null, null);
});

$(function() {
    $('#cp3').colorpicker({
       color: '#AA3399',
        format: 'hex',
    });
});

function isColor(color){
  for (var i = 0; i < color.length; i++) {
    var c = color.charAt(i);
    if( (c < '0' || c > '9') && ( c < 'a' || c > 'z') && ( c < 'A' || c > 'Z'))
      return false;
  }
  return true;
}


</script>

</body>
</html>
